import random
import traceback
from telebot import types, TeleBot
import time
import threading
import config
import telebot

import os
from pymongo import MongoClient
import config
mainchat = -1001202711314
bot_username = 'horse_run_bot'
block = [787340171]
banchats = []
allow_bars = []

cazino_db = config.mongo_client.cazinobase
users = cazino_db.users
chats = cazino_db.chats
stats = cazino_db.stats
beecoins = cazino_db.beecoins

if stats.find_one({}) == None:
    stats.insert_one({})
    
#stats.update_one({},{'$set':{'id':100000}})

if beecoins.find_one({}) == None:
    beecoins.insert_one({'beecoins':50000})

beecoins.update_one({},{'$set':{'works':{'cleanready':True, 'barmenready':True, 'changelightready':True, 'fix_furniture':True}}})

bot = TeleBot(os.environ['cazino'])

for ids in chats.find({}):
    try:
        x = ids['notifications']
        y = ids['adminmode']
    except:
        chats.update_one({'id':ids['id']},{'$set':{'notifications':True, 'adminmode':False}})

users.update_many({},{'$set':{'working':False}})

def getbar():
    return {
        '0_0':[],
        '0_1':[],
        '0_2':[],
        '0_3':[],
        '0_4':[],
        '0_5':['chair'],
        '0_6':[],
        '0_7':[],
        '0_8':['enter'],
        '0_9':[],
        '0_10':[],
        '0_11':[],
        '0_12':[],
        '0_13':[],
        '0_14':[],
        '0_15':[],
        ################
        '1_0':[],
        '1_1':[],
        '1_2':[],
        '1_3':[],
        '1_4':[],
        '1_5':['table'],
        '1_6':[],
        '1_7':[],
        '1_8':[],
        '1_9':[],
        '1_10':[],
        '1_11':[],
        '1_12':['chair'],
        '1_13':['chair'],
        '1_14':['chair'],
        '1_15':[],
        ###################
        '2_0':[],
        '2_1':['chair'],
        '2_2':['table'],
        '2_3':['chair'],
        '2_4':[],
        '2_5':['chair'],
        '2_6':[],
        '2_7':[],
        '2_8':[],
        '2_9':[],
        '2_10':[],
        '2_11':['chair'],
        '2_12':['table'],
        '2_13':['table'],
        '2_14':['table'],
        '2_15':['chair'],
        #################
        '3_0':[],
        '3_1':[],
        '3_2':[],
        '3_3':[],
        '3_4':[],
        '3_5':[],
        '3_6':[],
        '3_7':[],
        '3_8':[],
        '3_9':[],
        '3_10':[],
        '3_11':[],
        '3_12':['chair'],
        '3_13':['chair'],
        '3_14':['chair'],
        '3_15':[],
        ##################################      
        '4_0':[],
        '4_1':[],
        '4_2':['chair'],
        '4_3':[],
        '4_4':[],
        '4_5':[],
        '4_6':[],
        '4_7':[],
        '4_8':[],
        '4_9':['chair'],
        '4_10':['table'],
        '4_11':[],
        '4_12':[],
        '4_13':[],
        '4_14':[],
        '4_15':[],
        ###########################
        '5_0':[],
        '5_1':['chair'],
        '5_2':['table'],
        '5_3':['chair'],
        '5_4':[],
        '5_5':[],
        '5_6':[],
        '5_7':[],
        '5_8':[],
        '5_9':[],
        '5_10':[],
        '5_11':[],
        '5_12':[],
        '5_13':[],
        '5_14':['chair'],
        '5_15':[],
        #########################
        '6_0':[],
        '6_1':[],
        '6_2':['chair'],
        '6_3':[],
        '6_4':[],
        '6_5':[],
        '6_6':['bartable'],
        '6_7':['bartable'],
        '6_8':['bartable'],
        '6_9':['bartable'],
        '6_10':['bartable'],
        '6_11':[],
        '6_12':[],
        '6_13':[],
        '6_14':['chair'],
        '6_15':['table'],
        ######################
        '7_0':[],
        '7_1':[],
        '7_2':[],
        '7_3':[],
        '7_4':[],
        '7_5':[],
        '7_6':['bartable'],
        '7_7':[],
        '7_8':[],
        '7_9':[],
        '7_10':['bartable'],
        '7_11':[],
        '7_12':[],
        '7_13':[],
        '7_14':['chair'],
        '7_15':[],
        ####################
        '8_0':['door'],
        '8_1':[],
        '8_2':[],
        '8_3':[],
        '8_4':['door'],
        '8_5':[],
        '8_6':['bartable'],
        '8_7':[],
        '8_8':['door'],
        '8_9':[],
        '8_10':['bartable'],
        '8_11':[],
        '8_12':['door'],
        '8_13':[],
        '8_14':[],
        '8_15':[],
         
    }

def createuser(user, coins = 300):
  return {
      'id':user.id,
      'name':user.first_name,
      'coins':coins,
      'reloadcoins':0,
      'lastbonus':0,
      'drinked':0,
      'bottle':False,
      'bar':{},
      'lvl':1,
      'lvlpoints':0,
      'exp':0,
      'strenght':1,
      'agility':1,
      'intelligence':1,
      'luck':1,
      'afk_until':0,
      'drunk':0,
      'supply':None,
      'food':None,
      'set':None,
      'current_supplies':{},
      'day_exp':80,
      'taken_exp':0,
      'reboot_time':0,
      'beecoins':0,
      'feed':100,
      'cooking_skill':1,
      'feelbad_until':0,
      'f_set':None,
      'current_foods':{},
      'now_cooking':False,
      'current_drink':None,
      'wait_ings':False,
      'govno':0,
      'cook':None,
      'portals':{'typical':0, 'rare':0, 'epic':0, 'legendary':0},
      'summons':{},
      'void_energy':0,
      'void_anomaly':0

  }

fightgames = {}

active = ['dec_armor', 'mana_void', 'shield_smash', 'rage', 'fireball', 'demon_inside', 'weakness', 'heal',
              'blood_ritual', 'speed_steal', 'mana_explosion', 'firegun', 'time_control', 'death_beam', 'void_blast', 'mana_destroy',
         'mana_drain', 'frost_arrow', 'wind_fury', 'light_charge']


    
npc_rares = {
    'typically':2,    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∏–ª–ª–æ–≤
    'rare':3,
    'epic':4,
    'legendary':5
}

def getskillamount(x):
    return npc_rares[x]

def createboss():
    return {
        'maxhp':900,
        'hp':900,
        'maxmp':200,
        'mp':200,
        'mp_regen':3,        # –ó–∞ 1 —Å–µ–∫—É–Ω–¥—É
        'dmg':100,
        'dmg_bonus':0,
        'disp':25,
        'armor':25,          # –ë–ª–æ–∫ —É—Ä–æ–Ω–∞ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —É–¥–∞—Ä–∞
        'armor_bonus':0,
        'atkspeed_bonus':0,
        'atkspeed':3,         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ–¥–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É —Ä–∞–≤–Ω–æ (atkspeed / 10)
        'zombie':0,
        
    }
        

all_boss_skills = ['fat', 'fast', 'dec_armor', 'mana_void', 'steel_body', 'shield_smash', 'mana_steal', 'rage', 'gigant', 'antimage', 'fireball', 'mana_vampire',
'demon_inside', 'magic_shield', 'mage', 'magic_mirror', 'berserk', 'weakness', 'heal', 'blood_ritual', 'speed_steal', 'mana_explosion', 'death_revenge', 'zombie',
'vampire', 'warrior', 'titan_body', 'shield_fight', 'firegun', 'mana_eat', 'bower', 'mana_monster', 'time_control', 'death_beam', 'void_blast', 'ninja', 'big',
'mana_destroy', 'thorns', 'mana_block', 'killer', 'supremacy', 'fire_hands', 'regen', 'strong_hit', 'assasin', 'mana_drain', 'frost_arrow', 'wind_fury',
'pierce_claws', 'light_charge']

crafting = []

def getmanacost(x):
    return getskill(x, select = 'mana')

def getskill(x, select = 'name'):
    y = '–ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å–∫–∏–ª–ª'
    z = '–ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ'
    i = 0
    if x == 'fat':
        y = '–¢–æ–ª—Å—Ç—è–∫'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +400 –•–ü, -1 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω, -80 –º–∞–∫—Å.–º–∞–Ω–∞'
    elif x == 'fast':
        y = '–ë—ã—Å—Ç—Ä—ã–π'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +2 —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏, -10 —É—Ä–æ–Ω–∞.'
    elif x == 'dec_armor':
        y = '–£–º–µ–Ω—å—à–µ–Ω–∏–µ –±—Ä–æ–Ω–∏'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +50 –ú–ü, +7 –±—Ä–æ–Ω–∏. –ê–∫—Ç–∏–≤–Ω—ã–π: —Ç—Ä–∞—Ç–∏—Ç 45 –ú–ü –∏ —É–º–µ–Ω—å—à–∞–µ—Ç –±—Ä–æ–Ω—é —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 50 –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î: 7 —Å–µ–∫.'
        i = 45
    elif x == 'mana_void':
        y = '–ú–∞–Ω–∞-–≤–∑—Ä—ã–≤'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +1 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω, +30 –ú–ü. –ê–∫—Ç–∏–≤–Ω—ã–π: —Ç—Ä–∞—Ç–∏—Ç 120 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–∞–Ω–µ. –ö–î: 15 —Å–µ–∫.'
        i = 120
    elif x == 'steel_body':
        y = '–°—Ç–∞–ª—å–Ω–æ–µ —Ç–µ–ª–æ'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +25 –±—Ä–æ–Ω–∏.'
    elif x == 'shield_smash':
        y = '–£–¥–∞—Ä —â–∏—Ç–æ–º'
        z = '–ê–∫—Ç–∏–≤–Ω—ã–π: —Ç—Ä–∞—Ç–∏—Ç 15 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π (–±—Ä–æ–Ω—è —Ö3). –ö–î: 6 —Å–µ–∫.'
        i = 15
    elif x == 'mana_steal':
        y = '–ö—Ä–∞–∂–∞ –º–∞–Ω—ã'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +50 –ú–ü. –ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤–æ—Ä—É–µ—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 1 –º–∞–Ω—ã.'
    elif x == 'rage':
        y = '–ë–µ—à–µ–Ω—Å—Ç–≤–æ'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: –ø–æ–ª—É—á–∞–µ—Ç +3 —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏, +50 —É—Ä–æ–Ω–∞ –∏ -15 –±—Ä–æ–Ω–∏ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î 15 —Å–µ–∫—É–Ω–¥.'
        i = 0
    elif x == 'gigant':
        y = '–ì–∏–≥–∞–Ω—Ç'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +1000 –•–ü, -150 –ú–ü, -1 —Å–∫–æ—Ä–æ—Å—Ç—å, +100 —É—Ä–æ–Ω–∞, +25 —Ä–∞–∑–±—Ä–æ—Å —É—Ä–æ–Ω–∞. –ü–∞—Å—Å–∏–≤–Ω–∞—è: —à–∞–Ω—Å 20% –ø—Ä–∏ —É–¥–∞—Ä–µ –æ–≥–ª—É—à–∏—Ç—å –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã.'
    elif x == 'antimage':
        y = '–ê–Ω—Ç–∏–º–∞–≥'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ú–ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–∞–≤–Ω—ã–º 0. –ó–∞ –∫–∞–∂–¥—É—é –ø–æ—Ç–µ—Ä—è–Ω–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É –º–∞–Ω—ã –ø–æ–ª—É—á–∞–µ—Ç +2 —Ö–ø.'
    elif x == 'fireball':
        y = '–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +100 –ú–ü, +3 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω. –ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 200 –º–∞–Ω—ã –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É (–ú–ê–ö–°.–ú–ü) —É—Ä–æ–Ω–∞. –ö–î: 20 —Å–µ–∫.'
        i = 200
    elif x == 'mana_vampire':
        y = '–ú–∞–Ω–∞-–≤–∞–º–ø–∏—Ä'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–æ–≥–¥–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫ —Ç—Ä–∞—Ç–∏—Ç –º–∞–Ω—É, –ø–æ–ª—É—á–∞–µ—Ç +1 —Ö–ø –∑–∞ –∫–∞–∂–¥—É—é –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É.'
    elif x == 'demon_inside':
        y = '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–µ–º–æ–Ω'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 100 –º–∞–Ω—ã –∏ –ø–æ–ª—É—á–∞–µ—Ç +200 —É—Ä–æ–Ω–∞ –Ω–∞ –æ–¥–Ω—É –∞—Ç–∞–∫—É. –ö–¥: 20 —Å–µ–∫.'
        i = 100
    elif x == 'magic_shield':
        y = '–ú–∞–≥–∏—á–µ—Å–∫–∏–π —â–∏—Ç'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: —Å —à–∞–Ω—Å–æ–º 20% –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞.'
    elif x == 'mage':
        y = '–ö–æ–ª–¥—É–Ω'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –∏ –∑–∞—Ç—Ä–∞—Ç—ã –º–∞–Ω—ã –Ω–∞ –≤—Å–µ —Å–∫–∏–ª–ª—ã -50%.'
    elif x == 'magic_mirror':
        y = '–û—Ç—Ä–∞–∂–µ–Ω–∏–µ –º–∞–≥–∏–∏'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: —Å —à–∞–Ω—Å–æ–º 20% —Ç—É—Ç –∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–∏–ª–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω–∏–ª —Å–æ–ø–µ—Ä–Ω–∏–∫. –ù–µ —Ç—Ä–∞—Ç–∏—Ç –º–∞–Ω—É.'
    elif x == 'berserk':
        y = '–ë–µ—Ä—Å–µ—Ä–∫'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –ª—é–±–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–∞—à —É—Ä–æ–Ω –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ 2 —Ä–∞–∑–∞ —Å–∏–ª—å–Ω–µ–µ.'
    elif x == 'weakness':
        y = '–û—Å–ª–∞–±–ª–µ–Ω–∏–µ'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +50 –ú–ü. –ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 80 –ú–ü, —Å–æ–ø–µ—Ä–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç -50 –∫ —É—Ä–æ–Ω—É –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î: 15 —Å–µ–∫—É–Ω–¥.'
        i = 80
    elif x == 'heal':
        y = '–õ–µ—á–µ–Ω–∏–µ'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 40 –ú–ü –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 250 –•–ü. –ö–î: 10 —Å–µ–∫.'
        i = 40
    elif x == 'blood_ritual':
        y = '–ö—Ä–æ–≤–∞–≤—ã–π —Ä–∏—Ç—É–∞–ª'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +150 –•–ü. –ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 20% –æ—Ç —Å–≤–æ–µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –•–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π (–ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ —Ö–ø —Ö2). –ö–î: 13 —Å–µ–∫.'
        i = 0
    elif x == 'speed_steal':
        y = '–ö—Ä–∞–∂–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 80 –º–∞–Ω—ã –∏ –≤–æ—Ä—É–µ—Ç 1 —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏ —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥. –ö–î: 22 —Å–µ–∫.'
        i = 80
    elif x == 'mana_explosion':
        y = '–ú–∞–Ω–æ–≤—ã–∂–∏–≥–∞–Ω–∏–µ'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +100 –ú–ü. –ù–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 1 —É—Ä–æ–Ω–∞ –∑–∞ –∫–∞–∂–¥—É—é –µ–≥–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É –º–∞–Ω—ã. –¢—Ä–∞—Ç–∏—Ç 100 –º–∞–Ω—ã. –ö–î: 19 —Å–µ–∫.'
        i = 100
    elif x == 'death_revenge':
        y = '–ü–æ—Å–º–µ—Ä—Ç–Ω–∞—è –º–µ—Å—Ç—å'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è. –ï—Å–ª–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫ —É–º—Ä–µ—Ç - –ø–æ–±–µ–∂–¥–∞–µ—Ç.'
    elif x == 'zombie':
        y = '–ó–æ–º–±–∏'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–º–µ—Ä—Ç–∏ –≤–æ–∑—Ä–æ–∂–¥–∞–µ—Ç—Å—è —Å 25% –•–ü.'
    elif x == 'vampire':
        y = '–í–∞–º–ø–∏—Ä'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∞—Ç–∞–∫–∏ –∫—Ä–∞–¥—É—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (15% –æ—Ç —É—Ä–æ–Ω–∞) –∂–∏–∑–Ω–µ–π.'
    elif x == 'warrior':
        y = '–í–æ–∏–Ω'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +60 —É—Ä–æ–Ω–∞, +50 —Ä–∞–∑–±—Ä–æ—Å —É—Ä–æ–Ω–∞, -150 –•–ü, -5 –±—Ä–æ–Ω–∏.'
    elif x == 'titan_body':
        y = '–¢–∏—Ç–∞–Ω–æ–≤–æ–µ —Ç–µ–ª–æ'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +50 –±—Ä–æ–Ω–∏, -300 –•–ü.'
    elif x == 'shield_fight':
        y = '–ê—Ç–∞–∫–∞ —â–∏—Ç–æ–º'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥–∞—è –∞—Ç–∞–∫–∞ –æ—Ç–Ω–∏–º–∞–µ—Ç —É –Ω–æ—Å–∏—Ç–µ–ª—è 1 –±—Ä–æ–Ω—é –∏ –Ω–∞–Ω–æ—Å–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π –æ—Å—Ç–∞–≤—à–µ–π—Å—è –±—Ä–æ–Ω–µ.'
    elif x == 'firegun':
        y = '–ü–æ—Ç–æ–∫ –ø–ª–∞–º–µ–Ω–∏'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 100 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É (6 —Ö –µ–≥–æ –±—Ä–æ–Ω—è) —É—Ä–æ–Ω–∞. –ö–î: 10 —Å–µ–∫.'
        i = 100
    elif x == 'mana_eat':
        y = '–ü–æ–µ–¥–∞–Ω–∏–µ –º–∞–Ω—ã'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –•–ü, —Ä–∞–≤–Ω–æ–µ (–º–∞–Ω–∞—Ä–µ–≥–µ–Ω —Ö2).'
    elif x == 'bower':
        y = '–õ—É—á–Ω–∏–∫'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: +100 —Ä–∞–∑–±—Ä–æ—Å —É—Ä–æ–Ω–∞, +100 –ú–ü, +25 —É—Ä–æ–Ω–∞.'
    elif x == 'mana_monster':
        y = '–ú–æ–Ω—Å—Ç—Ä –∏–∑ –º–∞–Ω—ã'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +7 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω, +400 –ú–ü. –ü–∞—Å—Å–∏–≤–Ω–∞—è: –Ω–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –≤—ã —Ç—Ä–∞—Ç–∏—Ç–µ –•–ü, –∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–Ω–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è –ú–ü –≤–º–µ—Å—Ç–æ –•–ü. –ï—Å–ª–∏ –ú–ü –∏–ª–∏ –•–ü –æ–ø—É—Å—Ç—è—Ç—Å—è –¥–æ 0, –≤—ã –ø–æ–≥–∏–±–∞–µ—Ç–µ.'
    elif x == 'time_control':
        y = '–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 70 –ú–ü –∏ –ø–æ–ª—É—á–∞–µ—Ç +20 –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ–∫—É–Ω–¥—É. –ö–î: 6 —Å–µ–∫.'
        i = 70
    elif x == 'death_beam':
        y = '–õ—É—á —Å–º–µ—Ä—Ç–∏'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: 1 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω. +50 –ú–ü. –ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 50 –ú–ü. –ù–∞–Ω–æ—Å–∏—Ç 100 —É—Ä–æ–Ω–∞, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ —Ö–ø. –ö–î: 23 —Å–µ–∫.'
        i = 50
    elif x == 'void_blast':
        y = '–í–∑—Ä—ã–≤ –ø—É—Å—Ç–æ—Ç—ã'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: –æ—Ç–Ω–∏–º–∞–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 35% –•–ü –æ—Ç –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ –±–æ–π.'
        i = 0
    elif x == 'ninja':
        y = '–ù–∏–Ω–¥–∑—è'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: —Å–∫–æ—Ä–æ—Å—Ç—å –∞—Ç–∞–∫–∏ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 2.'
    elif x == 'big':
        y = '–û–≥—Ä–æ–º–Ω—ã–π'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: –•–ü —Ö2, –ú–ü —Ö2, —É—Ä–æ–Ω/1.7, -3 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω.'
    elif x == 'mana_destroy':
        y = '–£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –º–∞–Ω—ã'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 60 –ú–ü –∏ –æ—Ç–Ω–∏–º–∞–µ—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 60% –æ—Ç –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ –ú–ü. –ö–î: 15 —Å–µ–∫.'
        i = 60
    elif x == 'thorns':
        y = '–®–∏–ø—ã'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: -100 –•–ü. –ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —É—Ä–æ–Ω, –∏–º–µ–µ—Ç 20% —à–∞–Ω—Å –æ—Ç–º–µ–Ω–∏—Ç—å –µ–≥–æ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞. –î–µ–π—Å—Ç–≤—É–µ—Ç –∏ –Ω–∞ —É—Ä–æ–Ω, –Ω–∞–Ω–µ—Å—ë–Ω–Ω—ã–π —Å–µ–±–µ –∂–µ.'
    elif x == 'mana_block':
        y = '–ú–∞–Ω–∞–±–ª–æ–∫'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +1 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω. –ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–æ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —É—Ä–æ–Ω, —Ç—Ä–∞—Ç–∏—Ç (–ø–æ–ª—É—á–µ–Ω–Ω—ã–π —É—Ä–æ–Ω) –ú–ü –≤–º–µ—Å—Ç–æ –•–ü, –ø–æ–∫–∞ –∏–º–µ–µ—Ç—Å—è.'
    elif x == 'killer':
        y = '–£–±–∏–π—Ü–∞'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: –ø–æ–ª—É—á–∞–µ—Ç +100 —É—Ä–æ–Ω–∞, +1 —Å–∫–æ—Ä–æ—Å—Ç—å –∞—Ç–∞–∫–∏, —Ö–ø/2.'
    elif x == 'supremacy':
        y = '–ü—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +100 –ú–ü, +200 –•–ü, +1 —Å–∫–æ—Ä–æ—Å—Ç—å –∞—Ç–∞–∫–∏, +1 –º–∞–Ω–∞—Ä–µ–≥–µ–Ω.'   
    elif x == 'fire_hands':
        y = '–û–≥–Ω–µ–Ω–Ω—ã–µ –∞—Ç–∞–∫–∏'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥–∞—è –∞—Ç–∞–∫–∞ –ø–æ–¥–∂–∏–≥–∞–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ —Ç–µ—Ä—è—Ç—å 20 –•–ü –∏ 20 –ú–ü –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–±–∞—Ñ—Ñ–∞: 3 —Å–µ–∫. –û–≥–æ–Ω—å —Å—Ç–∞–∫–∞–µ—Ç—Å—è.'    
    elif x == 'regen':
        y = '–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: +100 –•–ü. –ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 5 –•–ü.' 
    elif x == 'strong_hit':
        y = '–°–æ–∫—Ä—É—à–∞—é—â–∏–π —É–¥–∞—Ä'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∫–∞–∂–¥–∞—è —á–µ—Ç–≤–µ—Ä—Ç–∞—è –∞—Ç–∞–∫–∞ –æ–≥–ª—É—à–∞–µ—Ç —Ü–µ–ª—å –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã.'
    elif x == 'assasin':
        y = '–ê—Å—Å–∞—Å–∏–Ω'
        z = '–ù–∞—á–∞–ª–æ –º–∞—Ç—á–∞: —É—Ä–æ–Ω —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–∞–≤–Ω–æ–µ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏ —Ö4). –ë—Ä–æ–Ω—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–∞–≤–Ω–∞ 0.'    
    elif x == 'mana_drain':
        y = '–í—ã—Å–∞—Å—ã–≤–∞–Ω–∏–µ –º–∞–Ω—ã'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 85 –ú–ü –∏ –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –∏–∑ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 40% –æ—Ç –µ–≥–æ –º–∞–∫—Å.–ú–ü. –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–π –º–∞–Ω–µ. –ö–î: 14 —Å–µ–∫.'    
        i = 85
    elif x == 'frost_arrow':
        y = '–õ–µ–¥—è–Ω–∞—è —Å—Ç—Ä–µ–ª–∞'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 65 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç 75 —É—Ä–æ–Ω–∞ –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞. –°–Ω–∏–∂–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ü–µ–ª–∏ –¥–æ 1 –Ω–∞ 5 —Å–µ–∫—É–Ω–¥. –ö–î: 12 —Å–µ–∫.'    
        i = 65
    elif x == 'wind_fury':
        y = '–£—Ä–∞–≥–∞–Ω'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 300 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 500 —É—Ä–æ–Ω–∞. –ö–î: 25 —Å–µ–∫.'    
        i = 300
    elif x == 'pierce_claws':
        y = '–ü—Ä–æ–Ω–∑–∞—é—â–∏–µ –∫–æ–≥—Ç–∏'
        z = '–ü–∞—Å—Å–∏–≤–Ω–∞—è: –∞—Ç–∞–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –±—Ä–æ–Ω—é —Å–æ–ø–µ—Ä–Ω–∏–∫–∞.'
    elif x == 'light_charge':
        y = '–ü—Ä–∏–∑—ã–≤ –º–æ–ª–Ω–∏–∏'
        z = '–ê–∫—Ç–∏–≤–Ω–∞—è: —Ç—Ä–∞—Ç–∏—Ç 10 –º–∞–Ω—ã –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 65 —É—Ä–æ–Ω–∞. –ö–î: 1 —Å–µ–∫.'  
        i = 10
        
    if select == 'name':
        return y
    elif select == 'description':
        return z
    elif select == 'mana':
        return i

#fat: +400 –•–ü, -1 mp_regen –∏ -80 maxmp
#fast: +2 atkspeed, -20 dmg
#dec_armor: +50 maxmp. +7 armor. –¢—Ä–∞—Ç–∏—Ç 45 –ú–ü –∏ —É–º–µ–Ω—å—à–∞–µ—Ç –±—Ä–æ–Ω—é —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 50 –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î 7 —Å–µ–∫—É–Ω–¥.
#mana_void: +1 mp_regen. +30 maxmp. –¢—Ä–∞—Ç–∏—Ç 120 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–∞–Ω–µ. –ö–î 15 —Å–µ–∫—É–Ω–¥.
#steel_body: +25 armor.
#shield_smash: –¢—Ä–∞—Ç–∏—Ç 15 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π (–±—Ä–æ–Ω—è * 3).
#mana_steal: +50 maxmp. –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤–æ—Ä—É–µ—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 1 –º–∞–Ω—ã.
#rage: –ø–æ–ª—É—á–∞–µ—Ç +3 —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏, +50 —É—Ä–æ–Ω–∞ –∏ -15 –±—Ä–æ–Ω–∏ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î 15 —Å–µ–∫—É–Ω–¥.
#gigant: +1000 –•–ü, -150 maxmp, -1 atkspeed, +100 dmg, +25 disp, —à–∞–Ω—Å 20% –ø—Ä–∏ —É–¥–∞—Ä–µ –æ–≥–ª—É—à–∏—Ç—å –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã.
#antimage: –≤ –Ω–∞—á–∞–ª–µ –±–æ—è –º–∞–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 0. –ó–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É –º–∞–Ω—ã –ø–æ–ª—É—á–∞–µ—Ç +2 —Ö–ø.
#fireball: +100 maxmp, +3 mp_regen. –¢—Ä–∞—Ç–∏—Ç 200 –º–∞–Ω—ã –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É (maxmp) —É—Ä–æ–Ω–∞. –ö–î 20 —Å–µ–∫—É–Ω–¥.
#mana_vampire: –∫–æ–≥–¥–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫ —Ç—Ä–∞—Ç–∏—Ç –º–∞–Ω—É, –ø–æ–ª—É—á–∞–µ—Ç +1 —Ö–ø –∑–∞ –∫–∞–∂–¥—É—é –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É.
#demon_inside: —Ç—Ä–∞—Ç–∏—Ç 100 –º–∞–Ω—ã –∏ –ø–æ–ª—É—á–∞–µ—Ç +200 —É—Ä–æ–Ω–∞ –Ω–∞ –æ–¥–Ω—É –∞—Ç–∞–∫—É. –ö–î 20 —Å–µ–∫—É–Ω–¥.
#magic_shield: –ü–∞—Å—Å–∏–≤–Ω–∞—è. –° —à–∞–Ω—Å–æ–º 20% –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞.
#mage: –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –∏ –∑–∞—Ç—Ä–∞—Ç—ã –º–∞–Ω—ã –Ω–∞ –≤—Å–µ —Å–∫–∏–ª–ª—ã -50%.
#magic_mirror: —Å —à–∞–Ω—Å–æ–º 15% —Ç—É—Ç –∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–∏–ª–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω–∏–ª —Å–æ–ø–µ—Ä–Ω–∏–∫. –ù–µ —Ç—Ä–∞—Ç–∏—Ç –º–∞–Ω—É.
#berserk: –ª—é–±–æ–π –±–æ–Ω—É—Å —É—Ä–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤–∞—Å, –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ 3 —Ä–∞–∑–∞ —Å–∏–ª—å–Ω–µ–µ.
#weakness: +50 maxmp. –¢—Ä–∞—Ç–∏—Ç 80 –ú–ü. –°–æ–ø–µ—Ä–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç -50 –∫ —É—Ä–æ–Ω—É –Ω–∞ 10 —Å–µ–∫—É–Ω–¥. –ö–î 15 —Å–µ–∫—É–Ω–¥.
#heal: —Ç—Ä–∞—Ç–∏—Ç 40 –ú–ü –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 200 –•–ü. –ö–î: 10 —Å–µ–∫—É–Ω–¥.
#blood_ritual: —Ç—Ä–∞—Ç–∏—Ç 20% –æ—Ç —Å–≤–æ–µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –•–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π (–ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ —Ö–ø*1.5). –ö–î: 13 —Å–µ–∫—É–Ω–¥.
#speed_steal: –¢—Ä–∞—Ç–∏—Ç 80 –º–∞–Ω—ã –∏ –≤–æ—Ä—É–µ—Ç 1 —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏ —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥. –ö–î: 22 —Å–µ–∫—É–Ω–¥.
#mana_explosion: +100 maxmp. –ù–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 1 —É—Ä–æ–Ω–∞ –∑–∞ –∫–∞–∂–¥—É—é –µ–≥–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É –º–∞–Ω—ã. –¢—Ä–∞—Ç–∏—Ç (–Ω–∞–Ω–µ—Å–µ–Ω–Ω—ã–π —É—Ä–æ–Ω/2) –º–∞–Ω—ã. –ö–î: 19 —Å–µ–∫—É–Ω–¥.
#death_revenge: –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π. –ï—Å–ª–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫ —É–º—Ä–µ—Ç - –ø–æ–±–µ–∂–¥–∞–µ—Ç.
#zombie: –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–º–µ—Ä—Ç–∏ –≤–æ–∑—Ä–æ–∂–¥–∞–µ—Ç—Å—è —Å 25% –•–ü.
#vampire: –∞—Ç–∞–∫–∏ –∫—Ä–∞–¥—É—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (15% –æ—Ç —É—Ä–æ–Ω–∞) –∂–∏–∑–Ω–µ–π.
#warrior: +60 dmg, +50 disp, -150 hp, -5 armor.
#titan_body: +50 armor, -300 hp.
#shield_fight: –∫–∞–∂–¥–∞—è –∞—Ç–∞–∫–∞ –æ—Ç–Ω–∏–º–∞–µ—Ç —É –Ω–æ—Å–∏—Ç–µ–ª—è 1 –±—Ä–æ–Ω—é –∏ –Ω–∞–Ω–æ—Å–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–Ω, —Ä–∞–≤–Ω—ã–π –æ—Å—Ç–∞–≤—à–µ–π—Å—è –±—Ä–æ–Ω–µ.
#firegun: —Ç—Ä–∞—Ç–∏—Ç 100 –ú–ü –∏ –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É (6 * –µ–≥–æ –±—Ä–æ–Ω—è) —É—Ä–æ–Ω–∞. –ö–î: 10 —Å–µ–∫.
#mana_eat: –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –•–ü, —Ä–∞–≤–Ω–æ–µ –≤–∞—à–µ–º—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –º–∞–Ω—ã*2.
#bower: +100 disp, +100 MP, +25 dmg.
#mana_monster: +10 mp_regen, +400 mp. –ù–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –≤—ã —Ç—Ä–∞—Ç–∏—Ç–µ –•–ü, –∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–Ω–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è –º–∞–Ω–∞ –≤–º–µ—Å—Ç–æ —Ö–ø. –ï—Å–ª–∏ –º–∞–Ω–∞ –∏–ª–∏ —Ö–ø –æ–ø—É—Å—Ç—è—Ç—Å—è –¥–æ 0, –≤—ã –ø–æ–≥–∏–±–∞–µ—Ç–µ.
#time_control: –¢—Ä–∞—Ç–∏—Ç 100 –º–∞–Ω—ã –∏ –ø–æ–ª—É—á–∞–µ—Ç +20 –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ–∫—É–Ω–¥—É. –ö–î: 6 —Å–µ–∫—É–Ω–¥.
#death_beam: +1 mp_regen. +50 mp. –¢—Ä–∞—Ç–∏—Ç 50 –º–∞–Ω—ã. –ù–∞–Ω–æ—Å–∏—Ç 100 —É—Ä–æ–Ω–∞, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ —Ö–ø. –ö–î: 23 —Å–µ–∫.
#void_blast: –æ—Ç–Ω–∏–º–∞–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 35% –•–ü –æ—Ç –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö. 1 —Ä–∞–∑ –∑–∞ –±–æ–π.
#ninja: —Å–∫–æ—Ä–æ—Å—Ç—å –∞—Ç–∞–∫–∏ * 2.
#big: hp*2, mp*2, dmg/2, -3 mp_regen.
#mana_destroy: –¢—Ä–∞—Ç–∏—Ç 50 –º–∞–Ω—ã –∏ –æ—Ç–Ω–∏–º–∞–µ—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 60% –æ—Ç –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ –º–∞–Ω—ã. –ö–î: 15 —Å–µ–∫.


npc_name1 = ['–Ω–µ—Ä–µ–∞–ª—å–Ω—ã–π', '–ª—é—Ç—ã–π', '–±–µ—à–µ–Ω—ã–π', '–∞–¥—Å–∫–∏–π', '–±–µ–∑—É–º–Ω—ã–π', '–º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω—ã–π', '–Ω–µ–æ—Ç—Ä–∞–∑–∏–º—ã–π', '–æ–≥—Ä–æ–º–Ω—ã–π', '–∂–∏—Ä–Ω—ã–π', '—Ä—å—è–Ω—ã–π', 
            '–¥–µ—Ä–∑–∫–∏–π', '—Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π', '—Å—É—Ä–æ–≤—ã–π', '—Å—Ç—Ä–∞—à–Ω—ã–π', '—É–∂–∞—Å–∞—é—â–∏–π', '—à–∏—Ä–æ–∫–∏–π', '—è–¥—Ä—ë–Ω—ã–π', '—è—Ä–æ—Å—Ç–Ω—ã–π', '—Å—Ç–æ–π–∫–∏–π', '—Å–æ–ª–∏–¥–Ω—ã–π', 
            '—Å–µ—Ä–¥–∏—Ç—ã–π', '–ø–æ–∂–∏–ª–æ–π', '—Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω—ã–π', '–±—É–π—Å—Ç–≤—É—é—â–∏–π', '—Å–≤–∏—Ä–µ–ø—ã–π', '–º—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π', '—É–±–∏–π—Å—Ç–≤–µ–Ω–Ω—ã–π']

npc_name2 = ['–∫–æ–±–æ–ª—å–¥', '–º—É—Ä–ª–æ–∫', '–¥–µ–º–æ–Ω', '–∞–±–∏—Å—Å–∞–ª', '—Ç–∏—Ç–∞–Ω', '–≤–∞–º–ø–∏—Ä', '–ø–∞—É–∫', '–∞–¥—Å–∫–∏–π –ø—ë—Å', '—Ç—Ä–æ–ª–ª—å', '–≥–Ω–æ–º', '—Ö–æ–±–±–∏—Ç', '–æ—Ä–∫', '—ç–Ω—Ç',
            '–≥–æ–º—É–Ω–∫—É–ª', '—Å–∞—Ç–∏—Ä', '–≥–Ω–æ–ª–ª', '–∫–µ–Ω—Ç–∞–≤—Ä', '—Ç—Ä–æ–≥–≥', '—ç—Ñ–∏—Ä–∏–∞–ª', '–≤–æ—Ä–≥–µ–Ω', '–±–µ—Å', '–Ω–∞—Ç—Ä–µ–∑–∏–º', '–¥—Ä–∞–∫–æ–Ω', '–º–∞–≥–Ω–∞—Ç–∞–≤—Ä', '–∞–Ω—É–±–∏—Å–∞—Ç',
            '—ç–ª—å—Ñ', '–æ–±–æ—Ä–æ—Ç–µ–Ω—å', '–Ω–µ–∫—Ä–æ–Ω', '—Ç–∏—Ñ–ª–∏–Ω–≥']
    
npc_name3 = ['–ë—Ä—ç–Ω–¥–æ–Ω', '–í–µ—Ä—Ä–æ–Ω–Ω', '–í–∏–∫—Ç—É–∞—Ä', '–ì–∞—Ä–æ–ª—å–¥', '–ê–ª—å–±–µ—Ä—Ç', '–ì–æ—Ä–¥–æ–Ω', '–ì—É–¥–≤–∏–Ω', '–î–∂–µ—Ä–ª–∞—Å—Å', '–ù—É–∞—Ä—Ç', '–≠–π—Ä–µ–≤–µ–ª–ª', '–ñ–∞–Ω', '–ò–ª–ª–∏—Ä–∏–π',
            '–ö–µ–ª–ª–∞–Ω', '–ö–æ—Ä–∞–ª–ª–∏—Å', '–õ—é—Ü–∏—É—Å', '–õ—É–∏', '–ú—ç–¥–∏—Å–æ–Ω', '–ö–≤–∏–ª–≥–æ—Å', '–ú–µ—Ä—Ä–∏–Ω', '–ê–≥–∏—Ä–æ—Å–∏–æ–Ω', '–ì–æ–º—É–Ω–∫—É–ª—É—Å', '–•–∞—Ä—Ä–∏–Ω', '–¢–∏—Ç–∞–Ω–∏–π', '–°–∏–º—É—Å',
             '–°–µ—Ö–µ–ª–∏—Å', '–†–æ–¥–∂–µ—Ä', '–†–∏–∫', '–ú–∞–≥–Ω—É—Å', '–õ–∞–≥–º–∞–Ω', '–û–¥–¥', '–¢–æ—Ä–≤–∞–ª—å–¥', '–≠–≤–µ–Ω', '–¢–µ–æ–¥–æ—Ä', '–ë–µ—Ä–≥', '–ú–æ–¥–¥–∞–Ω', '–°—É—Ä—Ç', '–•–µ–¥–∏–Ω', '–ì—Ä–∏–º',
             '–†–µ–ª–æ–Ω—Ç–∞—Ä', '–ù–µ–æ—Ñ–∏–ª–∞–Ω—Ç', '–ê—Ä–∏—Å—è', '–í–∞–Ω–µ—Å—Å–∞', '–ò–ª–ª–∏–∞–¥–∞', '–†—ç–º', '–¢–∏—Ä–∏—Å—Å', '–°–∏–º—É—Å']

#users.update_many({},{'$set':{'portals':{'typical':0, 'rare':0, 'epic':0, 'legendary':0}, 'summons':{}}})

@bot.message_handler(commands=['brokenfight'])
def brokennf(m):
    if m.chat.id not in fightgames:
        bot.send_message(m.chat.id, '–í —á–∞—Ç–µ –¥–∞–∂–µ –Ω–µ –∏–¥—ë—Ç –∏–≥—Ä–∞!')
        return
    game = fightgames[m.chat.id]
    
    if game['lastturnfight'] != None and time.time() - game['lastturnfight'] >= 15:
        del fightgames[game['id']]
        bot.send_message(m.chat.id, '–£–¥–∞–ª–∏–ª —Å–ª–æ–º–∞–Ω–Ω—É—é –∏–≥—Ä—É!')
    else:
        bot.send_message(m.chat.id, '–ï—â—ë –Ω–µ –ø—Ä–æ—à–ª–æ 15 —Å–µ–∫—É–Ω–¥ —Å –ø—Ä–æ—à–ª–æ–≥–æ —Ö–æ–¥–∞, —á—Ç–æ–±—ã –∏–≥—Ä–∞ —Å—á–∏—Ç–∞–ª–∞—Å—å —Å–ª–æ–º–∞–Ω–Ω–æ–π!')
    
def portaltotext(x):
    y = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'
    if x == 'typically':
        y = '‚ö™–û–±—ã—á–Ω—ã–π'
    elif x == 'rare':
        y = 'üîµ–†–µ–¥–∫–∏–π'
    elif x == 'epic':
        y = 'üü£–≠–ø–∏—á–µ—Å–∫–∏–π'
    elif x == 'legendary':
        y = 'üí†–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π'
    return y
        
#chats.update_many({},{'$set':{'realbar':createrealbar()}})

for ids in users.find({}):
    if ids['cook'] != None:
        users.update_one({'id':ids['id']},{'$set':{'cook.cooking':False}})

        
@bot.message_handler(commands=['chat_stats'])
def chatsssstats(m):
    if m.from_user.id not in [441399484, 376001833]:
        return
    i = 0
    for ids in chats.find({}):
        if ids['id'] < 0:
            i += 1
    bot.send_message(m.chat.id, '–í—Å–µ–≥–æ —è –∑–Ω–∞—é '+str(i)+' —á–∞—Ç–æ–≤!')
    
        
@bot.message_handler(commands=['book'])
def bookk(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    text = ''
    text1 = ''
    text2 = ''
    text3 = ''
    already = []
    for ids in user['summons']:
        for idss in user['summons'][ids]['skills']:
            if idss not in already:
                if len(text) > 2500:
                    text1 = text
                    text = ''
                if len(text) > 2500:
                    text2 = text
                    text = ''
                text += '*'+getskill(idss)+'*\n'+getskill(idss, select = 'description')+'\n\n'
                already.append(idss)
    try:
        bot.send_message(m.from_user.id, text, parse_mode = 'markdown')
        if text1 != '':
            bot.send_message(m.from_user.id, text1, parse_mode = 'markdown')
        if text2 != '':
            bot.send_message(m.from_user.id, text2, parse_mode = 'markdown')
            
        bot.send_message(m.chat.id, '–û—Ç–ø—Ä–∞–≤–∏–ª –≤ –õ–°.')
    except:
        bot.send_message(m.chat.id, '–õ–∏–±–æ –≤—ã –Ω–µ –æ—Ç–∫—Ä—ã–ª–∏ —Å–æ –º–Ω–æ–π –ª–∏—á–∫—É, –ª–∏–±–æ —É –≤–∞—Å –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –±–æ—Å—Å–∞!')
        bot.send_message(441399484, traceback.format_exc())

@bot.message_handler(commands=['summon'])
def summonn(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    nextt = False    
    kb = types.InlineKeyboardMarkup()
    for ids in user['portals']:
        if user['portals'][ids] > 0:
            kb.add(types.InlineKeyboardButton(text = portaltotext(ids)+'('+str(user['portals'][ids])+')', callback_data = 'summon_'+ids+'_'+str(m.from_user.id)))
            nextt = True
    if not nextt:
        bot.send_message(m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –ø–æ—Ä—Ç–∞–ª–æ–≤ –¥–ª—è –ø—Ä–∏–∑—ã–≤–∞ –±–æ—Å—Å–∞!')
        return
    bot.send_message(m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—Ç–∞–ª –¥–ª—è –ø—Ä–∏–∑—ã–≤–∞ –±–æ—Å—Å–∞.', reply_markup = kb)
    
    
@bot.message_handler(commands=['give_stone'])
def givestoness(m):
    if m.from_user.id != 441399484:
        return
    try:
        users.update_one({'id':m.reply_to_message.from_user.id},{'$inc':{'portals.'+m.text.split(' ')[1]:int(m.text.split(' ')[2])}})
        bot.send_message(m.chat.id, '–í—ã–¥–∞–Ω–æ '+m.text.split(' ')[2]+' –∫–∞–º–Ω–µ–π "'+m.text.split(' ')[1]+'"!')
    except:
        bot.send_message(441399484, traceback.format_exc())
        bot.send_message(m.chat.id, '–û—à–∏–±–∫–∞!')
                                                                         
    
@bot.message_handler(commands=['fighting'])
def fighting(m):
    if m.reply_to_message == None:
        bot.send_message(m.chat.id, '–ß—Ç–æ–±—ã –ø–æ–∑–≤–∞—Ç—å –∫–æ–≥–æ-—Ç–æ –Ω–∞ –ø–æ–µ–¥–∏–Ω–æ–∫ –±–æ—Å—Å–æ–≤, –Ω—É–∂–Ω–æ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ!')
        return
    if m.reply_to_message.from_user.id == m.from_user.id:
        bot.send_message(m.chat.id, '–ù–µ–ª—å–∑—è –±—Ä–æ—Å–∞—Ç—å –≤—ã–∑–æ–≤ —Å–∞–º–æ–º—É —Å–µ–±–µ!')
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    nextt = False
    for ids in user['summons']:
        nextt = True
    if not nextt:
        bot.send_message(m.chat.id, '–£ –≤–∞—Å –¥–∞–∂–µ –Ω–µ—Ç –±–æ—Å—Å–æ–≤, —á—Ç–æ–±—ã –±—Ä–æ—Å–∞—Ç—å –∫–æ–º—É-—Ç–æ –≤—ã–∑–æ–≤!')
        return
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ü—Ä–∏–Ω—è—Ç—å –≤—ã–∑–æ–≤', callback_data = 'fighting_go_'+str(m.from_user.id)+'_'+str(m.reply_to_message.from_user.id)), types.InlineKeyboardButton(text = '–û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—ã–∑–æ–≤', callback_data = 'fighting_cancel_'+str(m.from_user.id)+'_'+str(m.reply_to_message.from_user.id)))
    bot.send_message(m.chat.id, m.reply_to_message.from_user.first_name+', –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –ª–∏ –≤—ã –≤—ã–∑–æ–≤ –ø—Ä–∏–∑—ã–≤–∞—Ç–µ–ª—è '+m.from_user.first_name+'?', reply_to_message_id = m.reply_to_message.message_id, reply_markup = kb)
    

@bot.message_handler(commands=['release'])
def releasse(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.from_user.id != m.chat.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    kb = types.InlineKeyboardMarkup()
    for ids in user['summons']:
        summon = user['summons'][ids]
        em = '?'
        if len(summon['skills']) == 2:
            x = portaltotext('typically')
        if len(summon['skills']) == 3:
            x = portaltotext('rare')
        if len(summon['skills']) == 4:
            x = portaltotext('epic')
        if len(summon['skills']) == 5:
            x = portaltotext('legendary')
        em = x[0]
        if len(summon['skills']) < 5:
            kb.add(types.InlineKeyboardButton(text = em+summon['name'], callback_data = 'fighting_release_'+str(user['summons'][ids]['id'])+'_'+str(user['id'])+'_'+str(m.chat.id)))
    bot.send_message(user['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Å—Å–∞, —á—Ç–æ–±—ã –æ—Ç–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ, –≤ –ø–æ—Ç—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –º–∏—Ä. –ó–∞ —ç—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ üîÆ–≠–Ω–µ—Ä–≥–∏—é –ü—É—Å—Ç–æ—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –Ω—É–∂–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ‚ò£–ê–Ω–æ–º–∞–ª–∏–∏ –ü—É—Å—Ç–æ—Ç—ã. '+
                     '–†–∞—Å—Ü–µ–Ω–∫–∏:\n‚ö™–û–±—ã—á–Ω—ã–π: 150üîÆ\nüîµ–†–µ–¥–∫–∏–π: 250üîÆ\nüü£–≠–ø–∏—á–µ—Å–∫–∏–π: 1000üîÆ\nüí†–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π: 10000üîÆ', reply_markup = kb)

    
@bot.message_handler(commands=['release_legendary'])
def releasse(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.from_user.id != m.chat.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    kb = types.InlineKeyboardMarkup()
    for ids in user['summons']:
        summon = user['summons'][ids]
        em = '?'
        if len(summon['skills']) == 2:
            x = portaltotext('typically')
        if len(summon['skills']) == 3:
            x = portaltotext('rare')
        if len(summon['skills']) == 4:
            x = portaltotext('epic')
        if len(summon['skills']) == 5:
            x = portaltotext('legendary')
        em = x[0]
        if len(summon['skills']) == 5:
            kb.add(types.InlineKeyboardButton(text = em+summon['name'], callback_data = 'fighting_release_'+str(user['summons'][ids]['id'])+'_'+str(user['id'])+'_'+str(m.chat.id)))
    bot.send_message(user['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –õ–ï–ì–ï–ù–î–ê–†–ù–û–ì–û –±–æ—Å—Å–∞, —á—Ç–æ–±—ã –æ—Ç–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ, –≤ –ø–æ—Ç—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –º–∏—Ä. –ó–∞ —ç—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ üîÆ–≠–Ω–µ—Ä–≥–∏—é –ü—É—Å—Ç–æ—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –Ω—É–∂–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ‚ò£–ê–Ω–æ–º–∞–ª–∏–∏ –ü—É—Å—Ç–æ—Ç—ã. '+
                     '–†–∞—Å—Ü–µ–Ω–∫–∏:üí†–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π: 10000üîÆ', reply_markup = kb)

    
@bot.message_handler(commands=['craft_anomaly'])
def craftanomally(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
        
    if user['id'] not in crafting:
        bot.send_message(m.chat.id, '–î–ª—è –∫—Ä–∞—Ñ—Ç–∞ ‚ò£–ê–Ω–æ–º–∞–ª–∏–∏ –ü—É—Å—Ç–æ—Ç—ã –≤–∞–º –Ω—É–∂–Ω–æ 2500üîÆ –≠–Ω–µ—Ä–≥–∏–∏ –ü—É—Å—Ç–æ—Ç—ã. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –º–æ–∂–Ω–æ, —á—Ç–æ–±—ã '+
                         '–ø–æ–º–µ–Ω—è—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∫–∏–ª–ª –±–æ—Å—Å–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–ª—É—á–∞–π–Ω—ã–π. –î–ª—è –∫—Ä–∞—Ñ—Ç–∞ –µ—â—ë —Ä–∞–∑ –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É.')
        crafting.append(user['id'])
        threading.Timer(30, uncraft, args = [user['id']]).start()
    else:
        if user['void_energy'] >= 2500:
            users.update_one({'id':user['id']},{'$inc':{'void_energy':-2500, 'void_anomaly':1}})
            bot.send_message(m.chat.id, '–í—ã –ø–æ–∫–æ–ª–¥–æ–≤–∞–ª–∏, –¥–æ–±–∞–≤–∏–ª–∏ –≤ –∫–∏–ø—è—â–∏–π –∫–æ—Ç—ë–ª –ø–æ–ª–æ–≤–∏–Ω—É –∞–Ω–∞–Ω–∞—Å–∞, —â–∏–ø–æ—Ç–∫—É –æ–∫–µ–∞–Ω—Å–∫–æ–π —Å–æ–ª–∏, —Ä–∞—Å–ø—ã–ª–∏–ª–∏ –≠–Ω–µ—Ä–≥–∏—é –ü—É—Å—Ç–æ—Ç—ã - –∏ —É –≤–∞—Å –ø–æ–ª—É—á–∏–ª–∞—Å—å –æ–¥–Ω–∞ ‚ò£–ê–Ω–æ–º–∞–ª–∏—è –ü—É—Å—Ç–æ—Ç—ã!')
        else:
            bot.send_message(m.chat.id, '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –≠–Ω–µ—Ä–≥–∏–∏ –ü—É—Å—Ç–æ—Ç—ã!')
            
            
@bot.message_handler(commands=['use_anomaly'])
def craftanomally(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
        
    if m.from_user.id != m.chat.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
        
    if user['void_anomaly'] <= 0:
        bot.send_message(m.chat.id, '–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–∞ –æ–¥–Ω–∞ –ê–Ω–æ–º–∞–ª–∏—è –ü—É—Å—Ç–æ—Ç—ã (/craft_anomaly)!')
        return
    
    kb = types.InlineKeyboardMarkup()
    for ids in user['summons']:
        summon = user['summons'][ids]
        em = '?'
        if len(summon['skills']) == 2:
            x = portaltotext('typically')
        if len(summon['skills']) == 3:
            x = portaltotext('rare')
        if len(summon['skills']) == 4:
            x = portaltotext('epic')
        if len(summon['skills']) == 5:
            x = portaltotext('legendary')
        em = x[0]
        summon = user['summons'][ids]
        kb.add(types.InlineKeyboardButton(text = em+summon['name'], callback_data = 'fighting_choiceboss_'+str(user['summons'][ids]['id'])+'_'+str(user['id'])))
    
    bot.send_message(m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Å—Å–∞, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å —Å–∫–∏–ª–ª. –ó–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–ª–ª, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å. –ù–æ–≤—ã–π —Å–∫–∏–ª–ª –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–º (—Ç–µ–º –∂–µ —Å–∞–º—ã–º —Å—Ç–∞—Ç—å –Ω–µ –º–æ–∂–µ—Ç)!', reply_markup = kb)
    
            
            
@bot.message_handler(commands=['jesus'])
def jeasiuuus(m):
    if m.from_user.id not in [376001833, 441399484]:
        bot.send_message(m.chat.id, '–í—ã –Ω–µ –ò–∏—Å—É—Å!')
        return
    try:
        users.update_one({'id':m.reply_to_message.from_user.id},{'$set':{'drunk':0}})
        bot.send_message(m.chat.id, '–ò–∏—Å—É—Å '+m.from_user.first_name+' –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª –∞–ª–∫–æ–≥–æ–ª—å —É –≤–∞—Å –≤ –∫—Ä–æ–≤–∏ –≤ –≤–æ–¥—É!', reply_to_message_id = m.reply_to_message.message_id)
    except:
        bot.send_message(m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ, –∫–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∏—Å—É—Å–∏—Ç—å!')
        
        
def uncraft(id):
    try:
        crafting.remove(id)
    except:
        pass
        
    
    
@bot.callback_query_handler(func=lambda call: 'fighting' in call.data)
def fightsssss(call):
  try:
    user = users.find_one({'id':call.from_user.id})
    if user == None:
        return
    if call.data.split('_')[1] != 'choiceskill':
        if user['id'] != int(call.data.split('_')[3]):
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
    
    option = call.data.split('_')[1]
    if option == 'cancel':
        medit(call.from_user.first_name+' –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –≤—ã–∑–æ–≤!', call.message.chat.id, call.message.message_id)
        return
    elif option == 'go':
        nextt = False
        for ids in user['summons']:
            nextt = True
        if not nextt:
            medit(call.from_user.first_name+', —É –≤–∞—Å –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –±–æ—Å—Å–∞ –¥–ª—è —Å–æ—Å—Ç—è–∑–∞–Ω–∏—è!', call.message.chat.id, call.message.message_id)
            return
        if call.message.chat.id in fightgames:
            medit('–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –∏–¥—ë—Ç –±–∏—Ç–≤–∞!', call.message.chat.id, call.message.message_id)
            return
        user2 = users.find_one({'id':int(call.data.split('_')[2])})
        fightgames.update(createfightgame(call.message.chat.id, int(call.data.split('_')[2]), int(call.data.split('_')[3]), user2['name'], user['name']))
        medit('–ü–æ—Ö–æ–∂–µ, —Å–µ–π—á–∞—Å –±—É–¥–µ—Ç –∂–∞—Ä–∫–æ... –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏, –ø–æ–º–æ–≥–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∏–Ω–≥! –ë–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!', call.message.chat.id, call.message.message_id)
        name2 = user2['name']
        bot.send_message(call.message.chat.id, user['name']+', '+name2+', –≤—ã–±–∏—Ä–∞–π—Ç–µ –±–æ—Å—Å–æ–≤ –¥–ª—è —Å–æ—Å—Ç—è–∑–∞–Ω–∏—è —É –º–µ–Ω—è –≤ –õ–°. –ï—Å–ª–∏ –∑–∞ 2 –º–∏–Ω—É—Ç—ã –≤—ã —ç—Ç–æ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–µ—Ç–µ, –ø–æ–µ–¥–∏–Ω–æ–∫ –æ—Ç–º–µ–Ω–∏—Ç—Å—è!')
        
        try:
            kb = types.InlineKeyboardMarkup()
            for ids in user['summons']:
                summon = user['summons'][ids]
                em = '?'
                if len(summon['skills']) == 2:
                    x = portaltotext('typically')
                if len(summon['skills']) == 3:
                    x = portaltotext('rare')
                if len(summon['skills']) == 4:
                    x = portaltotext('epic')
                if len(summon['skills']) == 5:
                    x = portaltotext('legendary')
                em = x[0]
                kb.add(types.InlineKeyboardButton(text = em+user['summons'][ids]['name'], callback_data = 'fighting_select_'+str(user['summons'][ids]['id'])+'_'+str(user['id'])+'_'+str(call.message.chat.id)))
            bot.send_message(user['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –±–æ–π—Ü–∞ –¥–ª—è —Å–æ—Å—Ç—è–∑–∞–Ω–∏—è –Ω–∞ —Ä–∏–Ω–≥–µ "'+call.message.chat.title+'"!', reply_markup = kb)
        
            kb = types.InlineKeyboardMarkup()
            for ids in user2['summons']:
                summon = user2['summons'][ids]
                em = '?'
                if len(summon['skills']) == 2:
                    x = portaltotext('typically')
                if len(summon['skills']) == 3:
                    x = portaltotext('rare')
                if len(summon['skills']) == 4:
                    x = portaltotext('epic')
                if len(summon['skills']) == 5:
                    x = portaltotext('legendary')
                em = x[0]
                kb.add(types.InlineKeyboardButton(text = em+user2['summons'][ids]['name'], callback_data = 'fighting_select_'+str(user2['summons'][ids]['id'])+'_'+str(user2['id'])+'_'+str(call.message.chat.id)))
            bot.send_message(user2['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –±–æ–π—Ü–∞ –¥–ª—è —Å–æ—Å—Ç—è–∑–∞–Ω–∏—è –Ω–∞ —Ä–∏–Ω–≥–µ "'+call.message.chat.title+'"!', reply_markup = kb)
        except:
            bot.send_message(call.message.chat.id, '–ê, –Ω–µ—Ç... –ö—Ç–æ-—Ç–æ –∏–∑ –≤–∞—Å –Ω–µ –æ—Ç–∫—Ä—ã–ª –õ–° —Å–æ –º–Ω–æ–π! –û—Ç–º–µ–Ω—è—é –ø–æ–µ–¥–∏–Ω–æ–∫.')
            bot.send_message(441399484, traceback.format_exc())
            del fightgames[call.message.chat.id]
            return
        game = fightgames[call.message.chat.id]
        t = threading.Timer(120, endselect, args = [game])
        t.start()
        game['choicetimer'] = t
        
    elif option == 'select':
        game = fightgames[int(call.data.split('_')[4])]
        if call.from_user.id != game['user1'] and call.from_user.id != game['user2']:
            medit('–í–∞—Å –Ω–µ—Ç –≤ —ç—Ç–æ–π –∏–≥—Ä–µ!', call.message.chat.id, call.message.message_id)
            return
        if game['started']:
            medit('–ò–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å!', call.message.chat.id, call.message.message_id)
            return
        boss = call.data.split('_')[2]
        bs = None
        for ids in user['summons']:
            if str(user['summons'][ids]['id']) == str(boss):
                bs = user['summons'][ids]
        if bs == None:
            bot.answer_callback_query(call.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –±–æ—Å—Å–∞!')
            return
        else:
            if call.from_user.id == game['user1']:
                us = '1'
            else:
                us = '2'
            game['fighter'+us] = bs
            medit('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–ª–∏ –±–æ—Å—Å–∞ "'+bs['name']+'"!', call.message.chat.id, call.message.message_id)
            checkfightready(game)
            
    elif option == 'release':
        boss = call.data.split('_')[2]
        bs = None
        for ids in user['summons']:
            if str(user['summons'][ids]['id']) == str(boss):
                bs = user['summons'][ids]
        if bs == None:
            bot.answer_callback_query(call.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –±–æ—Å—Å–∞!')
            return
        
        summon = bs
        em = '?'
        if len(summon['skills']) == 2:
            x = portaltotext('typically')
            energy = 150
        if len(summon['skills']) == 3:
            x = portaltotext('rare')
            energy = 250
        if len(summon['skills']) == 4:
            x = portaltotext('epic')
            energy = 1000
        if len(summon['skills']) == 5:
            x = portaltotext('legendary')
            energy = 10000
        em = x[0]
        
        users.update_one({'id':user['id']},{'$unset':{'summons.'+str(bs['id']):1}})
        users.update_one({'id':user['id']},{'$inc':{'void_energy':energy}})
        medit('–í—ã–±—Ä–∞–Ω –±–æ—Å—Å: '+bs['name']+'.', call.message.chat.id, call.message.message_id)
        bot.send_message(call.message.chat.id, '–í—ã –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –±–æ—Å—Å–∞ '+bs['name']+' –æ–±—Ä–∞—Ç–Ω–æ –≤ –µ–≥–æ –º–∏—Ä... –ò–∑ –æ—Ç–∫—Ä—ã–≤—à–µ–≥–æ—Å—è –ø–æ—Ä—Ç–∞–ª–∞ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ '+str(energy)+'üîÆ.')
        
    elif option == 'choiceboss':
        bs = None
        for ids in user['summons']:
            if str(user['summons'][ids]['id']) == call.data.split('_')[2]:
                bs = user['summons'][ids]
        if bs == None:
            medit('–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –±–æ—Å—Å–∞!', call.message.chat.id, call.message.message_id)
            
        kb = types.InlineKeyboardMarkup()
        for ids in bs['skills']:
            kb.add(types.InlineKeyboardButton(text = getskill(ids), callback_data = 'fighting_choiceskill_'+str(bs['id'])+' '+ids+' '+str(user['id'])))
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∏–ª–ª –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–ª—É—á–∞–π–Ω—ã–π. –í—ã–±—Ä–∞–Ω–Ω—ã–π –±–æ—Å—Å: '+bs['name']+'.', call.message.chat.id, call.message.message_id, reply_markup = kb)
        
    elif option == 'choiceskill':
        bb = call.data.split('_')[2].split(' ')[0]
        
        bs = None
        for ids in user['summons']:
            if str(user['summons'][ids]['id']) == bb:
                bs = user['summons'][ids]
        if bs == None:
            medit('–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –±–æ—Å—Å–∞!', call.message.chat.id, call.message.message_id)
            
        skill = call.data.split(' ')[1]
        if skill not in bs['skills']:
            print(bs['skills'])
            print(skill)
            medit('–£ —ç—Ç–æ–≥–æ –±–æ—Å—Å–∞ –Ω–µ—Ç –¥–∞–Ω–Ω–æ–≥–æ —Å–∫–∏–ª–ª–∞!', call.message.chat.id, call.message.message_id)
            return
        
        if user['void_anomaly'] <= 0:
            medit('–£ –≤–∞—Å –Ω–µ—Ç –ê–Ω–æ–º–∞–ª–∏–π –ü—É—Å—Ç–æ—Ç—ã!', call.message.chat.id, call.message.message_id)
            return
        
        new_skill = random.choice(all_boss_skills)
        while new_skill in bs['skills']:
            new_skill = random.choice(all_boss_skills)
        users.update_one({'id':user['id']},{'$pull':{'summons.'+str(bs['id'])+'.skills': skill}})
        users.update_one({'id':user['id']},{'$push':{'summons.'+str(bs['id'])+'.skills': new_skill}})
        users.update_one({'id':user['id']},{'$inc':{'void_anomaly':-1}})
        medit('–í—ã –≤—ã–∑–≤–∞–ª–∏ –±–æ—Å—Å–∞, —Ä–∞–∑–±–∏–ª–∏ –∞–Ω–æ–º–∞–ª–∏—é –ø—É—Å—Ç–æ—Ç—ã –∏ –ø—Ä–æ–∏–∑–Ω–µ—Å–ª–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ... –ï–≥–æ —Å–∫–∏–ª–ª "'+getskill(skill)+'" –ø–æ–º–µ–Ω—è–ª—Å—è –Ω–∞ "'+getskill(new_skill)+'"!', call.message.chat.id, call.message.message_id)
        
        
  except:
    bot.send_message(441399484, traceback.format_exc())
           


def endselect(game):
    try:
        bot.send_message(game['id'], '–í—Ä–µ–º—è –≤—ã–±–æ—Ä–∞ –±–æ–π—Ü–æ–≤ –≤—ã—à–ª–æ! –£–¥–∞–ª—è—é –∏–≥—Ä—É.')
        del fightgames[game['id']]
    except:
        bot.send_message(441399484, traceback.format_exc())
    

def checkfightready(game):
    if game['fighter1'] != None and game['fighter2'] != None:
        game['choicetimer'].cancel()
        threading.Timer(random.randint(1, 40)/10, startfightgame, args = [game]).start()
        
    else:
        pass

def createfightgame(gameid, user1, user2, user1name, user2name):
    return {gameid:{
        'id':gameid,
        'user1':user1,
        'user1name':user1name,
        'user2':user2,
        'user2name':user2name,
        'fighter1':None,
        'fighter2':None,
        'started':False,
        'msg':None,
        'turn':1,
        'timer':2,     # —Ä–∞–∑ –≤–æ —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–≥—Ä–∞
        'choicetimer':None,
        'spellids':0,
        'dmgtaken1':0,
        'dmgtaken2':0,
        'text':'',
        'starttime':time.time(),
        'lastturnfight':time.time()
    }
           }

        


def getmessage(game):
    text = ''
    f1 = game['fighter1']
    f2 = game['fighter2']
    text += '–ë–æ—Å—Å "'+f1['name']+'" ('+game['user1name']+'):\n'
    text += '  ‚ô•'+str(f1['hp'])+'/'+str(f1['maxhp'])+'\n'
    text += '  üíß'+str(f1['mp'])+'/'+str(f1['maxmp'])+' (üîº'+str(f1['mp_regen'])+')\n'
    text += '  ü•ä'+str(f1['dmg']+f1['dmg_bonus'])+' (üé≤'+str(f1['disp'])+')\n'
    text += '  üõ°'+str(f1['armor']+f1['armor_bonus'])+'\n'
    spd = f1['atkspeed']+f1['atkspeed_bonus']
    for ids in f1['set_speed']:
        if f1['set_speed'][ids]['duration'] > 0:
            spd = f1['set_speed'][ids]['bonus']
    if 'ninja' in f1['skills']:
        spd = spd*2   
    text += '  ü§∫'+str(spd)+'\n'
    if game['dmgtaken1'] > 0:
        text += '  üíî-'+str(game['dmgtaken1'])+'\n'
    elif game['dmgtaken1'] < 0:
        text += '  üíö+'+str(game['dmgtaken1'])[1:]+'\n'
    if f1['stunned'] > 0:
        text += '  üåÄ\n'
    fire = False
    for ids in f1['fire_damage']:
        if f1['fire_damage'][ids]['duration'] >= 1:
            fire = True
    if fire:
        text += '  üî•\n'
        
    text += '\n'
    text += '–ë–æ—Å—Å "'+f2['name']+'" ('+game['user2name']+'):\n'
    text += '  ‚ô•'+str(f2['hp'])+'/'+str(f2['maxhp'])+'\n'
    text += '  üíß'+str(f2['mp'])+'/'+str(f2['maxmp'])+' (üîº'+str(f2['mp_regen'])+')\n'
    text += '  ü•ä'+str(f2['dmg']+f2['dmg_bonus'])+' (üé≤'+str(f2['disp'])+')\n'
    text += '  üõ°'+str(f2['armor']+f2['armor_bonus'])+'\n'
    spd = f2['atkspeed']+f2['atkspeed_bonus']
    for ids in f2['set_speed']:
        if f2['set_speed'][ids]['duration'] > 0:
            spd = f2['set_speed'][ids]['bonus']
    if 'ninja' in f2['skills']:
        spd = spd*2   
    text += '  ü§∫'+str(spd)+'\n'
    if game['dmgtaken2'] > 0:
        text += '  üíî-'+str(game['dmgtaken2'])+'\n'
    elif game['dmgtaken2'] < 0:
        text += '  üíö+'+str(game['dmgtaken2'])[1:]+'\n'
    if f2['stunned'] > 0:
        text += '  üåÄ\n'
    fire = False
    for ids in f2['fire_damage']:
        if f2['fire_damage'][ids]['duration'] >= 1:
            fire = True
    if fire:
        text += '  üî•\n'
        
    text += '\n'
    text += '‚è≤: '+str(game['turn'])+' —Å–µ–∫.'
    return text
    
    
    

def startfightgame(game):
  try:
    if game['started'] == True:
        return
    game['started'] = True
    bot.send_message(441399484, str(game['fighter1']['name']))
    bot.send_message(441399484, str(game['fighter2']['name']))
        
    threading.Timer(game['timer'], next_turn_fight, args = [game]).start()
    
    game['fighter1'].update({'speedpoints':1, 'stunned':0, 'spend_mp':0, 'do_dmg':0, 'buff_armor':{}, 'buff_damage':{}, 'buff_speed':{},
                            'cds':{}, 'nexthits_dmg':{}, 'lost_armor':0, 'fire_damage':{}, 'hits_until_stun':3, 'set_speed':{}})
    
    game['fighter2'].update({'speedpoints':1, 'stunned':0, 'spend_mp':0, 'do_dmg':0, 'buff_armor':{}, 'buff_damage':{}, 'buff_speed':{},
                            'cds':{}, 'nexthits_dmg':{}, 'lost_armor':0, 'fire_damage':{}, 'hits_until_stun':3, 'set_speed':{}})
    
    fighters = [game['fighter1'], game['fighter2']]
    for ids in fighters:
        cf = ids
        if 'fat' in cf['skills']:
            cf['hp'] += 400
            cf['maxhp'] += 400
            cf['mp_regen'] -= 1
            cf['maxmp'] -= 80
            cf['mp'] -= 80
            
        if 'fast' in cf['skills']:
            cf['atkspeed'] += 2
            cf['dmg'] -= 10
            if 'berserk' in cf['skills']:
                cf['dmg'] -= 10
        
        if 'dec_armor' in cf['skills']:
            cf['maxmp'] += 50
            cf['mp'] += 50
            cf['armor'] += 7
            
        if 'mana_void' in cf['skills']:
            cf['mp_regen'] += 1
            cf['maxmp'] += 30
            cf['mp'] += 30
            
        if 'steel_body' in cf['skills']:
            cf['armor'] += 25
        
        if 'mana_steal' in cf['skills']:
            cf['maxmp'] += 50
            cf['mp'] += 50
            
        if 'gigant' in cf['skills']:
            cf['hp'] += 1000
            cf['maxhp'] += 1000
            cf['maxmp'] -= 150
            cf['mp'] -= 150
            cf['atkspeed'] -= 1
            cf['dmg'] += 100
            if 'berserk' in cf['skills']:
                cf['dmg'] += 100
            cf['disp'] += 25
  
        if 'fireball' in cf['skills']:
            cf['maxmp'] += 100
            cf['mp'] += 100
            cf['mp_regen'] += 3
            
        if 'weakness' in cf['skills']:
            cf['maxmp'] += 50
            cf['mp'] += 50
            
        if 'blood_ritual' in cf['skills']:
            cf['maxhp'] += 150
            cf['hp'] += 150
            
        if 'mana_explosion' in cf['skills']:
            cf['maxmp'] += 100
            cf['mp'] += 100
            
        if 'zombie' in cf['skills']:
            cf['zombie'] += 1
            
        if 'warrior' in cf['skills']:
            cf['dmg'] += 60
            if 'berserk' in cf['skills']:
                cf['dmg'] += 60
            cf['disp'] += 50
            cf['hp'] -= 150
            cf['maxhp'] -= 150
            cf['armor'] -= 5
            
        if 'titan_body' in cf['skills']:
            cf['armor'] += 50
            cf['hp'] -= 300
            cf['maxhp'] -= 300
            
        if 'bower' in cf['skills']:
            cf['disp'] += 100
            cf['mp'] += 100
            cf['maxmp'] += 100
            cf['dmg'] += 25
            
        if 'mana_monster' in cf['skills']:
            cf['mp_regen'] += 7
            cf['mp'] += 400
            cf['maxmp'] += 400
            
        if 'death_beam' in cf['skills']:
            cf['mp_regen'] += 1
            cf['mp'] += 50
            cf['maxmp'] += 50
            
        if 'big' in cf['skills']:
            cf['hp'] = cf['hp']*2
            cf['maxhp'] = cf['maxhp']*2
            cf['mp'] = cf['mp']*2
            cf['maxmp'] = cf['maxmp']*2
            
            coef = 1.5
            if 'berserk' in cf['skills']:
                coef = coef*2
            cf['dmg'] = int(cf['dmg']/coef)
            cf['mp_regen'] -= 3
            
        if 'antimage' in cf['skills']:
            cf['hp'] += (cf['maxmp']*2)
            cf['maxhp'] += (cf['maxmp']*2)
            cf['maxmp'] = 0
            cf['mp'] = 0
            
        if 'thorns' in cf['skills']:
            cf['hp'] -= 100
            cf['maxhp'] -= 100
            
        if 'mana_block' in cf['skills']:
            cf['mp_regen'] += 1
            
        if 'killer' in cf['skills']:
            cf['dmg'] += 100
            if 'berserk' in cf['skills']:
                cf['dmg'] += 100
            cf['atkspeed'] += 1
            cf['hp'] = int(cf['hp']/2)
            cf['maxhp'] = int(cf['maxhp']/2)
            
        if 'supremacy' in cf['skills']:
            cf['maxmp'] += 100
            cf['mp'] += 100
            cf['hp'] += 200
            cf['maxhp'] += 200
            cf['atkspeed'] += 1
            cf['mp_regen'] += 1
            cf['atkspeed'] += 1
            
        if 'regen' in cf['skills']:
            cf['hp'] += 100
            cf['maxhp'] += 100
            
        if 'assasin' in cf['skills']:
            cf['dmg'] += (4*cf['armor'])
            if 'berserk' in cf['skills']:
                cf['dmg'] += (4*cf['armor'])*1
            cf['armor'] = 0

    msg = bot.send_message(game['id'], getmessage(game))
    game['msg'] = msg
  except:
    bot.send_message(441399484, traceback.format_exc())
            
    
def next_turn_fight(game):
  try:
    game['lastturnfight'] = time.time()
    f1 = game['fighter1']
    f2 = game['fighter2']
    
    f1['mp'] += f1['mp_regen']
    if f1['mp'] > f1['maxmp']:
        f1['mp'] = f1['maxmp']
    f2['mp'] += f2['mp_regen']
    if f2['mp'] > f2['maxmp']:
        f2['mp'] = f2['maxmp']
        
    units = []
    units.append(f1)
    units.append(f2)
    for ids in units:
        f1 = ids
        speed = 0
        speed += (f1['atkspeed'] + f1['atkspeed_bonus'])/10
        
        for ids in f1['set_speed']:
            if f1['set_speed'][ids]['duration'] > 0:
                speed = f1['set_speed'][ids]['bonus']
                f1['set_speed'][ids]['duration'] -= 1
                
        if 'ninja' in f1['skills']:
            speed = speed*2
        if f1['stunned'] <= 0:
            f1['speedpoints'] += speed
            
        if f1['stunned'] <= 0:
            while f1['speedpoints'] >= 1:
                f1['speedpoints'] -= 1
                get_turn(game, f1)
        
        
    threading.Timer(game['timer'], end_turn_fight, args = [game]).start()
  except:
    bot.send_message(441399484, traceback.format_exc())
            
    
def end_turn_fight(game):
  try:
    units = [game['fighter1'], game['fighter2']]
    dead = []
    
    for ids in units:
        cf = ids
        if cf['id'] == game['fighter1']['id']:
            target = game['fighter2']
        else:
            target = game['fighter1']
        cf['armor_bonus'] = 0
        cf['dmg_bonus'] = 0
        cf['atkspeed_bonus'] = 0
    mdt = False
    for ids in units:
        cf = ids
        if cf['id'] == game['fighter1']['id']:
            target = game['fighter2']
            enm = '2'
            me = '1'
        else:
            target = game['fighter1']
            enm = '1'
            me = '2'
        cf['stunned'] -= 1
        #####################
        mp = cf['spend_mp']
        dmg = cf['do_dmg']
        ####################
        
        if 'regen' in target['skills']:
            dmg -= 5
        
        for ids in target['fire_damage']:
            if target['fire_damage'][ids]['duration'] >= 1:
                dmg += target['fire_damage'][ids]['bonus']
                target['mp'] -= target['fire_damage'][ids]['bonus']
                target['fire_damage'][ids]['duration'] -= 1
                
        if 'mana_block' in target['skills']:
            mana_block = dmg
            if target['mp'] < mana_block:
                mana_block = target['mp']
            target['mp'] -= mana_block
            dmg -= mana_block
        if 'mana_monster' not in cf['skills']:
            cf['mp'] -= mp
        else:
            cf['hp'] -= mp
        
        cf['spend_mp'] = 0
        if 'mana_vampire' in target['skills']:
            target['hp'] += cf['spend_mp']
            game['dmgtaken'+enm] -= cf['spend_mp']
            
        if cf['mp'] < 0:
            cf['mp'] = 0

        if 'thorns' in target['skills'] and random.randint(1, 100) <= 20:
            if 'mana_monster' not in cf['skills']:
                cf['hp'] -= dmg
            else:
                cf['mp'] -= dmg
            game['dmgtaken'+me] += dmg
            dmg = 0
            game['text'] += 'üí¢'+cf['name']+' –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω, –Ω–æ —à–∏–ø—ã —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç –µ–≥–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É!\n'
            
        if 'mana_monster' not in target['skills']:
            target['hp'] -= dmg
        else:
            target['mp'] -= dmg
        if cf['do_dmg'] != 0:
            mdt = True
        game['dmgtaken'+enm] += dmg
        cf['do_dmg'] = 0
        for ids in cf['buff_armor']:
            if cf['buff_armor'][ids]['duration'] >= 1:
                cf['armor_bonus'] += cf['buff_armor'][ids]['bonus']
                cf['buff_armor'][ids]['duration'] -= 1
                
        for ids in cf['buff_damage']:
            if cf['buff_damage'][ids]['duration'] >= 1:
                cf['dmg_bonus'] += cf['buff_damage'][ids]['bonus']
                cf['buff_damage'][ids]['duration'] -= 1
                
        for ids in cf['buff_speed']:
            if cf['buff_speed'][ids]['duration'] >= 1:
                cf['atkspeed_bonus'] += cf['buff_speed'][ids]['bonus']
                cf['buff_speed'][ids]['duration'] -= 1
                
        for ids in cf['cds']:
            cf['cds'][ids] -= 1  
            
        if 'mana_eat' in cf['skills']:
            cf['hp'] += (cf['mp_regen']*2)
            
        cf['armor'] -= cf['lost_armor']
        cf['lost_armor'] = 0
        if cf['hp'] > cf['maxhp']:
            cf['hp'] = cf['maxhp']
        if cf['mp'] > cf['maxmp']:
            cf['mp'] = cf['maxmp']
        if cf['mp'] < 0:
            cf['mp'] = 0
        
        if cf['hp'] <= 0 or ('mana_monster' in cf['skills'] and cf['mp'] <= 0):
            if cf['zombie'] <= 0:
                if 'death_revenge' in cf['skills']:
                    if cf['id'] == game['fighter1']['id']:
                       target = game['fighter2']
                       enm = '2'
                    else:
                       target = game['fighter1']
                       enm = '1'
                    game['text'] += 'üëÅÔ∏è‚Äçüó®Ô∏è|'+cf['name']+' –ø–æ–≥–∏–±–∞–µ—Ç, –Ω–æ –ø–µ—Ä–µ–¥ —Å–º–µ—Ä—Ç—å—é –≤–∑—ã–≤–∞–µ—Ç –∫ –ô–æ–≥–≥-–°–∞—Ä–æ–Ω—É...\n'
                    i = 0
                    while i < 3:
                        use_skill(game, cf, random.choice(active), True)
                        i+=1
                    if 'mana_monster' not in target['skills']:
                        target['hp'] -= cf['do_dmg']
                    else:
                        target['mp'] -= cf['do_dmg']
                        
                    if target['hp'] <= 0 or ('mana_monster' in target['skills'] and target['mp'] <= 0):
                        if target['zombie'] <= 0:
                            dead = [target]
                            game['text'] += 'üëÅÔ∏è‚Äçüó®Ô∏è|'+cf['name']+' —É–Ω–∏—á—Ç–æ–∂–∏–ª —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, –±—É–∫–≤–∞–ª—å–Ω–æ –≤—ã—Ä–≤–∞–≤ –ø–æ–±–µ–¥—É —É –Ω–µ–≥–æ –∏–∑ —Ä—É–∫ (–∏–ª–∏ —á—Ç–æ —Ç–∞–º —É –Ω–µ–≥–æ)!\n'
                            if game['text'] != '' or mdt:
                                try:
                                    medit(getmessage(game), game['id'], game['msg'].message_id)
                                except:
                                    pass
                                try:
                                    bot.send_message(game['id'], game['text'])
                                except:
                                    pass
                            end_game_fight(game, dead)
                            return
                            
                        else:
                            dead.append(cf)
                            game['text'] += 'üíÄ|'+target['name']+' —É–º–µ—Ä, –Ω–æ –≤–æ—Å–∫—Ä–µ—Å –≤ –≤–∏–¥–µ –∑–æ–º–±–∏!\n'
                    else:
                        dead.append(cf)
                        game['text'] += '‚ò†|'+cf['name']+' –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∏–ª —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ —Å–∏–ª–æ–π –ô–æ–≥–≥-–°–∞—Ä–æ–Ω–∞, –∏ –ø–æ–≥–∏–± –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ!\n'
                else:    
                    dead.append(cf)
            else:
                cf['zombie'] -= 1
                cf['hp'] = (cf['maxhp']/100)*25
                if 'mana_monster' in cf['skills']:
                    cf['mp'] = (cf['maxmp']/100)*25
                game['text'] += 'üíÄ|'+cf['name']+' —É–º–µ—Ä, –Ω–æ –≤–æ—Å–∫—Ä–µ—Å –≤ –≤–∏–¥–µ –∑–æ–º–±–∏!\n'
            
    for ids in units:
        cf = ids
        if cf['hp'] > cf['maxhp']:
            cf['hp'] = cf['maxhp']

    if game['text'] != '' or mdt:
        try:
            medit(getmessage(game), game['id'], game['msg'].message_id)
        except:
            pass
        try:
            bot.send_message(game['id'], game['text'])
        except:
            pass
        game['text'] = ''

    game['dmgtaken1'] = 0
    game['dmgtaken2'] = 0
        
            
    if len(dead) > 0:
        end_game_fight(game, dead)
    else:
        game['turn'] += 1
        threading.Timer(game['timer'], next_turn_fight, args = [game]).start()
        
  except:
    bot.send_message(441399484, traceback.format_exc())
            
         

        
def end_game_fight(game, dead):
  try:
    if len(dead) >= 2:
        try:
            bot.send_message(game['id'], '–ù–∏—á—å—è! –û–±–∞ –±–æ—Å—Å–∞ –º–µ—Ä—Ç–≤—ã! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.')
        except:
            pass
        del fightgames[game['id']]
    else:
        if dead[0]['id'] == game['fighter1']['id']:
            win = game['fighter2']
            loose = game['fighter1']
            name = game['user2name']
        else:
            win = game['fighter1']
            loose = game['fighter2']
            name = game['user1name']
        try:
            bot.send_message(game['id'], '–ò –Ω–∞—à –ø–æ–±–µ–¥–∏—Ç–µ–ª—å - '+win['name']+'! –ï–≥–æ –ø—Ä–∏–∑—ã–≤–∞—Ç–µ–ª—å - '+name+'! –¢–æ–ª–ø–∞ –ª–∏–∫—É–µ—Ç! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π!')
            bot.send_message(game['id'], '–ë–æ–π –æ–∫–æ–Ω—á–µ–Ω!')
        except:
            pass
        del fightgames[game['id']]
  except:
    bot.send_message(441399484, traceback.format_exc())
                   
        
    
def get_turn(game, boss):
    activ = False
    acts = ['attack']
    for ids in boss['skills']:
        if ids in active:
            activ = True
           
    if activ:
        acts.append('skill')
    act = random.choice(acts)
    if act == 'attack':
        do_hit(game, boss)
        
    elif act == 'skill':
        actives = []
        for ids in boss['skills']:
            if ids in active:
                needmana = getmanacost(ids)
                if 'mage' in boss['skills']:
                    needmana = int(needmana/2)
                if 'mana_monster' not in boss['skills']:
                    if needmana <= boss['mp']:
                        if ids not in boss['cds']:
                            actives.append(ids)
                        elif boss['cds'][ids] <= 0:
                            actives.append(ids)
                else:
                    if needmana < boss['hp']:
                        if ids not in boss['cds']:
                            actives.append(ids)
                        elif boss['cds'][ids] <= 0:
                            actives.append(ids)
        if len(actives) > 0:
            skill = random.choice(actives)
            use_skill(game, boss, skill)
        else:
            do_hit(game, boss)
 

female = ['–ê—Ä–∏—Å—è', '–í–∞–Ω–µ—Å—Å–∞', '–ò–ª–ª–∏–∞–¥–∞', '–†—ç–º', '–¢–∏—Ä–∏—Å—Å']
    
    
def do_hit(game, boss):
    
    if game['fighter1']['id'] == boss['id']:
        target = game['fighter2']
        me = '1'
    else:
        target = game['fighter1']
        me = '2'
    dmg = random.randint(boss['dmg']-boss['disp'], boss['dmg']+boss['disp'])
    dmg += boss['dmg_bonus']
    if 'berserk' in boss['skills']:
        dmg += boss['dmg_bonus']*1
    for ids in boss['nexthits_dmg']:
        if boss['nexthits_dmg'][ids]['duration'] >= 1:
            dmg += boss['nexthits_dmg'][ids]['bonus']
            boss['nexthits_dmg'][ids]['duration'] -= 1
            
    if 'shield_fight' in boss['skills']:
        boss['lost_armor'] += 1
        dmg += boss['armor']
    
    if 'pierce_claws' not in boss['skills']:
        dmg -= (target['armor'] + target['armor_bonus'])
    d = '–ª'
    if boss['name'] in female:
        d = '–ª–∞'
    if 'gigant' in boss['skills']:
        if random.randint(1, 100) <= 20:
            target['stunned'] += 5
            game['text'] += 'üåÄ|'+boss['name']+' –æ–≥–ª—É—à–∏'+d+' —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã!\n'
            
    if 'strong_hit' in boss['skills']:
        if boss['hits_until_stun'] <= 0:
            target['stunned'] += 4
            game['text'] += 'üåÄ|'+boss['name']+' —á–µ—Ç–≤—ë—Ä—Ç—ã–º —É–¥–∞—Ä–æ–º –æ–≥–ª—É—à–∏'+d+' —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã!\n'
            boss['hits_until_stun'] = 3
        else:
            boss['hits_until_stun'] -= 1
            
            
    if dmg < 0:
        dmg = 0
    if 'vampire' in boss['skills']:
        target['do_dmg'] -= int((dmg/100)*15)
        
    if dmg > 0:    
        boss['do_dmg'] += dmg
        
    if 'fire_hands' in boss['skills']:
        target['fire_damage'].update({getskillid(game):{'bonus':20, 'duration':3}})
    
    
def use_skill(game, boss, skill, notspendmana = False):
    d = '–ª'
    h = '–ï–≥–æ'
    if boss['name'] in female:
        d = '–ª–∞'
        h = '–ï—ë'
    cd = 0
    if game['fighter1']['id'] == boss['id']:
        target = game['fighter2']
        me = '1'
    else:
        target = game['fighter1']
        me = '2'
    mp = 0
    mp = getskill(skill, 'mana')
    if 'magic_shield' in target['skills'] and random.randint(1, 100) <= 20:
        game['text'] += 'üî∑|'+boss['name']+' –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ, –Ω–æ —Å–æ–ø–µ—Ä–Ω–∏–∫ –æ—Ç–º–µ–Ω—è–µ—Ç –µ–≥–æ –º–∞–≥–∏—á–µ—Å–∫–∏–º —â–∏—Ç–æ–º!\n'
        
    elif skill == 'dec_armor':
        mp = 45
        target['buff_armor'].update({getskillid(game):{'bonus':-50, 'duration':10}})
        game['text'] += '‚è¨|'+boss['name']+' —Å–Ω–∏–∂–∞–µ—Ç –±—Ä–æ–Ω—é —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 50 –Ω–∞ 10 —Å–µ–∫—É–Ω–¥!\n'
        cd = 8
            
    elif skill == 'mana_void':
        mp = 120
        boss['do_dmg'] += target['maxmp']
        cd = 16
        game['text'] += 'üíî|'+boss['name']+' –≤–∑—Ä—ã–≤–∞–µ—Ç –º–∞–Ω—É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ '+str(target['maxmp'])+' —É—Ä–æ–Ω–∞!\n'
    
    elif skill == 'shield_smash':
        mp = 15
        boss['do_dmg'] += (boss['armor']+boss['armor_bonus'])*3
        cd = 5
        game['text'] += 'üíî|'+boss['name']+' –±—å—ë—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ —â–∏—Ç–æ–º –Ω–∞ '+str((boss['armor']+boss['armor_bonus'])*3)+' —É—Ä–æ–Ω–∞!\n'
        
    elif skill == 'rage':
        boss['buff_damage'].update({getskillid(game):{'bonus':50, 'duration':10}})
        boss['buff_speed'].update({getskillid(game):{'bonus':3, 'duration':10}})
        boss['buff_armor'].update({getskillid(game):{'bonus':-15, 'duration':10}})
        cd = 16
        game['text'] += '‚è´|'+boss['name']+' –≤—Ö–æ–¥–∏—Ç –≤ —è—Ä–æ—Å—Ç—å –∏ –ø–æ–≤—ã—à–∞–µ—Ç —Å–≤–æ–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (—É—Ä–æ–Ω+50, —Å–∫–æ—Ä–æ—Å—Ç—å+3, –±—Ä–æ–Ω—è-15) –Ω–∞ 10 —Å–µ–∫—É–Ω–¥!\n'
        
    elif skill == 'fireball':
        mp = 200
        boss['do_dmg'] += boss['maxmp']
        cd = 21
        game['text'] += 'üíî|'+boss['name']+' —Å–æ–∑–¥–∞—ë—Ç –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ –≤ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ '+str(boss['maxmp'])+' —É—Ä–æ–Ω–∞!\n'
        
        
    elif skill == 'demon_inside':
        mp = 100
        boss['nexthits_dmg'].update({getskillid(game):{'bonus':200, 'duration':1}})
        cd = 21
        game['text'] += '‚è´|'+boss['name']+' –≤—ã–ø—É—Å–∫–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–µ–º–æ–Ω–∞! '+h+' —Å–ª–µ–¥—É—é—â–∞—è –∞—Ç–∞–∫–∞ –Ω–∞–Ω–µ—Å—ë—Ç –Ω–∞ 200 —É—Ä–æ–Ω–∞ –±–æ–ª—å—à–µ!\n'

        
    elif skill == 'weakness':
        mp = 80
        target['buff_damage'].update({getskillid(game):{'bonus':-50, 'duration':10}})
        cd = 16
        game['text'] += '‚è¨|'+boss['name']+' –æ—Å–ª–∞–±–ª—è–µ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞! –°–ª–µ–¥—É—é—â–∏–µ 10 —Å–µ–∫—É–Ω–¥ –æ–Ω –±—É–¥–µ—Ç –Ω–∞–Ω–æ—Å–∏—Ç—å –Ω–∞ 50 —É—Ä–æ–Ω–∞ –º–µ–Ω—å—à–µ!\n'

        
    elif skill == 'heal':
        mp = 40
        target['do_dmg'] -= 200
        cd = 11
        game['text'] += 'üíö|'+boss['name']+' –ª–µ—á–∏—Ç—Å—è –Ω–∞ 200 –•–ü!\n'

        
    elif skill == 'blood_ritual':
        boss['do_dmg'] += int((boss['maxhp']/100)*20 * 2)
        target['do_dmg'] += int((boss['maxhp']/100)*20)
        cd = 14
        game['text'] += 'üíî|'+boss['name']+' –∂–µ—Ä—Ç–≤—É–µ—Ç '+str(int((boss['maxhp']/100)*20))+' –•–ü –¥–ª—è –Ω–∞–Ω–µ—Å–µ–Ω–∏—è —É—Ä–æ–Ω–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫—É! –¢–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç '+str(int((boss['maxhp']/100)*20 * 2))+' —É—Ä–æ–Ω–∞!\n'

        
    elif skill == 'speed_steal':
        mp = 80
        boss['buff_speed'].update({getskillid(game):{'bonus':1, 'duration':15}})
        target['buff_speed'].update({getskillid(game):{'bonus':-1, 'duration':15}})
        cd = 23 
        game['text'] += '‚è´‚è¨|'+boss['name']+' –∫—Ä–∞–¥—ë—Ç —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ 1 —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 15 —Å–µ–∫—É–Ω–¥!\n'
            
    elif skill == 'mana_explosion':
        mp = 100
        boss['do_dmg'] += target['mp']
        cd = 20
        game['text'] += 'üíî|'+boss['name']+' –≤—ã–∂–∏–≥–∞–µ—Ç –º–∞–Ω—É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞. –¢–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç '+str(target['mp'])+' —É—Ä–æ–Ω–∞!\n'
           
            
    elif skill == 'firegun':
        mp = 100
        boss['do_dmg'] += (target['armor']*6)
        cd = 12
        game['text'] += 'üî•|'+boss['name']+' –ü–æ–¥–∂–∏–≥–∞–µ—Ç –≤—Ä–∞–≥–∞! –ó–∞—â–∏—â–∞–≤—à–∞—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –±—Ä–æ–Ω—è –ø–æ–¥–∂–∞—Ä–∏–ª–∞ –µ–≥–æ –Ω–∞ '+str(target['armor']*6)+' —É—Ä–æ–Ω–∞!\n'
           
            
    elif skill == 'time_control':
        mp = 100
        boss['buff_speed'].update({getskillid(game):{'bonus':20, 'duration':1}})
        cd = 7
        game['text'] += '‚è≥|'+boss['name']+' –º–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–µ–º, –ø–æ–ª—É—á–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ 20 —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ–∫—É–Ω–¥—É!\n'
           
            
    elif skill == 'death_beam':
        mp = 50
        boss['do_dmg'] += 100
        target['do_dmg'] -= 100
        cd = 10
        game['text'] += 'üíîüíö|'+boss['name']+' –≤—ã–ø—É—Å–∫–∞–µ—Ç –∏–∑ –≥–ª–∞–∑ –ª—É—á —Å–º–µ—Ä—Ç–∏, –Ω–∞–Ω–æ—Å—è —Å–æ–ø–µ—Ä–Ω–∏–∫—É '+str(100)+' —É—Ä–æ–Ω–∞, –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è —Å–µ–±–µ —Å—Ç–æ–ª—å–∫–æ –∂–µ –•–ü!\n'
           
            
    elif skill == 'void_blast':
        boss['do_dmg'] += int((target['maxhp']/100)*35)
        cd = 99999
        game['text'] += 'üñ§|'+boss['name']+' –≤–∑—ã–≤–∞–µ—Ç –∫ —Å–∏–ª–∞–º –ü—É—Å—Ç–æ—Ç—ã, –≤—ã—Ç—è–≥–∏–≤–∞—è –∏–∑ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ '+str(int((target['maxhp']/100)*35))+' –•–ü!\n'
        
        
    elif skill == 'mana_destroy':
        mp = 50
        cd = 16
        target['spend_mp'] += int((target['maxmp']/100)*70)
        game['text'] += '‚ö°|'+boss['name']+' —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç '+str(int((target['maxmp']/100)*60))+' –ú–ü —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!\n'
        
    elif skill == 'mana_drain':
        cd = 15
        target['spend_mp'] += int((target['maxmp']/100)*40)
        game['text'] += 'üíßüíî|'+boss['name']+' –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç '+str(int((target['maxmp']/100)*40))+' –ú–ü —É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, –Ω–∞–Ω–æ—Å—è —Å—Ç–æ–ª—å–∫–æ –∂–µ —É—Ä–æ–Ω–∞!\n'
        boss['do_dmg'] += int((target['maxmp']/100)*40)
        
    elif skill == 'frost_arrow':
        cd = 13
        boss['do_dmg'] += int(target['atkspeed']*75)
        boss['set_speed'].update({getskillid(game):{'bonus':1, 'duration':5}})
        game['text'] += '‚ùÑ|'+boss['name']+' —Å–æ–∑–¥–∞—ë—Ç –ª–µ–¥—è–Ω—É—é —Å—Ç—Ä–µ–ª—É –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ—ë –≤ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, –Ω–∞–Ω–æ—Å—è '+str(target['atkspeed']*75)+' —É—Ä–æ–Ω–∞ –∏ —Å–Ω–∏–∂–∞—è –µ–≥–æ —Å–∫–æ—Ä–æ—Å—Ç—å —Ö–æ–¥–∞ –¥–æ 1 –Ω–∞ 5 —Å–µ–∫—É–Ω–¥!\n'
  
    elif skill == 'wind_fury':
        cd = 26
        boss['do_dmg'] += 500
        game['text'] += 'üå™|'+boss['name']+' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —É—Ä–∞–≥–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–Ω–æ—Å–∏—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫—É 500 —É—Ä–æ–Ω–∞!\n'
        
    elif skill == 'light_charge':
        cd = 2
        boss['do_dmg'] += 65
        game['text'] += 'üå©|'+boss['name']+' —Å–æ–∑–¥–∞—ë—Ç –º–æ–ª–Ω–∏—é, –∏ –±—å—ë—Ç –µ–π —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–∞ 65 —É—Ä–æ–Ω–∞!\n'
  
    if 'mage' in boss['skills']:
        cd = int(cd/2)
        mp = int(mp/2)
        
    if not notspendmana:
        boss['spend_mp'] += int(mp)
    
    if not notspendmana:
        if skill not in boss['cds']:
            boss['cds'].update({skill:cd})
        else:
            boss['cds'][skill] = cd
        
    if 'magic_mirror' in target['skills'] and random.randint(1, 100) <= 20:
        game['text'] += '‚ú°|'+boss['name']+' –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ... –ù–æ –µ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫ –¥–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ!\n'
        use_skill(game, target, skill, True)
            
 

def getskillid(game):
    x = game['spellids']
    game['spellids'] += 1
    return x
  
    

cooks = {   
            '–ù–æ–≤–∏—á–æ–∫':{
                'strenght':15,
                'agility':10,
                'intelligence':1,
                'luck':20,
                'cooking_skill':1,
                'drunk':0,
                'cost':25,
                'name':'–ù–æ–≤–∏—á–æ–∫'
            },
            '–õ—é–±–∏—Ç–µ–ª—å':{
                'strenght':20,
                'agility':1,
                'intelligence':20,
                'luck':15,
                'cooking_skill':10,
                'drunk':0,
                'cost':50,
                'name':'–õ—é–±–∏—Ç–µ–ª—å'
            },
            '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª':{
                'strenght':25,
                'agility':60,
                'intelligence':40,
                'luck':25,
                'cooking_skill':100,
                'drunk':0,
                'cost':90,
                'name':'–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª'
            
            }
        }


@bot.message_handler(commands=['enter_bar'])
def enterbar(m):
    pass

@bot.message_handler(commands=['givebee'])
def givebee(m):
    if m.from_user.id == 441399484:
        try:
            users.update_one({'id':m.reply_to_message.from_user.id},{'$inc':{'beecoins':int(m.text.split(' ')[1])}})
            beecoins.update_one({},{'$inc':{'beecoins':-int(m.text.split(' ')[1])}})
            bot.send_message(m.chat.id, 'Success!')

        except:
            bot.send_message(m.chat.id, 'Error!')

@bot.message_handler(commands=['barwork'])
def helpwork(m):
  try:
    if m.from_user.id in block:
        return
    global mainchat
    if m.chat.id != mainchat and m.chat.id != -1001478240928:
        bot.send_message(m.chat.id, '–ü–æ–∫–∞ —á—Ç–æ —ç—Ç–∞ –æ–ø—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —á–∞—Ç–µ –∏–≥—Ä—ã!')
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['drunk'] >= 100:
        bot.send_message(m.chat.id, '–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç—Ä–µ–∑–≤–µ–π, –∞ –ø–æ—Ç–æ–º —Ä–∞–±–æ—Ç–∞–π!')
        return
    if time.time() - user['afk_until'] < 0:
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    if user['working']:
        bot.send_message(m.chat.id, '–í—ã —É–∂–µ –∑–∞–Ω—è—Ç—ã –¥–µ–ª–æ–º!')
        return
    works = []
    x = beecoins.find_one({})
    for ids in x['works']:
        if x['works'][ids] == True:
            works.append(ids)
    if 'barmenready' in works and user['cooking_skill'] < 15:
        works.remove('barmenready')
    if len(works) == 0:
        bot.send_message(m.chat.id, '_–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞_: –ü–æ–¥—Ö–æ–¥—è—â–µ–π —Ç–µ–±–µ —Ä–∞–±–æ—Ç—ã –≤ –±–∞—Ä–µ —Å–µ–π—á–∞—Å –Ω–µ—Ç, –ø—Ä–∏—Ö–æ–¥–∏ –ø–æ–∑–∂–µ.', parse_mode = 'markdown')
        return
    users.update_one({'id':user['id']},{'$set':{'working':True}})
    work = random.choice(works)
    text = '–û—à–∏–±–∫–∞, @Loshadkin.'
    if work == 'cleanready':
        text = '_–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞_: –¢–∞–∫... –í –±–∞—Ä–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–∏—Ç–æ–≥–æ —Å—Ç–µ–∫–ª–∞, —É–±–æ—Ä—â–∏–∫–∏ –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è. –ù–∞—á–∏–Ω–∞–π —É–±–æ—Ä–∫—É, —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—é.'
        t = 600
    elif work == 'barmenready':
        text = '_–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞_: –ù–∞—à–∏ –±–∞—Ä–º–µ–Ω—ã –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∑–∞–∫–∞–∑–∞–º–∏. –ü–æ–º–æ–≥–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ —Ö–æ—Ç—è –±—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 20 –º–∏–Ω—É—Ç.'
        t = 1200
    elif work == 'changelightready':
        text = '_–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞_: –í –±–∞—Ä–µ —Å–ª–æ–º–∞–ª–∞—Å—å –ª–∞–º–ø–æ—á–∫–∞. –î—É–º–∞—é, –ø—è—Ç–∏ –º–∏–Ω—É—Ç —Ç–µ–±–µ –Ω–∞ —ç—Ç–æ –¥–µ–ª–æ —Ö–≤–∞—Ç–∏—Ç.'
        t = 300
    elif work == 'fix_furniture':
        text = '_–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞_: –ü–æ—Å–ª–µ –æ—á–µ—Ä–µ–¥–Ω–æ–π –¥—Ä–∞–∫–∏ –≤ –±–∞—Ä–µ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å —Ü–µ–ª–æ–π –º–µ–±–µ–ª–∏... –ü–æ—á–∏–Ω–∏ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É —Å—Ç—É–ª—å–µ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç.'
        t = 900
    threading.Timer(t, endwork, args = [user, work, m.chat.id]).start()
    
    beecoins.update_one({},{'$set':{'works.'+work:False}})
    if work != 'cleanready':
        resetwork(work, False)
    bot.send_message(m.chat.id, text, parse_mode = 'markdown', reply_to_message_id = m.message_id)
  except:
    bot.send_message(441399484, traceback.format_exc())
   
@bot.message_handler(commands=['hire_cook'])
def hirecook(m):
    if m.from_user.id in block:
        return
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ù–æ–≤–∏—á–æ–∫', callback_data = 'hire_new'))
    kb.add(types.InlineKeyboardButton(text = '–õ—é–±–∏—Ç–µ–ª—å', callback_data = 'hire_medium'))
    kb.add(types.InlineKeyboardButton(text = '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª', callback_data = 'hire_pro'))
    text = '–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ä–º–µ–Ω–∞, –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –Ω–∞–Ω—è—Ç—å –Ω–∞ —á–∞—Å. –û–Ω –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏.\n\n'
    for ids in cooks:
        text += '*'+ids+'*:\n'
        text += 'üí™–°–∏–ª–∞: '+str(cooks[ids]['strenght'])+'\n'
        text += 'ü§∫–õ–æ–≤–∫–æ—Å—Ç—å: '+str(cooks[ids]['agility'])+'\n'
        text += 'üß†–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: '+str(cooks[ids]['intelligence'])+'\n'
        text += 'üçÄ–£–¥–∞—á–∞: '+str(cooks[ids]['luck'])+'\n'
        text += 'ü•™–£–º–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–∏—Ç—å: '+str(cooks[ids]['cooking_skill'])+'\n'
        text += '–¶–µ–Ω–∞: '+str(cooks[ids]['cost'])+'üêù\n'
        text += '\n'
    bot.send_message(m.chat.id, text, reply_markup = kb, parse_mode='markdown', reply_to_message_id = m.message_id)
    
    
   
def resetwork(work, x):
    if x == True:
        beecoins.update_one({},{'$set':{'works.'+work:True}})
    else:
        if work == 'changelightready':
            t = random.randint(200, 400)
        elif work == 'barmenready':
            t = random.randint(1000, 1600)
        elif work == 'fix_furniture':
            t = random.randint(700, 1100)
        threading.Timer(t, resetwork, args = [work, True]).start()

def endwork(user, work, chat):
  try:
    coins = 0
    x = beecoins.find_one({})
    if work == 'cleanready':
        coins = int(x['beecoins']*0.0002)
    elif work == 'barmenready':
        coins = int(x['beecoins']*0.0004)
    elif work == 'changelightready':
        coins = int(x['beecoins']*0.0001)
    elif work == 'fix_furniture':
        coins = int(x['beecoins']*0.0003)
    name1 = config.make_safe_html(user['name'])
    bot.send_message(chat, '<a href="tg://user?id='+str(user['id'])+'">'+name1 + '</a>'+', —Ç—ã –Ω–µ–ø–ª–æ—Ö–æ –ø–æ—Ä–∞–±–æ—Ç–∞–ª. –î–µ—Ä–∂–∏ –Ω–∞–≥—Ä–∞–¥—É - '+str(coins)+'üêù.', parse_mode='html')
    users.update_one({'id':user['id']},{'$inc':{'beecoins':coins}})
    beecoins.update_one({},{'$inc':{'beecoins':-coins}})
    users.update_one({'id':user['id']},{'$set':{'working':False}})
  except:
    bot.send_message(441399484, traceback.format_exc())

users.update_many({},{'$set':{'now_cooking':False, 'wait_ings':False, 'working':False}})

#users.update_many({},{'$set':{'cook':None}})

for ids in users.find({}):
    if ids['current_drink'] != None:
        users.update_one({'id':ids['id']},{'$inc':{'current_supplies.'+ids['current_drink']+'.amount':6}})

        
#for ids in users.find({}):
#    pts = 0
#    pts += ids['strenght']-1
#    pts += ids['intelligence']-1
#    pts += ids['luck']-1
#    pts += ids['agility']-1
#    pts += ids['cooking_skill']-1
#    users.update_one({'id':ids['id']},{'$inc':{'lvlpoints':pts}})
#    users.update_one({'id':ids['id']},{'$set':{'strenght':1}})
#    users.update_one({'id':ids['id']},{'$set':{'intelligence':1}})
#    users.update_one({'id':ids['id']},{'$set':{'luck':1}})
#    users.update_one({'id':ids['id']},{'$set':{'agility':1}})
#    users.update_one({'id':ids['id']},{'$set':{'cooking_skill':1}})
#bot.send_message(441399484, '–°—Ç–∞—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã!')
    
    
games = {}
duels = {}
govnos1 = ['–º—è–≥–∫–∏–π', '–∂–∏–¥–∫–∏–π', '—Ç–≤–µ—Ä–¥—ã–π', '–≤–æ–Ω—é—á–∏–π', '–ø–æ–Ω–æ—Å–Ω—ã–π']
govnos2 = ['–ø–µ—Ä–¥—É–Ω', '–æ–±–æ—Å—Ä—ã—à', '–∫–∞–∫–∏—à', '–º—è–∫–∏—à', '–∫—É—Å–æ–∫', '—à–µ–ø—Ç—É–Ω']

toupdate = {'distance':0, 'stun':0, 'bonus':0, 'void':0}

horses = [
  {
    'name':'–ö—Ä–∞—Å–Ω–∞—è –ª–æ—à–∞–¥—å',
    'ability':'bkb',        # –ù–∞ –Ω–µ—ë –Ω–µ–ª—å–∑—è –ø–æ–≤–ª–∏—è—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏
    'index':1
  },
  {
    'name':'–°–∏–Ω—è—è –ª–æ—à–∞–¥—å',
    'ability':'accelerate',  # –ò–º–µ–µ—Ç —à–∞–Ω—Å —É—Å–∫–æ—Ä–∏—Ç—å—Å—è
    'index':2
  },
  {
    'name':'–ñ—ë–ª—Ç–∞—è –ª–æ—à–∞–¥—å',
    'ability':'hit',         # –ò–º–µ–µ—Ç —à–∞–Ω—Å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –æ–¥–∏–Ω —Ö–æ–¥ —Ä—è–¥–æ–º –±–µ–≥—É—â–∏—Ö –ª–æ—à–∞–¥–µ–π
    'index':3
  },
  {
    'name':'–ß—ë—Ä–Ω–∞—è –ª–æ—à–∞–¥—å',
    'ability':'stable',       # –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –±–µ–∂–∏—Ç —Å –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é
    'index':4
  },
  {
    'name':'–ú–æ—Ä–æ–∑–Ω–∞—è –ª–æ—à–∞–¥—å',
    'ability':'slowdown',      # –ó–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–Ω–¥–æ–º–Ω–æ–µ —á–∏—Å–ª–æ –ª–æ—à–∞–¥–µ–π –∫–∞–∂–¥—ã–π —Ö–æ–¥
    'index':5
  },
  {
    'name':'–ù–µ–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ª–æ—à–∞–¥—å',
    'ability':'random_move',    # –î–≤–∏–≥–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –∏–º–µ–µ—Ç —à–∞–Ω—Å –¥–≤–∏–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
    'index':6
  },
  {
    'name':'–î–æ—Ä–æ–≥–∞—è –ª–æ—à–∞–¥—å',
    'ability':'bonus_reward',   # –î–∞—ë—Ç –±–æ–Ω—É—Å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã —Ç–µ–º, –∫—Ç–æ –Ω–∞ –Ω–µ–µ –ø–æ—Å—Ç–∞–≤–∏–ª, –µ—Å–ª–∏ –∑–∞–Ω–∏–º–∞–µ—Ç —Ç–æ–ø-3
    'index':7
  },
  {
    'name':'–†–æ–±–æ-–ª–æ—à–∞–¥—å',
    'ability':'catch',    # –ë–µ–∂–∏—Ç –±—ã—Å—Ç—Ä–µ–µ, –µ—Å–ª–∏ –≤–ø–µ—Ä–µ–¥–∏ –µ—Å—Ç—å –ª–æ—à–∞–¥–∏
    'index':8
  },
  {
    'name':'–¢–æ–∫—Å–∏—á–Ω–∞—è –ª–æ—à–∞–¥—å',
    'ability':'kick',    # –ò–º–µ–µ—Ç —à–∞–Ω—Å –≤—ã–∫–∏–Ω—É—Ç—å –ª—é–±—É—é –ª–æ—à–∞–¥—å –∏–∑ –∏–≥—Ä—ã
    'index':9
  },
  {
    'name':'–ë—ã—Å—Ç—Ä–∞—è –ª–æ—à–∞–¥—å',
    'ability': 'small_reward',   # –ë—ã—Å—Ç—Ä–∞—è –ª–æ—à–∞–¥—å, –¥–∞—é—â–∞—è —É–º–µ–Ω—å—à–µ–Ω–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –ø–æ–±–µ–¥—É
    'index':10
  },
  {
      'name':'–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ—à–∞–¥—å',
      'ability':'teleport',
      'index':11
  },
  {
      'name':'–õ–æ—à–∞–¥—å-—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä',
      'ability':'change_distance',
      'index':12
  },
  {
      'name':'–õ–æ—à–∞–¥—å-–∫–æ–ª–¥—É–Ω',
      'ability':'coldun',
      'index':13
  },
  {
      'name':'–°–ª—É—á–∞–π–Ω–∞—è –ª–æ—à–∞–¥—å',
      'ability':'random_horse',
      'index':14
  },
    {
        'name':'–í–æ–π–¥-–ª–æ—à–∞–¥—å',
        'ability':'stoptime',
        'index':15
    }
]


alcos = {
    #'wine':{'name':'–í–∏–Ω–æ', 'exp':3, 'drunk':21, 'cost':200, 'owner':None, 'adress':'wine'},
    #'pivo':{'name':'–ü–∏–≤–æ', 'exp':1, 'drunk':7, 'cost':50, 'owner':None, 'adress':'pivo'},
    #'portvein':{'name':'–ü–æ—Ä—Ç–≤–µ–π–Ω', 'exp':4, 'drunk':23, 'cost':350, 'owner':None, 'adress':'portvein'},
    #'kumis':{'name':'–ö—É–º—ã—Å', 'exp':2, 'drunk':9, 'cost':150, 'owner':None, 'adress':'kumis'},
    #'koniak':{'name':'–ö–æ–Ω—å—è–∫', 'exp':6, 'drunk':49, 'cost':350, 'owner':None, 'adress':'koniak'},
    #'dzin':{'name':'–î–∂–∏–Ω', 'exp':7, 'drunk':45, 'cost':250, 'owner':None, 'adress':'dzin'},
    #'vodka':{'name':'–í–æ–¥–∫–∞', 'exp':1, 'drunk':40, 'cost':50, 'owner':None, 'adress':'vodka'},
    #'tekila':{'name':'–¢–µ–∫–∏–ª–∞', 'exp':6, 'drunk':34, 'cost':500, 'owner':None, 'adress':'tekila'},
    #'viski':{'name':'–í–∏—Å–∫–∏', 'exp':6, 'drunk': 39, 'cost':400, 'owner':None, 'adress':'viski'},
    #'yager':{'name':'–Ø–≥–µ—Ä', 'exp':9, 'drunk': 38, 'cost':500, 'owner':None, 'adress':'yager'}
    
}

foods = {
    
    
}

waits = []


for ids in users.find({}):
    for idss in ids['current_supplies']:
        s = ids['current_supplies'][idss]
        s.update({'adress':idss.replace(' ', '#')})
        try:
          #  if time.time() - s['date'] < 2592000:
                alcos.update({s['name']:s})
            #else:
         #       try:
        #            users.update_one({'id':ids['id']},{'$unset':{'current_supplies.'+idss:1}})
         #       except:
          #          bot.send_message(441399484, traceback.format_exc())
        #        try:
         #           bot.send_message(ids['id'], '–í—Ä–µ–º—è –≤–∞—à–µ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞ "'+s['name']+'" –∏—Å—Ç–µ–∫–ª–æ!')
        #        except:
       #             pass
        except:
            pass
    #for idss in ids['current_foods']:
   #     s = ids['current_foods'][idss]
 #       s.update({'adress':idss.replace(' ', '#')})
#        if time.time() - s['date'] < 2592000:
  #          foods.update({s['name']:s})
#        else:
 #           try:
  #              users.update_one({'id':ids['id']},{'$unset':{'current_foods.'+idss:1}})
    #        except:
 #               bot.send_message(441399484, traceback.format_exc())
#            try:
 #               bot.send_message(ids['id'], '–í—Ä–µ–º—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ "'+s['name']+'" –∏—Å—Ç–µ–∫–ª–æ!')
#            except:
#                pass

i = 0          
for ids in alcos:
    alcos[ids].update({'id':str(i)})
    x = users.find_one({'id':alcos[ids]['owner']})
    alcos[ids].update({'ownername':x['name']})
    users.update_one({'id':alcos[ids]['owner']},{'$set':{'current_supplies.'+alcos[ids]['name']+'.id':str(i)}})
    i+=1
    
i = 0          
for ids in foods:
    foods[ids].update({'id':str(i)})
    i+=1
          
        
            
def createplayer(user):
    return {user.id:{
        'id':user.id,
        'name':user.first_name,
        'bets':{}
    }
           }



def createchat(chat):
    return {
    'id':chat.id,
    'adminmode':False
    }

#def waitr(id):
#    try:
#        wait.remove(id)
#    except:
#        pass
#

#@bot.message_handler(commands=['cwork'])
#def cwork(m):
#    if m.from_user.id in wait:
#        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –±–∏–∫–æ–∏–Ω—ãüêù —Ä–∞–∑ –≤ 20 –º–∏–Ω—É—Ç!')
#        return
#    x = random.randint(1, 10)
#    users.update_one({'id':m.from_user.id},{'$inc':{'beecoins':x}})
#    wait.append(m.from_user.id)
#    bot.send_message(m.chat.id, '–ü–æ–ª—É—á–µ–Ω–æ '+str(x)+' –±–∏–∫–æ–∏–Ω–æ–≤üêù')
#    threading.Timer(20*60, waitr, args = [m.from_user.id]).start())

@bot.message_handler(commands=['switch_mode'])
def swm(m):
    user = bot.get_chat_member(m.chat.id, m.from_user.id)
    if user.status not in ['administrator', 'creator']:
        bot.send_message(m.chat.id, '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —ç—Ç–æ!')
        return
    chat = chats.find_one({'id':m.chat.id})
    if chat == None:
        chats.insert_one(createchat(m.chat))
        chat = chats.find_one({'id':m.chat.id})
    if chat['adminmode'] == False:
        s = True
        bot.send_message(m.chat.id, '–¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω —Å–º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞—á–∫–∏.')

    else:
        s = False
        bot.send_message(m.chat.id, '–¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–º–æ–≥—É—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞—á–∫–∏.')
    chats.update_one({'id':chat['id']},{'$set':{'adminmode':s}})
    
    


@bot.message_handler(commands=['start'])
def start(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['wait_ings'] == False:
        bot.send_message(m.chat.id, '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π! –≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–æ —Å–∫–∞—á–∫–∏ –ª–æ—à–∞–¥–µ–π. –ù–∞–∂–º–∏ /help, —á—Ç–æ–±—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ —É–∑–Ω–∞—Ç—å –æ–± –∏–≥—Ä–µ.')
    else:
      if m.from_user.id not in waits:
        if user['wait_ings'] == True:
            allow = False
            try:
                c = m.text.split(' ')[1]
                if c == user['code']:
                    allow = True
            except:
                pass
            if allow:
                users.update_one({'id':user['id']},{'$set':{'wait_ings':False}})
                bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω—É–∂–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã!')
            else:
                bot.send_message(m.chat.id, '–í—ã –Ω–µ –ø–µ—Ä–µ—à–ª–∏ –ø–æ –∫–Ω–æ–ø–∫–µ!')
                waits.append(m.from_user.id)
                threading.Timer(3, wremove, args = [m.from_user.id]).start()

 
def wremove(id):
    try:
        waits.remove(id)
    except:
        pass


@bot.message_handler(commands=['create_supply'])
def createsupply(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.chat.id != m.from_user.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    if user['supply'] == None:
        users.update_one({'id':user['id']},{'$set':{'supply':{'name':'–ù–∞–∑–≤–∞–Ω–∏–µ', 'drunk':30, 'cost':200}}})
        user = users.find_one({'id':m.from_user.id})
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ù–∞–∑–≤–∞–Ω–∏–µ', callback_data = 'set_name'))
    kb.add(types.InlineKeyboardButton(text = '–û–ø—å—è–Ω–µ–Ω–∏–µ', callback_data = 'set_drunk'))
    kb.add(types.InlineKeyboardButton(text = '–¶–µ–Ω–∞', callback_data = 'set_cost'))
    text = '–°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫, —á—Ç–æ–±—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É –µ–≥–æ –≤ –±–∞—Ä. –¶–µ–Ω–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –Ω–∞ –º–µ—Å—è—Ü - (—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞–ø–∏—Ç–∫–∞) –º–æ–Ω–µ—Ç. –í–∞–º –±—É–¥–µ—Ç –æ—Ç—á–∏—Å–ª—è—Ç—å—Å—è –ø–æ 100% –æ—Ç –µ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞ –ø–æ–∫—É–ø–∫—É. –¢–µ–∫—É—â–∏–π –Ω–∞–ø–∏—Ç–æ–∫:\n'
    text += '–ù–∞–∑–≤–∞–Ω–∏–µ: "'+user['supply']['name']+'"\n'
    text += '–û–ø—å—è–Ω–µ–Ω–∏–µ: '+str(user['supply']['drunk'])+'%\n'
    text += '–¶–µ–Ω–∞: '+str(user['supply']['cost'])+'üí∞'
    bot.send_message(m.chat.id, text, reply_markup = kb)
    
@bot.message_handler(commands=['create_food'])
def createfood(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.chat.id != m.from_user.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    if user['food'] == None:
        users.update_one({'id':user['id']},{'$set':{'food':{'name':'–ù–∞–∑–≤–∞–Ω–∏–µ', 'sitost':30, 'cost':200}}})
        user = users.find_one({'id':m.from_user.id})
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ù–∞–∑–≤–∞–Ω–∏–µ', callback_data = 'f_set_name'))
    kb.add(types.InlineKeyboardButton(text = '–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', callback_data = 'f_set_feed'))
    kb.add(types.InlineKeyboardButton(text = '–¶–µ–Ω–∞', callback_data = 'f_set_cost'))
    text = '–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç, —á—Ç–æ–±—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ—Å—Ç–∞–≤–∫—É –≤ –±–∞—Ä. –í–∞–º –±—É–¥–µ—Ç –æ—Ç—á–∏—Å–ª—è—Ç—å—Å—è –ø–æ 100% –æ—Ç –µ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞ –ø–æ–∫—É–ø–∫—É. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –≤ –Ω–∞–ª–∏—á–∏–∏. –ß–µ–º –≤—ã—à–µ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç–µ–º —Ç—è–∂–µ–ª–µ–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è. –¢–µ–∫—É—â–∏–π –ø—Ä–æ–¥—É–∫—Ç:\n'
    text += '–ù–∞–∑–≤–∞–Ω–∏–µ: "'+user['food']['name']+'"\n'
    text += '–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: '+str(user['food']['sitost'])+'%\n'
    text += '–¶–µ–Ω–∞: '+str(user['food']['cost'])+'üí∞'
    bot.send_message(m.chat.id, text, reply_markup = kb)
 

    
@bot.message_handler(commands=['deploy_food'])
def deploy_food(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.from_user.id != m.chat.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    
    if user['food'] == None:
        bot.send_message(m.chat.id, '–í—ã –µ—â—ë –Ω–µ –ø—Ä–æ–∏–∑–≤–µ–ª–∏ –ø—Ä–æ–¥—É–∫—Ç (/create_food)!')
        return
    if user['coins'] < user['food']['cost']:
        bot.send_message(m.chat.id, '–î–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω—É–∂–Ω–æ (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞) –º–æ–Ω–µ—Ç!')
        return
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ù–∞—á–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –±–∞—Ä', callback_data = 'deploy_food'))
    text = '–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≥–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –±–∞—Ä? –≠—Ç–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –≤–∞–º (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞) –º–æ–Ω–µ—Ç, –∏ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü '+\
    '–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è. –í–∞–º –±—É–¥–µ—Ç –æ—Ç—á–∏—Å–ª—è—Ç—å—Å—è 100% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–∫—É–ø–∫—É.\n'+\
    '–ò—Ç–æ–≥–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞:\n'
    text += '–ù–∞–∑–≤–∞–Ω–∏–µ: "'+user['food']['name']+'"\n'
    text += '–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: '+str(user['food']['sitost'])+'%\n'
    text += '–¶–µ–Ω–∞: '+str(user['food']['cost'])+'üí∞'
    bot.send_message(m.chat.id, text, reply_markup = kb)
    

@bot.message_handler(commands=['gauss'])
def gausss(m):
    try:
        res = -1
        x = int(m.text.split(' ')[1])
        y = int(m.text.split(' ')[2])
        res = random.gauss(x, y)
        bot.send_message(m.chat.id, 'random.gauss(—Å—Ä. –∑–Ω–∞—á–µ–Ω–∏–µ '+str(x)+', —Å—Ä. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ '+str(y)+') = '+str(res))
    except:
        pass

    
@bot.message_handler(commands=['reset_stats'])
def resetstats(m):
    if m.from_user.id != 441399484:
        return
    idd = stats.find_one({})['id']
    stats.remove({})
    stats.insert_one({'id':idd})
    bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞!')
    
    
@bot.message_handler(commands=['simulate'])
def simulate(m):
    if m.from_user.id != 441399484:
        return
    t1 = time.time()
    try:
        x = int(m.text.split(' ')[1])
    except:
        return
    i = 0
    horse_stats = {}
    while i < x:
        spisok = cazino(None)
        try:
            for ids in spisok:
                if ids not in horse_stats:
                    horse_stats.update({ids:{'wins':0, 'games':0}})
            for ids in spisok:
                if spisok[ids] == 'win':
                    horse_stats[ids]['wins'] += 1
                    horse_stats[ids]['games'] += 1
                else:
                    horse_stats[ids]['games'] += 1
        except:
            pass
        i+=1
    s = stats.find_one({})
    for ids in horse_stats:
        h = horse_stats[ids]
        if str(ids) not in s:
            stats.update_one({},{'$set':{str(ids):{'games':0, 'wins':0}}}) 
            
    for ids in horse_stats:
        h = horse_stats[ids]
        stats.update_one({},{'$inc':{str(ids)+'.games':h['games'], str(ids)+'.wins':h['wins']}})
    t2 = time.time()
    t = t2-t1
    bot.send_message(m.chat.id, str(x)+' —Ç–µ—Å—Ç–æ–≤—ã—Ö –∏–≥—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã! –≠—Ç–æ –∑–∞–Ω—è–ª–æ '+str(t)+' —Å–µ–∫—É–Ω–¥.')
            
    
@bot.message_handler(commands=['duel'])
def duelll(m):
    return
    if m.reply_to_message == None:
        bot.send_message(m.chat.id, '–≠—Ç–∏–º –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')
        return
    if m.reply_to_message.from_user.is_bot:
        bot.send_message(m.chat.id, '–≠—Ç–æ –±–æ—Ç!')
        return
    if m.reply_to_message.from_user.id == m.from_user.id:
        bot.send_message(m.chat.id, '–ù–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å –Ω–∞ –¥—É—ç–ª—å —Å–µ–±—è!')
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    user2 = users.find_one({'id':m.reply_to_message.from_user.id})
    if user2 == None:
        bot.send_message(m.chat.id, '–û—à–∏–±–∫–∞!')
        return
    try:
        cost = int(m.text.split(' ')[1])
    except:
        cost = 5
    if user['beecoins'] < cost:
        bot.send_message(m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∏–∫–æ–∏–Ω–æ–≤ (–Ω—É–∂–Ω–æ '+str(cost)+')!')
        return
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ü—Ä–∏–Ω—è—Ç—å', callback_data = 'duel_accept_'+str(m.reply_to_message.from_user.id)+'_'+str(m.from_user.id)+'_'+str(cost)))
    kb.add(types.InlineKeyboardButton(text = '–û—Ç–∫–∞–∑–∞—Ç—å—Å—è', callback_data = 'duel_decline_'+str(m.reply_to_message.from_user.id)+'_'+str(m.from_user.id)))
    bot.send_message(m.chat.id, user['name']+' –≤—ã–∑—ã–≤–∞–µ—Ç '+user2['name']+' –Ω–∞ –¥—É—ç–ª—å!', reply_markup = kb)
    
    
    
    
@bot.message_handler(commands=['deploy_supply'])
def deploy_supply(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.from_user.id != m.chat.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    
    if user['supply'] == None:
        bot.send_message(m.chat.id, '–í—ã –µ—â—ë –Ω–µ –ø—Ä–æ–∏–∑–≤–µ–ª–∏ –Ω–∞–ø–∏—Ç–æ–∫ (/create_supply)!')
        return
    if user['coins'] < user['supply']['cost']:
        bot.send_message(m.chat.id, '–î–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω—É–∂–Ω–æ (—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞–ø–∏—Ç–∫–∞) –º–æ–Ω–µ—Ç!')
        return
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = '–ù–∞—á–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É –Ω–∞–ø–∏—Ç–∫–∞ –≤ –±–∞—Ä', callback_data = 'deploy_napitok'))
    text = '–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≥–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É –≤–∞—à–µ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞ –≤ –±–∞—Ä? –≠—Ç–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –≤–∞–º (—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞–ø–∏—Ç–∫–∞) –º–æ–Ω–µ—Ç, –∏ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü '+\
    '–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è. –í–∞–º –±—É–¥–µ—Ç –æ—Ç—á–∏—Å–ª—è—Ç—å—Å—è 100% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–∫—É–ø–∫—É.\n'+\
    '–ò—Ç–æ–≥–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞–ø–∏—Ç–∫–∞:\n'
    text += '–ù–∞–∑–≤–∞–Ω–∏–µ: "'+user['supply']['name']+'"\n'
    text += '–û–ø—å—è–Ω–µ–Ω–∏–µ: '+str(user['supply']['drunk'])+'%\n'
    text += '–¶–µ–Ω–∞: '+str(user['supply']['cost'])+'üí∞'
    bot.send_message(m.chat.id, text, reply_markup = kb)
    
    
@bot.message_handler(commands=['choose_stats'])
def chostats(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['lvlpoints'] <= 0:
        bot.send_message(m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –æ—á–∫–æ–≤ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è!')
        return
    
    if len(m.text.split(' ')) < 3:
        bot.send_message(m.chat.id, '–î–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—á–∫–æ–≤ —É–º–µ–Ω–∏–π –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:\n'+\
                     '/choose\_stats stat amount\n–ì–¥–µ stat - —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ (–æ–¥–Ω–∞ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö: `—Å–∏–ª–∞` `–ª–æ–≤–∫–æ—Å—Ç—å` `–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç` `—É–¥–∞—á–∞` `—É–º–µ–Ω–∏–µ_–≥–æ—Ç–æ–≤–∏—Ç—å`), '+\
                     'amount - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.', parse_mode = 'markdown')
        return
    else:
        try:
            stat = m.text.split(' ')[1].lower()
            amount = int(m.text.split(' ')[2])
            if amount <= 0:
                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ –Ω—É–ª—è!')
                return
            s = None
            if stat == '—Å–∏–ª–∞':
                s = 'strenght'
            elif stat == '–ª–æ–≤–∫–æ—Å—Ç—å':
                s = 'agility'
            elif stat == '–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç':
                s = 'intelligence'
            elif stat == '—É–¥–∞—á–∞':
                s = 'luck'
            elif stat == '—É–º–µ–Ω–∏–µ_–≥–æ—Ç–æ–≤–∏—Ç—å':
                s = 'cooking_skill'
            if s == None:
                bot.send_message(m.chat.id, '–¢–∞–∫–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
                return
            if user['lvlpoints'] < amount:
                bot.send_message(m.chat.id, '–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ —É–º–µ–Ω–∏–π!')
                return
            users.update_one({'id':user['id']},{'$inc':{s:amount, 'lvlpoints':-amount}})
            bot.send_message(m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∫–∞—á–∞–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É "'+stat+'" –Ω–∞ '+str(amount)+'!')
        except:
            bot.send_message(m.chat.id, '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç!')
            bot.send_message(441399484, traceback.format_exc())
    
 

@bot.message_handler(commands=['throw'])
def throw(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    if user['bottle'] != False and user['bottle'] != True:
        if m.reply_to_message != None:
            user2 = users.find_one({'id':m.reply_to_message.from_user.id})
            if user2 == None:
                uvorot = False
            else:
                chance = 25 - (user['agility'] - user2['agility'])
                if chance < 10:
                    chance = 10
                if chance > 90:
                    chance = 90
                if random.randint(1, 100) <= chance:
                    uvorot = True
                else:
                    uvorot = False
            if user2 != None:
                if user2['drunk'] >= 100 or user2['afk_until'] > time.time():
                    uvorot = False
            if uvorot:
                tt = m.text.split('/throw ')
                if len(tt) > 1:
                    text = user['name']+' —Å –∫—Ä–∏–∫–æ–º "'+tt[1]+'" –±—Ä–æ—Å–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –ø—Ä—è–º–æ –≤ '+m.reply_to_message.from_user.first_name+\
                    ', –Ω–æ —Ç–æ—Ç –ª–æ–≤–∫–æ —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è, –∏ '+user['bottle']+' —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –æ–± –ø–æ–ª!'
                else:
                    text = user['name']+' –±—Ä–æ—Å–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –ø—Ä—è–º–æ –≤ '+m.reply_to_message.from_user.first_name+\
                    ', –Ω–æ —Ç–æ—Ç –ª–æ–≤–∫–æ —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è, –∏ '+user['bottle']+' —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –æ–± –ø–æ–ª!'
            else:
                tt = m.text.split('/throw ')
                if len(tt) > 1:
                    text = user['name']+' —Å –∫—Ä–∏–∫–æ–º "'+tt[1]+'" –±—Ä–æ—Å–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –ø—Ä—è–º–æ –≤ '+m.reply_to_message.from_user.first_name+\
                    '!'
                else:
                    text = user['name']+' –±—Ä–æ—Å–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –ø—Ä—è–º–æ –≤ '+m.reply_to_message.from_user.first_name+\
                    '!'
            bot.send_message(m.chat.id, text)
            users.update_one({'id':user['id']},{'$set':{'bottle':False}})
            
        else:
            if (user['intelligence'] <= 5 or user['drunk'] >= 70) and random.randint(1, 100) <= 25:
                tt = m.text.split('/throw ')
                if len(tt) > 1:
                    text = user['name']+' —Å –∫—Ä–∏–∫–æ–º "'+tt[1]+'" —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –æ–± –≥–æ–ª–æ–≤—É –∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è!'
                else:
                    text = user['name']+' —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –æ–± –≥–æ–ª–æ–≤—É –∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è!'
                users.update_one({'id':user['id']},{'$set':{'afk_until': time.time() + 180}})
            else:
                tt = m.text.split('/throw ')
                if len(tt) > 1:
                    text = user['name']+' —Å –∫—Ä–∏–∫–æ–º "'+tt[1]+'" —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –æ–± –ø–æ–ª!'
                else:
                    text = user['name']+' —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π '+user['bottle']+' –æ–± –ø–æ–ª!'
            bot.send_message(m.chat.id, text)
            
            users.update_one({'id':user['id']},{'$set':{'bottle':False}})
        if random.randint(1, 100) <= 20:
            beecoins.update_one({},{'$set':{'works.cleanready':True}})
        
                                    
    else:
        bot.send_message(m.chat.id, '–ù–µ—á–µ–≥–æ –±—Ä–æ—Å–∞—Ç—å! –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–µ–π!')
    


                                    
@bot.message_handler(commands=['help'])
def help(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    text = '–ó–¥–µ—Å—å –≤—ã –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –Ω–∞ –ª–æ—à–∞–¥–µ–π. –í—Å—ë –ø—Ä–æ—Å—Ç–æ: —á–µ–º –≤—ã—à–µ –∏—Ç–æ–≥–æ–≤–æ–µ –º–µ—Å—Ç–æ –≤–∞—à–µ–π –ª–æ—à–∞–¥–∏, —Ç–µ–º –±–æ–ª—å—à–µ –Ω–∞–≥—Ä–∞–¥–∞. '+\
    '–ú–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ—à–∞–¥–µ–π. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–∫–∞—á–∫–∏ –≤ —á–∞—Ç–µ, –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ –±–æ—Ç–∞ –∏ –Ω–∞–ø–∏—à–∏—Ç–µ /cazino. –ß—Ç–æ–±—ã '+\
    '—Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –Ω–∞ –ª–æ—à–∞–¥—å, –Ω–∞–ø–∏—à–∏—Ç–µ /bet index. –ò–Ω–¥–µ–∫—Å –∫–∞–∂–¥–æ–π –ª–æ—à–∞–¥–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Å–ø–∏—Å–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –¥–∞—Å—Ç –∏–≥—Ä–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã '+\
    '/cazino. –ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ —Å—Ç–∞–≤–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –Ω–∞ –∫–∞–∂–¥—É—é –ª–æ—à–∞–¥—å. –ß—Ç–æ–±—ã –≤—ã—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—ë —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏, –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É '+\
    '/cazino –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:\n/cazino 150\n–ì–¥–µ 150 - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö –º–æ–Ω–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–≤–∫–∏. –ß–∏—Å–ª–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º.\n'+\
    '–£ –∫–∞–∂–¥–æ–π –ª–æ—à–∞–¥–∏ –µ—Å—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –µ–π –≤–æ –≤—Ä–µ–º—è —Å–∫–∞—á–µ–∫, –ª–∏–±–æ –ø–æ–≤—ã—à–∞—é—Ç/–ø–æ–Ω–∏–∂–∞—é—Ç –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –Ω–µ—ë –≤ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å '+\
    '—Å–ø–∏—Å–æ–∫ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –ª–æ—à–∞–¥–µ–π –º–æ–∂–Ω–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ /horses. –ï—Å–ª–∏ –≤ –∏–≥—Ä–µ 2 –∏–ª–∏ –±–æ–ª—å—à–µ —á–µ–ª–æ–≤–µ–∫–∞, –æ–±—â–∏–π –ø—É–ª –º–æ–Ω–µ—Ç —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ 1.5. –£–¥–∞—á–∏ –≤ —Å—Ç–∞–≤–∫–∞—Ö!'
    try:
        bot.send_message(m.from_user.id, text)
        bot.send_message(m.chat.id, '–û—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–º–æ—â—å –≤–∞–º –≤ –õ–°.')
    except:
        bot.send_message(m.chat.id, '–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –ª–∏—á–∫—É —Å–æ –º–Ω–æ–π!')
      
    
@bot.message_handler(commands=['bar'])
def barr(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        return
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    kb = userskb(m.from_user)
   # kb = barkb(m.from_user)
    text = '–°–ø–∏—Å–æ–∫ –±–∞—Ä–æ–≤:'
    bot.send_message(m.chat.id, text, reply_markup = kb)
    
def userskb(user):
    kb = types.InlineKeyboardMarkup()
    
    kbs = [[]]
    i = 0
    sp = []
    for ids in alcos:
        s = alcos[ids]
        if str(s['owner']) not in sp and s['owner'] != None:
            if len(kbs[i]) > 1:
                kbs.append([])
                i+=1
            allow = False
            if s['owner'] in allow_bars:
                kbs[i].append(types.InlineKeyboardButton(text = s['ownername']+'', callback_data = 'lookuser_'+str(s['owner'])+' '+str(user.id)))
                sp.append(str(s['owner']))
    for ids in kbs:
        kb.add(*ids)
    kb.add(types.InlineKeyboardButton(text = '–í—ã–π—Ç–∏ –∏–∑ –º–µ–Ω—é', callback_data = 'goaway '+str(user.id)))
    return kb



def barkb(user, whos):
    kbs = [[]]
    i = 0
    kb = types.InlineKeyboardMarkup()
    #kb.add(types.InlineKeyboardButton(text = '–í–∏–Ω–æ\n200üí∞', callback_data = 'look_wine '+str(user.id)), types.InlineKeyboardButton(text = '–ü–∏–≤–æ\n50üí∞', callback_data = 'look_pivo '+str(user.id)))
    #kb.add(types.InlineKeyboardButton(text = '–ü–æ—Ä—Ç–≤–µ–π–Ω\n350üí∞', callback_data = 'look_portvein '+str(user.id)), types.InlineKeyboardButton(text = '–ö—É–º—ã—Å\n150üí∞', callback_data = 'look_kumis '+str(user.id)))
    #kb.add(types.InlineKeyboardButton(text = '–ö–æ–Ω—å—è–∫\n350üí∞', callback_data = 'look_koniak '+str(user.id)), types.InlineKeyboardButton(text = '–î–∂–∏–Ω\n250üí∞', callback_data = 'look_dzin '+str(user.id)))
    #kb.add(types.InlineKeyboardButton(text = '–í–æ–¥–∫–∞\n50üí∞', callback_data = 'look_vodka '+str(user.id)), types.InlineKeyboardButton(text = '–¢–µ–∫–∏–ª–∞\n500üí∞', callback_data = 'look_tekila '+str(user.id)))
    u2 = users.find_one({'id':int(whos)})
    for ids in alcos:
            s = alcos[ids]
            if str(s['owner']) == str(whos):
              if u2['current_supplies'][s['name']]['amount'] > 0:
                if len(kbs[i]) > 1:
                    kbs.append([])
                    i+=1
                kbs[i].append(types.InlineKeyboardButton(text = s['name']+'\n'+str(s['cost'])+'üí∞', callback_data = 'look_'+str(s['id'])+' '+str(user.id)))
    for ids in kbs:
        kb.add(*ids)
    kb.add(types.InlineKeyboardButton(text = '–ù–∞–∑–∞–¥', callback_data = 'gomennu '+str(user.id)))
    return kb


def nextlvl(user):
    exp = 2 + int(user['lvl']/50)
    if user['exp'] >= exp:
        users.update_one({'id':user['id']},{'$inc':{'lvl':1, 'exp':-exp, 'lvlpoints':1}})
        user = users.find_one({'id':user['id']})
        try:
            nextlvl(user)
        except:
            pass

    
@bot.message_handler(commands=['drink'])
def drink(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        return
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    text = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–ø–∏—Ç–æ–∫, —á—Ç–æ–±—ã –≤—ã–ø–∏—Ç—å.'
    kb = types.InlineKeyboardMarkup()
    for ids in user['bar']:
        if user['bar'][ids] > 0:
            try:
                kb.add(types.InlineKeyboardButton(text = alcos[ids.replace('#', ' ')]['name']+' ('+str(user['bar'][ids])+')', callback_data = 'drink_'+alcos[ids.replace('#', ' ')]['id']+' '+str(user['id'])))      
            except:
                pass
    kb.add(types.InlineKeyboardButton(text = '–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é', callback_data = 'close '+str(user['id'])))  
    bot.send_message(m.chat.id, text, reply_markup = kb)
           
    
@bot.message_handler(commands=['give_drink'])
def givedrink(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        return
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    try:
        text = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–ø–∏—Ç–æ–∫, —á—Ç–æ–±—ã —É–≥–æ—Å—Ç–∏—Ç—å '+m.reply_to_message.from_user.first_name+'.'
    except:
        bot.send_message(m.chat.id, '–≠—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –¥—Ä—É–≥–∞!')
        return
    kb = types.InlineKeyboardMarkup()
    for ids in user['bar']:
      try:
        if user['bar'][ids] > 0:
            kb.add(types.InlineKeyboardButton(text = alcos[ids.replace('#', ' ')]['name']+' ('+str(user['bar'][ids])+')', callback_data = 'give_'+alcos[ids.replace('#', ' ')]['id']+' '+str(user['id'])+' '+str(m.reply_to_message.from_user.id)))   
      except:
        pass   
    kb.add(types.InlineKeyboardButton(text = '–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é', callback_data = 'close '+str(user['id'])))  
    bot.send_message(m.chat.id, text, reply_markup = kb)
    
   

@bot.message_handler(commands=['cook_drink'])
def cookdrink(m):
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if m.chat.id != m.from_user.id:
        bot.send_message(m.chat.id, '–ú–æ–∂–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å –Ω–∞–ø–∏—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ!')
        return
    if len(user['current_supplies']) == 0:
        bot.send_message(m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤–ª—è–µ–º–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞!')
        return
    kb = types.InlineKeyboardMarkup()
    
    for ids in user['current_supplies']:
      try:
        sp = user['current_supplies'][ids]
        for idss in alcos:
            if alcos[idss]['id'] == sp['id']:
                idd = alcos[idss]['id']
        try:
            kb.add(types.InlineKeyboardButton(text = sp['name'], callback_data = 'cook_'+str(idd)))
        except:
            pass
      except:
        pass
    bot.send_message(m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≥–æ—Ç–æ–≤–∏—Ç—å. –≠—Ç–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å –≤–∞–º 20% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞–ø–∏—Ç–∫–∞.', reply_markup = kb)


def cooking(user, a, progress, p, skill, start, cooker=False):
    if start:
        start = False
        threading.Timer(random.randint(skill[0], skill[1]), cooking, args = [user, a, progress, p, skill, start, cooker]).start()
    else:
        if cooker == False:
            if users.find_one({'id':user['id']})['wait_ings'] == True:
                bot.send_message(user['id'], '–í—ã –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!')
                users.update_one({'id':user['id']},{'$set':{'wait_ings':False}})
            else:
                failchance = 15
                failchance -= user['cooking_skill']/2
                fca = (user['drunk']/2) - 15
                if fca < 0:
                    fca = 0
                failchance += fca
                if random.randint(1, 100) <= failchance:
                    bot.send_message(user['id'], '–£–ø—Å! –í—ã –¥–æ–±–∞–≤–∏–ª–∏ –Ω–µ —Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã!')
                else:
                    progress += 25
                ch = user['luck']/2
                if ch > 35:
                    ch = 35
                if random.randint(1, 100) <= ch:
                    progress += 25
                    bot.send_message(user['id'], '–¢–∞–∫ –∫–∞–∫ –≤—ã –æ—á–µ–Ω—å —É–¥–∞—á–ª–∏–≤—ã–π, –≤–∞–º —É–¥–∞–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–∞!')
            if p > 0:
                kb = types.InlineKeyboardMarkup()
                kb.add(types.InlineKeyboardButton(text = '–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã', callback_data = 'addings'))
                bot.send_message(user['id'], '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω—É–∂–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –≤ –≤–∞—à –Ω–∞–ø–∏—Ç–æ–∫.', reply_markup = kb)
                users.update_one({'id':user['id']},{'$set':{'wait_ings':True}})
                p -= 1
                threading.Timer(random.randint(skill[0], skill[1]), cooking, args = [user, a, progress, p, skill, start, cooker]).start()
            else:
                if progress >= 100:
                    am = 6
                    lk = user['luck']
                    if lk > 50:
                        lk = 50
                    if random.randint(1, 100) <= lk and random.randint(1, 100) <= user['strenght']*4:
                        am += 3
                        if random.randint(1, 100) <= user['strenght']*4:
                            am += random.randint(3, 4)
                    bot.send_message(user['id'], '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ '+str(am)+' —à—Ç—É–∫ –Ω–∞–ø–∏—Ç–∫–∞ "'+a['name']+'"!')
                    users.update_one({'id':user['id']},{'$inc':{'current_supplies.'+a['name']+'.amount':am}})
                else:
                    bot.send_message(user['id'], '–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å "'+a['name']+'". –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≤–µ–ª–∏—á–∏—Ç—å —Å–∫–∏–ª–ª –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–æ–≤!')
                users.update_one({'id':user['id']},{'$set':{'now_cooking':False}})
                users.update_one({'id':user['id']},{'$set':{'current_drink':None}})
        else:
            failchance = 15
            failchance -= cooker['cooking_skill']/2
            if random.randint(1, 100) <= failchance:
                pass
            else:
                progress += 25
            ch = cooker['luck']/2
            if ch > 35:
                ch = 35
            if random.randint(1, 100) <= ch:
                progress += 25
            if p > 0:
                p -= 1
                threading.Timer(random.randint(skill[0], skill[1]), cooking, args = [user, a, progress, p, skill, start, cooker]).start()
            else:
                if progress >= 100:
                    am = 6
                    lk = cooker['luck']
                    if lk > 50:
                        lk = 50
                    if random.randint(1, 100) <= lk and random.randint(1, 100) <= cooker['strenght']*4:
                        am += 3
                        if random.randint(1, 100) <= cooker['strenght']*4:
                            am += random.randint(3, 4)
                    users.update_one({'id':cooker['owner']},{'$inc':{'current_supplies.'+a['name']+'.amount':am}})
                else:
                    pass
                try:
                    users.update_one({'id':cooker['owner']},{'$set':{'cook.cooking':False}})
                except:
                    pass
            
    
@bot.callback_query_handler(func=lambda call: True)
def barrrr(call):
  try:
    if call.from_user.id in block:
        return
    user = users.find_one({'id':call.from_user.id})
    if user == None:
        return
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.answer_callback_query(call.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return

    if 'lookuser' in call.data:
        if int(call.data.split(' ')[1]) != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        us = call.data.split('_')[1].split(' ')[0]
        uname = users.find_one({'id':int(us)})['name']
        kb = barkb(call.from_user, us)
        text = '–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞ - '+uname+'.'
        medit(text, call.message.chat.id, call.message.message_id, reply_markup = kb, parse_mode = 'html')
        
    elif 'summon' in call.data:
        if call.from_user.id != int(call.data.split('_')[2]):
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        prt = call.data.split('_')[1]
        if user['portals'][prt] > 0:
            bossid = stats.find_one({})['id']
            stats.update_one({},{'$inc':{'id':1}})
            bossname = random.choice(npc_name1).title()+' '+random.choice(npc_name2)+' '+random.choice(npc_name3)
            boss_skills = []
            skillamount = getskillamount(prt)
            while len(boss_skills) < skillamount:
                x = random.choice(all_boss_skills)
                if x not in boss_skills:
                    boss_skills.append(x)
            boss = createboss()
            bskills = ''
            boss.update({'name':bossname, 'id':bossid, 'skills':boss_skills})
           
            for ids in boss['skills']:
                bskills += '*'+getskill(ids)+'*\n'
            users.update_one({'id':user['id']},{'$set':{'summons.'+str(bossid): boss}})       
            users.update_one({'id':user['id']},{'$inc':{'portals.'+prt:-1}})
            medit('–ü—Ä–∏–∑—ã–≤–∞–µ—Ç—Å—è –±–æ—Å—Å "'+portaltotext(prt)+'"!', call.message.chat.id, call.message.message_id)
            bot.send_message(call.message.chat.id, '–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç–∞–ª...')
            time.sleep(2)
            bot.send_message(call.message.chat.id, '–ù–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –Ω–µ —Ä–≤–∞–Ω—ë—Ç...')
            time.sleep(3)
            bot.send_message(call.message.chat.id, '*–í–ó–†–´–í*')
            time.sleep(2)
            bot.send_message(call.message.chat.id, '–ë%$@&! –õ–∞–¥–Ω–æ, –±–æ—Å—Å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–∑–≤–∞–ª—Å—è. –í—Å—Ç—Ä–µ—á–∞–π—Ç–µ...')
            time.sleep(2)
            bot.send_message(call.message.chat.id, '–ë–æ—Å—Å "'+boss['name']+'"! –ï–≥–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:\n'+bskills, parse_mode = 'markdown')
            
            
           
     
    elif 'addings' in call.data:
        if user['wait_ings'] == False:
            return
        if user['wait_ings'] == True:
            users.update_one({'id':user['id']},{'$set':{'wait_ings':False}})
            medit('–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω—É–∂–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã!', call.message.chat.id, call.message.message_id)
            
    elif 'hire' in call.data:
        cook = call.data.split('_')[1]
        if cook == 'new':
            c = cooks['–ù–æ–≤–∏—á–æ–∫'].copy()
        elif cook == 'medium':
            c = cooks['–õ—é–±–∏—Ç–µ–ª—å'].copy()
        elif cook == 'pro':
            c = cooks['–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª'].copy()
        c.update({'work_until':time.time() + 60*60, 'cooking':False, 'owner':user['id']})
        
        if user['cook'] != None:
            medit('–£ –≤–∞—Å —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω –±–∞—Ä–º–µ–Ω!', call.message.chat.id, call.message.message_id)
            return
        if user['beecoins'] < c['cost']:
            medit('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üêù–±–∏–∫–æ–∏–Ω–æ–≤!', call.message.chat.id, call.message.message_id)
            return
        medit('–£—Å–ø–µ—à–Ω–æ –Ω–∞–Ω—è—Ç –±–∞—Ä–º–µ–Ω "'+c['name']+'"!', call.message.chat.id, call.message.message_id)
            
        bot.send_message(441399484, user['name']+' –Ω–∞–Ω—è–ª –±–∞—Ä–º–µ–Ω–∞ '+c['name']+'!')
        users.update_one({'id':user['id']},{'$inc':{'beecoins':-c['cost']}})
        beecoins.update_one({},{'$inc':{'beecoins':c['cost']}})
        users.update_one({'id':user['id']},{'$set':{'cook':c}})
       
    
    elif 'look' in call.data:
        if call.data[0] != 'f':
            if int(call.data.split(' ')[1]) != call.from_user.id:
                bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
                return
            alc = call.data.split('_')[1].split(' ')[0]
            
            for ids in alcos:
                if alcos[ids]['id'] == alc:
                    a = alcos[ids]
            own = users.find_one({'id':a['owner']})
            am = own['current_supplies'][a['name']]['amount']
            text = a['name']+'. –¶–µ–Ω–∞: '+str(a['cost'])+'üí∞. –í –Ω–∞–ª–∏—á–∏–∏: '+str(am)+'. –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å" –¥–ª—è –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è.\n'
            if a['owner'] != None:
                name1 = config.make_safe_html(own['name'])
                text += '–ü–æ—Å—Ç–∞–≤—â–∏–∫: '+'<a href="tg://user?id=' + str(own['id']) + '">' + name1 + '</a>'
            kb = types.InlineKeyboardMarkup()
            kb.add(types.InlineKeyboardButton(text = '–ö—É–ø–∏—Ç—å', callback_data = 'buy_'+alc+' '+str(user['id'])))
            kb.add(types.InlineKeyboardButton(text = '–í –º–µ–Ω—é', callback_data = 'menu '+str(user['id'])+' '+str(own['id'])))
            medit(text, call.message.chat.id, call.message.message_id, reply_markup = kb, parse_mode = 'html')
        else:
            if int(call.data.split(' ')[1]) != call.from_user.id:
                bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
                return
            fd = call.data.split('_')[1].split(' ')[0]
            for ids in foods:
                if foods[ids]['id'] == fd:
                    a = foods[ids]
                    adr = ids
            am = 0
            own = users.find_one({'id':a['owner']})
            am = own['current_foods'][adr]['amount']
            text = '–ü—Ä–æ–¥—É–∫—Ç "'+a['name']+'". –¶–µ–Ω–∞: '+str(a['cost'])+'üí∞ –í –Ω–∞–ª–∏—á–∏–∏: '+str(am)+'. –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å" –¥–ª—è –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è.\n'
            if a['owner'] != None:
                name1 = config.make_safe_html(own['name'])
                text += '–ü–æ—Å—Ç–∞–≤—â–∏–∫: '+'<a href="tg://user?id=' + str(own['id']) + '">' + name1 + '</a>'
            kb = types.InlineKeyboardMarkup()
            kb.add(types.InlineKeyboardButton(text = '–ö—É–ø–∏—Ç—å', callback_data = 'f_buy_'+fd+' '+str(user['id'])))
            kb.add(types.InlineKeyboardButton(text = '–í –º–µ–Ω—é', callback_data = 'menu '+str(user['id'])+' '+str(own['id'])))
            medit(text, call.message.chat.id, call.message.message_id, reply_markup = kb, parse_mode = 'html')
            
    elif 'cook' in call.data:
        if user['now_cooking'] == True:
            medit('–í—ã —É–∂–µ –≥–æ—Ç–æ–≤–∏—Ç–µ —á—Ç–æ-—Ç–æ!', call.message.chat.id, call.message.message_id)
            return
        alc = call.data.split('_')[1] 
        for ids in alcos:
            if alcos[ids]['id'] == alc:
                a = alcos[ids]
        cst = int((a['cost']/100)*20)
        if user['coins'] < cst:
            bot.send_message(call.message.chat.id, '–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞ —Å—Ç–æ–∏—Ç 20% –æ—Ç –µ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ ('+str(cst)+')!')
            return
        users.update_one({'id':user['id']},{'$set':{'now_cooking':True}})
        users.update_one({'id':user['id']},{'$inc':{'coins':-cst}})
        min = int(30-(user['agility']/2))
        max = int(60-(user['agility']/3))
        if min < 4:
            min = 4
        if max < 15:
            max = 15
        popitki = 4
        progress = -25
        if user['intelligence'] >= 20:
            popitki -= 1
            progress += 25
        if user['intelligence'] >= 40:
            popitki -= 1
            progress += 25 
       
        
        cooking(user, a, progress, popitki, [min, max], True)
        medit('–í—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∞–ª–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞ "'+a['name']+'!', call.message.chat.id, call.message.message_id)
        users.update_one({'id':user['id']},{'$set':{'current_drink':a['name']}})
    
    elif 'give' in call.data:
        if int(call.data.split(' ')[1]) != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        alc = call.data.split('_')[1].split(' ')[0]
        for ids in alcos:
            if alcos[ids]['id'] == alc:
                a = alcos[ids]
                adr = a['adress']
        try:
            if user['bar'][adr] <= 0:
                bot.answer_callback_query(call.id, '–£ –≤–∞—Å —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç!')
                return
        except:
            adr = adr.replace('#', ' ')
            if user['bar'][adr] <= 0:
                bot.answer_callback_query(call.id, '–£ –≤–∞—Å —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç!')
                return
        user2 = users.find_one({'id':int(call.data.split(' ')[2])})
        if user2 == None:
            return
        users.update_one({'id':user['id']},{'$inc':{'bar.'+adr:-1}})
        if alc in user2['bar']:
            users.update_one({'id':user2['id']},{'$inc':{'bar.'+adr:1}})
        else:
            users.update_one({'id':user2['id']},{'$set':{'bar.'+adr:1}})
        medit('–í—ã —É–≥–æ—Å—Ç–∏–ª–∏ '+user2['name']+' –Ω–∞–ø–∏—Ç–∫–æ–º "'+a['name']+'"!', call.message.chat.id, call.message.message_id)
        
    elif 'buy' in call.data:
        if call.data[0] != 'f':
            alc = call.data.split('_')[1].split(' ')[0]
            for ids in alcos:
                if alcos[ids]['id'] == alc:
                    a = alcos[ids]
                    adr = a['adress']
            own = users.find_one({'id':a['owner']})
            if own['current_supplies'][a['name']]['amount'] < 1:
                bot.answer_callback_query(call.id, '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏!')
                return
            if user['coins'] >= a['cost']:
                if adr in user['bar']:
                    if user['bar'][adr] < 5:       
                        users.update_one({'id':user['id']},{'$inc':{'bar.'+adr:1, 'coins':-a['cost']}})
                    else:
                        bot.answer_callback_query(call.id, '–£ –≤–∞—Å –µ—Å—Ç—å –º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—è—Ç–∏ –Ω–∞–ø–∏—Ç–∫–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞!')
                        return
                else:
                    
                    users.update_one({'id':user['id']},{'$set':{'bar.'+adr:1}})
                    users.update_one({'id':user['id']},{'$inc':{'coins':-a['cost']}})
                users.update_one({'id':own['id']},{'$inc':{'current_supplies.'+a['name']+'.amount':-1}})
                if a['owner'] != None:
                    users.update_one({'id':a['owner']},{'$inc':{'coins':int(a['cost'])}})
                bot.answer_callback_query(call.id, '‚úÖ–ë–∞—Ä–º–µ–Ω —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–∞—à –∑–∞–∫–∞–∑ –Ω–∞ "'+a['name']+'"!')
            else:
                bot.answer_callback_query(call.id, '‚ùå–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–π –Ω–∞ —Å—Ç–∞–≤–∫–∞—Ö!')
        else:
            pass
            
    elif 'menu' in call.data:
        if int(call.data.split(' ')[1]) != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        us = call.data.split(' ')[2]
        kb = barkb(call.from_user, us)
        uname = users.find_one({'id':int(us)})['name']
        
        text = '–í–ª–∞–¥–µ–ª–µ—Ü –±–∞—Ä–∞ - '+uname+'.'
        medit(text, call.message.chat.id, call.message.message_id, reply_markup = kb)
    
           
    elif 'goaway' in call.data:
        if int(call.data.split(' ')[1]) != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        medit('–í—ã –≤—ã—à–ª–∏ –∏–∑ –±–∞—Ä–∞.', call.message.chat.id, call.message.message_id)
    
    elif 'gomennu' in call.data:
        if int(call.data.split(' ')[1]) != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        kb = userskb(call.from_user)
        medit('–°–ø–∏—Å–æ–∫ –±–∞—Ä–æ–≤:', call.message.chat.id, call.message.message_id, reply_markup = kb)
    

    elif 'close' in call.data:
        if user['id'] == int(call.data.split(' ')[1]):
            medit('–ú–µ–Ω—é –∑–∞–∫—Ä—ã—Ç–æ.', call.message.chat.id, call.message.message_id)
        else:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
        
    elif 'set' in call.data:
        if call.data[0] != 'f':
            stat = call.data.split('_')[1]
            if stat == 'name':
                s = '–Ω–∞–∑–≤–∞–Ω–∏–µ'
            elif stat == 'cost':
                s = '—Ü–µ–Ω–∞'
            elif stat == 'drunk':
                s = '–æ–ø—å—è–Ω–µ–Ω–∏–µ'
            users.update_one({'id':user['id']},{'$set':{'set':stat}})
            medit('–¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É "'+s+'" —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.', call.message.chat.id, call.message.message_id)
        else:
            return
            stat = call.data.split('_')[1]
            if stat == 'name':
                s = '–Ω–∞–∑–≤–∞–Ω–∏–µ'
            elif stat == 'feed':
                s = '–ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'
            elif stat == 'cost':
                s = '—Ü–µ–Ω–∞'
            users.update_one({'id':user['id']},{'$set':{'f_set':stat}})
            medit('–¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É "'+s+'" —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.', call.message.chat.id, call.message.message_id)
        
        
    elif 'drink' in call.data:
        if int(call.data.split(' ')[1]) != user['id']:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        alc = call.data.split('_')[1].split(' ')[0]
        for ids in alcos:
            if alcos[ids]['id'] == alc:
                a = alcos[ids]
                adr = a['adress']
        if user['drunk'] >= 100:
            medit('–í—ã —Å–ø–∏—Ç–µ! –ü—Ä–æ—Ç—Ä–µ–∑–≤–µ–π—Ç–µ, –∞ –ø–æ—Ç–æ–º –ø–µ–π—Ç–µ –æ–ø—è—Ç—å.', call.message.chat.id, call.message.message_id)
            return
        try:
          if user['bar'][adr] <= 0:
            medit('–£ –≤–∞—Å —ç—Ç–æ–≥–æ –Ω–µ—Ç! –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫–∞–∂–∏—Ç–µ –∞–ª–∫–æ–≥–æ–ª—å –≤ /bar!', call.message.chat.id, call.message.message_id)
            return
        except:
          adr = adr.replace('#', ' ')
          if user['bar'][adr] <= 0:
            medit('–£ –≤–∞—Å —ç—Ç–æ–≥–æ –Ω–µ—Ç! –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫–∞–∂–∏—Ç–µ –∞–ª–∫–æ–≥–æ–ª—å –≤ /bar!', call.message.chat.id, call.message.message_id)
            return
        exp = a['drunk']/20
        if exp < 0:
            exp = 0
        if user['taken_exp'] == 0:
            users.update_one({'id':user['id']},{'$set':{'reboot_time':time.time() + 86400}})
        if exp > user['day_exp'] - user['taken_exp']:
            exp = user['day_exp'] - user['taken_exp']
        users.update_one({'id':user['id']},{'$inc':{'exp':exp, 'drunk':a['drunk'], 'bar.'+adr:-1, 'drinked':1}})
        users.update_one({'id':user['id']},{'$set':{'bottle':'–±–æ–∫–∞–ª'}})
        text = '?'
        if a['name'] == '–í–∏–Ω–æ':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –≤–∏–Ω–∞!'
        elif a['name'] == '–ü–∏–≤–æ':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –ø–∏–≤–∞!'
        elif a['name'] == '–ü–æ—Ä—Ç–≤–µ–π–Ω':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –ø–æ—Ä—Ç–≤–µ–π–Ω–∞!'
        elif a['name'] == '–ö—É–º—ã—Å':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –∫—É–º—ã—Å–∞!'
        elif a['name'] == '–ö–æ–Ω—å—è–∫':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –∫–æ–Ω—å—è–∫–∞!'
        elif a['name'] == '–î–∂–∏–Ω':
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –¥–∂–∏–Ω–∞!'
        elif a['name'] == '–í–æ–¥–∫–∞':
            text = user['name']+' –≤—ã–ø–∏–ª —Å—Ç–∞–∫–∞–Ω –≤–æ–¥–∫–∏!'
            users.update_one({'id':user['id']},{'$set':{'bottle':'—Å—Ç–∞–∫–∞–Ω'}})
        elif a['name'] == '–¢–µ–∫–∏–ª–∞':
            text = user['name']+' –≤—ã–ø–∏–ª —Ä—é–º–∫—É —Ç–µ–∫–∏–ª—ã!'
        else:
            text = user['name']+' –≤—ã–ø–∏–ª –±–æ–∫–∞–ª –Ω–∞–ø–∏—Ç–∫–∞ "'+a['name']+'"!'
        medit(text, call.message.chat.id, call.message.message_id)
        user = users.find_one({'id':user['id']})
        if user['drunk'] < 0:
            users.update_one({'id':user['id']},{'$set':{'drunk':0}})
        nextlvl(user)
        if user['drunk'] >= 100:
            bot.send_message(call.message.chat.id, user['name']+' –Ω–∞—Å—Ç–æ–ª—å–∫–æ –º–Ω–æ–≥–æ –≤—ã–ø–∏–ª, —á—Ç–æ –∑–∞–≤–∞–ª–∏–ª—Å—è —Å–ø–∞—Ç—å –ø—Ä—è–º–æ –≤ –±–∞—Ä–µ.')
            
    elif 'duel' in call.data:
        player = int(call.data.split('_')[2])
        player1 = int(call.data.split('_')[3])
        if player != call.from_user.id:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à–µ –º–µ–Ω—é!')
            return
        if call.data.split('_')[1] == 'decline':
            medit(call.from_user.first_name+' –æ—Ç–∫–ª–æ–Ω–∏–ª –≤—ã–∑–æ–≤.', call.message.chat.id, call.message.message_id)
            return
        elif call.data.split('_')[1] == 'accept':
            pl1 = users.find_one({'id':player1})
            pl2 = users.find_one({'id':player})
            cost = call.data.split('_')[4]
            x = createduel(call.message.chat.id, [pl2, pl1], cost)
            duels.update(x)
            duel = duels[call.message.chat.id]
            medit('–î—É—ç–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è! –ò–≥—Ä–∞–µ–º –≤ "'+x['name']+'"!', call.message.chat.id, call.message.message_id)
            d_next_turn(duel)
            
    elif 'take advantage' in call.data:
        try:
            duel = duels[call.message.chat.id]
        except:
            return
        attr = call.data.split('_')[1]
        try:
            player = duel['players'][call.from_user.id]
        except:
            return
        for ids in duel['players']:
            if duel['players'][ids]['id'] != player['id']:
                player2 = duel['players'][ids]
        if player['id'] != duel['current_player']:
            bot.answer_callback_query(call.id, '–ù–µ –≤–∞—à —Ö–æ–¥!')
            return
        if duel['type'] == 'draka':
            if attr == 'strenght':
                medit('–í—ã–±—Ä–∞–Ω –∞—Ç—Ç—Ä–∏–±—É—Ç: —Å–∏–ª–∞.', call.message.chat.id, call.message.message_id)
                chance = random.gauss(50, 25)
                str_b = player['strenght'] - player2['strenght']
                lim = 20
                if str_b > lim:
                    str_b = lim
                if str_b < -lim:
                    str_b = -lim
                chance -= str_b
                
                if player2['agility'] > player['agility']:
                    ag_b = int((player['agility'] - player2['agility'])/1.5)
                else:
                    ag_b = 0
                lim = 15
                if ag_b > lim:
                    ag_b = lim
                if ag_b < -lim:
                    ag_b = -lim
                    
                chance -= ag_b
                text = ''
                if random.randint(1, 100) <= chance:
                    succ = True
                else:
                    succ = False
                if succ:
                    preim = random.randint(20, 45)
                    text += player['name']+' –±—å—ë—Ç '+player2['name']+' –∏ –ø–æ–ª—É—á–∞–µ—Ç '+str(preim)+'% –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞!'
                else:
                    text += player['name']+' –±—å—ë—Ç '+player2['name']+', –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç!'
                
    
    elif call.data == 'deploy_napitok':
        
        if user['supply'] == None:
            medit('–í—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –Ω–∞–ø–∏—Ç–æ–∫!', call.message.chat.id, call.message.message_id)
            return
        if user['coins'] < user['supply']['cost']:
            medit('–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', call.message.chat.id, call.message.message_id)
            return
        if len(user['current_supplies']) >= 10:
            medit('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤–æ–∫ –≤ –±–∞—Ä - 10!', call.message.chat.id, call.message.message_id)
            return
        if user['supply']['name'] in user['current_supplies']:
            medit('–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º!', call.message.chat.id, call.message.message_id)
            return
        disallow = False
        for ids in users.find({}):
            for idss in ids['current_supplies']:
                try:
                  if ids['current_supplies'][idss]['name'] == user['supply']['name']:
                    disallow = True
                except:
                    pass
        if disallow:
            medit('–ö—Ç–æ-—Ç–æ —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–ø–∏—Ç–æ–∫ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º!', call.message.chat.id, call.message.message_id)
            return
        users.update_one({'id':user['id']},{'$set':{'current_supplies.'+user['supply']['name']:addsupply(user['supply'], user['id'])}})
        users.update_one({'id':user['id']},{'$inc':{'coins':-(user['supply']['cost'])}})
        medit('–í—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∞–ª–∏ –ø–æ—Å—Ç–∞–≤–∫—É —Å–≤–æ–µ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞ –≤ –±–∞—Ä! –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤–∏—Ç—å - /cook_drink. –û–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 24—á, –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å @Loshadkin.', call.message.chat.id, call.message.message_id)
        
    elif call.data == 'deploy_food':
        
        if user['food'] == None:
            medit('–í—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç!', call.message.chat.id, call.message.message_id)
            return
        if user['coins'] < user['food']['cost']:
            medit('–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', call.message.chat.id, call.message.message_id)
            return
        if len(user['current_foods']) >= 10:
            medit('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤–æ–∫ –µ–¥—ã –≤ –±–∞—Ä - 10!', call.message.chat.id, call.message.message_id)
            return
        if user['food']['name'] in user['current_foods']:
            medit('–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –ø—Ä–æ–¥—É–∫—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º!', call.message.chat.id, call.message.message_id)
            return
        disallow = False
        for ids in users.find({}):
            for idss in ids['current_foods']:
                if ids['current_foods'][idss]['name'] == user['food']['name']:
                    disallow = True
        if disallow:
            medit('–ö—Ç–æ-—Ç–æ —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º!', call.message.chat.id, call.message.message_id)
            return
        users.update_one({'id':user['id']},{'$set':{'current_foods.'+user['food']['name']:addfood(user['food'], user['id'])}})
        users.update_one({'id':user['id']},{'$inc':{'coins':-(user['food']['cost'])}})
        medit('–í—ã —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∞–ª–∏ –ø–æ—Å—Ç–∞–≤–∫—É —Å–≤–æ–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –±–∞—Ä! –û–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 24—á, –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å @Loshadkin.', call.message.chat.id, call.message.message_id)
  
  except:
    bot.send_message(441399484, traceback.format_exc())            
        

@bot.message_handler(commands=['cook'])
def cook(m):
    pass
       
        
def addsupply(sup, id):
    sup.update({'date':time.time(), 'owner':id, 'amount':0})
    return sup

def addfood(food, id):
    food.update({'date':time.time(), 'owner':id, 'amount':0})
    return food
        


def d_next_turn(duel):
    p = None
    ps = []
    lt = -1
    for ids in duel['players']:
        player = duel['players'][ids]
        if player['lastturn'] >= lt:
            lt = player['lastturn']
            ps.append(player)
    p = random.choice(ps)
    duel['current_player'] = p['id']
    kb = duelkb()
    bot.send_message(duel['id'], p['name']+', –≤—ã–±–µ—Ä–∏—Ç–µ, —Å –ø–æ–º–æ—â—å—é —á–µ–≥–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –≤ –¥—É—ç–ª–∏.', reply_markup = kb)
    t = threading.Timer(60, d_end_turn, args = [duel])
    t.start()
    game['timer'] = t
    

def d_end_turn(duel):
    pass
    
    
def duelkb():
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text = 'üí™–°–∏–ª–∞', callback_data = 'take advantage_strenght'))
    kb.add(types.InlineKeyboardButton(text = 'ü§∫–õ–æ–≤–∫–æ—Å—Ç—å', callback_data = 'take advantage_agility'))
    kb.add(types.InlineKeyboardButton(text = 'üß†–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç', callback_data = 'take advantage_intelligence'))
    kb.add(types.InlineKeyboardButton(text = 'üçÄ–£–¥–∞—á–∞', callback_data = 'take advantage_luck'))
    return kb
    
    
@bot.message_handler(commands=['me'])
def mee(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    text = '–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n'
    text += '–ú–æ–Ω–µ—Ç—ã: üí∞'+str(user['coins'])+'\n'
    text += '–ë–∏–∫–æ–∏–Ω—ã: üêù'+str(user['beecoins'])+'\n'
    if user['drunk'] > 0:
        text += '‚ùó–í—ã –ø—å—è–Ω—ã –Ω–∞ '+str(user['drunk'])+'%!\n'
    text += '–í—ã–ø–∏—Ç–æ: '+str(user['drinked'])+'üç∑\n'
    text += '–£—Ä–æ–≤–µ–Ω—å: '+str(user['lvl'])+'üèÖ\n'
    text += '–û—á–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: '+str(user['lvlpoints'])+'‚ûï\n'
    text += 'üí™–°–∏–ª–∞: '+str(user['strenght'])+'\n'
    text += 'ü§∫–õ–æ–≤–∫–æ—Å—Ç—å: '+str(user['agility'])+'\n'
    text += 'üß†–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: '+str(user['intelligence'])+'\n'
    text += 'üçÄ–£–¥–∞—á–∞: '+str(user['luck'])+'\n'
    text += 'ü•™–£–º–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–∏—Ç—å: '+str(user['cooking_skill'])+'\n'
    text += 'üîÆ–≠–Ω–µ—Ä–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã: '+str(user['void_energy'])+'\n'
    text += '‚ò£–ê–Ω–æ–º–∞–ª–∏—è –ø—É—Å—Ç–æ—Ç—ã: '+str(user['void_anomaly'])+'\n'
    
    bot.send_message(m.chat.id, text)
    
 
@bot.message_handler(commands=['horses'])
def horsessss(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    text = 'üî¥–ö—Ä–∞—Å–Ω–∞—è –ª–æ—à–∞–¥—å - –Ω–∞ —ç—Ç—É –ª–æ—à–∞–¥—å –Ω–µ–ª—å–∑—è –ø–æ–≤–ª–∏—è—Ç—å –Ω–∏–∫–∞–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏, –Ω–æ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø—ã—Ç–∞–µ—Ç—Å—è - —ç—Ç–∞ –ª–æ—à–∞–¥—å —Ç–æ–ª—å–∫–æ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è.\n\n'+\
    'üîµ–°–∏–Ω—è—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç 25% —à–∞–Ω—Å –∫–∞–∂–¥—ã–π —Ö–æ–¥ —É—Å–∫–æ—Ä–∏—Ç—å—Å—è –Ω–∞ 47 –µ–¥–∏–Ω–∏—Ü!\n\n'+\
    'üåï–ñ—ë–ª—Ç–∞—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç 25% —à–∞–Ω—Å –ø–ª—é–Ω—É—Ç—å –≤ –ª–æ—à–∞–¥–µ–π –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π –∏ —É—Å–∫–æ—Ä–∏—Ç—å—Å—è –Ω–∞ 40 –µ–¥–∏–Ω–∏—Ü, –æ—Å—Ç–∞–Ω–æ–≤–∏–≤ –∏—Ö –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ —Ö–æ–¥.\n\n'+\
    '‚ö´–ß—ë—Ä–Ω–∞—è –ª–æ—à–∞–¥—å - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –±–µ–∂–∏—Ç —Å –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é - 48 –µ–¥–∏–Ω–∏—Ü (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ª–æ—à–∞–¥–∏ –±–µ–≥—É—Ç –Ω–∞ 25-50 –µ–¥–∏–Ω–∏—Ü –∫–∞–∂–¥—ã–π —Ö–æ–¥).\n\n'+\
    'üå®–ú–æ—Ä–æ–∑–Ω–∞—è –ª–æ—à–∞–¥—å - –∫–∞–∂–¥—ã–π —Ö–æ–¥ –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –ª–æ—à–∞–¥–µ–π –Ω–∞ 7-12 –µ–¥–∏–Ω–∏—Ü, —Ç–∞–∫ –∂–µ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è –Ω–∞ 2 –µ–¥–∏–Ω–∏—Ü—ã –∑–∞ –∫–∞–∂–¥—É—é –∑–∞–º–µ–¥–ª–µ–Ω–Ω—É—é –ª–æ—à–∞–¥—å.\n\n'+\
    'üíä–ù–µ–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã—à–µ, —á–µ–º —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö (45-75 –µ–¥–∏–Ω–∏—Ü), –Ω–æ –∏–º–µ–µ—Ç 10% —à–∞–Ω—Å –¥–≤–∏–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥, –∞ –Ω–µ –≤–ø–µ—Ä—ë–¥.\n\n'+\
    'üí∂–î–æ—Ä–æ–≥–∞—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç 0.5% —à–∞–Ω—Å –∫—É–ø–∏—Ç—å –ø–æ–±–µ–¥—É –∫–∞–∂–¥—ã–π —Ö–æ–¥. –ï—Å–ª–∏ –æ–Ω–∞ –æ–∫–∞–∂–µ—Ç—Å—è –≤ —á–∏—Å–ª–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π, –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –Ω–µ—ë —É–≤–µ–ª–∏—á–∏—Ç—Å—è –≤ 6 —Ä–∞–∑!\n\n'+\
    'ü§ñ–†–æ–±–æ-–ª–æ—à–∞–¥—å - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥ –Ω–µ–π –µ—Å—Ç—å —Å–æ–ø–µ—Ä–Ω–∏–∫–∏, —Ç–æ –æ–Ω–∞ –±–µ–∂–∏—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 10-12 –µ–¥–∏–Ω–∏—Ü.\n\n'+\
    'ü§¨–¢–æ–∫—Å–∏—á–Ω–∞—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç 7% —à–∞–Ω—Å –∫–∞–∂–¥—ã–π —Ö–æ–¥ –æ—Å–∫–æ—Ä–±–∏—Ç—å –ª—é–±—É—é –ª–æ—à–∞–¥—å, –æ—Ç —á–µ–≥–æ —Ç–∞ —Å–æ–π–¥—ë—Ç —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏, –∞ —ç—Ç–∞ –ª–æ—à–∞–¥—å —É—Å–∫–æ—Ä–∏—Ç—Å—è –Ω–∞ 150 –µ–¥–∏–Ω–∏—Ü.\n\n'+\
    'üå™–ë—ã—Å—Ç—Ä–∞—è –ª–æ—à–∞–¥—å - –¥–≤–∏–≥–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö (28-70 –µ–¥–∏–Ω–∏—Ü).\n\n'+\
    'üëΩ–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç —à–∞–Ω—Å 12% –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–ª–µ–ø–æ—Ä—Ç. –ï—Å–ª–∏ –ª–æ—à–∞–¥—å –Ω–µ –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ, —Ç–æ –æ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Å –ø–µ—Ä–≤–æ–π. –ò–Ω–∞—á–µ '+\
      '–æ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ª–æ—à–∞–¥—å—é.\n\n'+\
    'üî®–õ–æ—à–∞–¥—å-—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä - —É–º–µ–Ω—å—à–∞–µ—Ç –¥–ª–∏–Ω—É –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –≤–¥–≤–æ–µ –≤ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–æ–Ω–∫—É —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ 140!\n\n'+\
    'üîÆ–õ–æ—à–∞–¥—å-–∫–æ–ª–¥—É–Ω - –≤ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–ª—É—á–∞–π–Ω–æ–π –ª–æ—à–∞–¥–∏ –∏–∑ –∏–≥—Ä—ã.\n\n'+\
    '‚ùì–°–ª—É—á–∞–π–Ω–∞—è –ª–æ—à–∞–¥—å - –≤ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ª–æ—à–∞–¥—å, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ —ç—Ç–æ–π –∏–≥—Ä–µ.\n\n'+\
    'üü£–í–æ–π–¥-–ª–æ—à–∞–¥—å - –∏–º–µ–µ—Ç 12% —à–∞–Ω—Å –∫–∞–∂–¥—ã–π —Ö–æ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –¥–≤–∞ —Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ª–æ—à–∞–¥–µ–π, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —ç—Ç–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.'
    try:
        bot.send_message(m.from_user.id, text)
        bot.send_message(m.chat.id, '–û—Ç–ø—Ä–∞–≤–∏–ª –ª–æ—à–∞–¥–µ–π –≤–∞–º –≤ –õ–°.')
    except:
        bot.send_message(m.chat.id, '–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –ª–∏—á–∫—É —Å–æ –º–Ω–æ–π!')
    

@bot.message_handler(commands=['reboot'])
def reboott(m):
    if m.from_user.id == 441399484:
        users.update_many({},{'$set':{'day_exp':80}})
        bot.send_message(m.chat.id, 'Yes.')
    
    
@bot.message_handler(commands=['bonus'])
def bonus(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    if time.time() - user['lastbonus'] >= 3600:
        x = int(random.randint(100, 250))
        if user['coins'] <= 0:
            x += 1000
        users.update_one({'id':user['id']},{'$set':{'lastbonus':time.time()}})
        users.update_one({'id':user['id']},{'$inc':{'coins':x}})
        bot.send_message(m.chat.id, '–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ–±–∫—É —Å –±–æ–Ω—É—Å–æ–º... –ü–æ–ª—É—á–µ–Ω–æ '+str(x)+'üí∞!', reply_to_message_id = m.message_id)
    else:
        mins = 60 - (int((user['lastbonus'] - time.time()) / 60) * -1)
        bot.send_message(m.chat.id, '–û—Ç–∫—Ä—ã–≤–∞—Ç—å –±–æ–Ω—É—Å –º–æ–∂–Ω–æ —Ä–∞–∑ –≤ —á–∞—Å! –û—Å—Ç–∞–ª–æ—Å—å '+str(mins)+' –º–∏–Ω—É—Ç!')
    
    
@bot.message_handler(commands=['cazino'])
def cazinooo(m):
    cazino(m)
    
    
def cazino(m):
    if m != None:
        if m.from_user.id in block:
            return
        user = users.find_one({'id':m.from_user.id})
        if user == None:
            user = users.insert_one(createuser(m.from_user))
            user = users.find_one({'id':m.from_user.id})
        chat = chats.find_one({'id':m.chat.id})
        if chat != None:
            if chat['adminmode'] and bot.get_chat_member(m.chat.id, m.from_user.id).status not in ['administrator', 'creator']:
                bot.send_message(m.chat.id, '–í–∫–ª—é—á–µ–Ω –∞–¥–º–∏–Ω-–º–æ–¥!')
                return
        if user['drunk'] >= 100 or user['afk_until'] > time.time():
            bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
            return
        if m.chat.id not in games:
            game = creategame(m)
            x = m.text.split(' ')
    
            games.update(game)
            game = games[m.chat.id]
            try:
                if int(x[1]) >= 0:
                    game['minimum'] = int(x[1])
            except:
                pass
            indexes = ''
            for ids in game['horses']:
                a = game['horses'][ids]
                indexes += htoe(a['name'])+a['name']+': `'+str(a['index'])+'`\n'
            bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç —Å–æ –≤–∑–Ω–æ—Å–æ–º *'+str(game['minimum'])+'*! /bet index, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ª–æ—à–∞–¥—å. '+
                             '–î–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–±–µ–≥–∞ –Ω–∞–ø–∏—à–∏—Ç–µ /go. –ò–Ω–¥–µ–∫—Å—ã –ª–æ—à–∞–¥–µ–π —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–±–µ–≥–∞:\n'+indexes, parse_mode = 'markdown')
        else:
            bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
            return
    else:
        game = creategame(m)
        games.update(game)
        return go(None)
    
    
@bot.message_handler(commands=['blind_bet'])
def cazino22345(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    chat = chats.find_one({'id':m.chat.id})
    if chat != None:
        if chat['adminmode'] and bot.get_chat_member(m.chat.id, m.from_user.id).status not in ['administrator', 'creator']:
            bot.send_message(m.chat.id, '–í–∫–ª—é—á–µ–Ω –∞–¥–º–∏–Ω-–º–æ–¥!')
            return
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    if m.chat.id not in games:
        
        tp = False
        if m.from_user.id == 441399484:
            try:
                g = m.text.split(' ')[2]
                if g == 'test':
                    tp = True
            except:
                pass
        if tp:
            c = False
            t = False
            while c == False or t == False:
                game = creategame(m, bets = 1, mode = 'blind', tp = tp)
                c = False
                t = False
                for ids in game[m.chat.id]['horses']:
                    if game[m.chat.id]['horses'][ids]['ability'] == 'coldun':
                        c = True
                    if game[m.chat.id]['horses'][ids]['ability'] == 'teleport':
                        t = True
        else:
            game = creategame(m, bets = 1, mode = 'blind', tp = tp)
                
        games.update(game)
        game = games[m.chat.id]       
               
            
        x = m.text.split(' ')
        
        
        try:
            if int(x[1]) >= 0:
                game['minimum'] = int(x[1])
        except:
            pass
        indexes = ''
        for ids in game['horses']:
            a = game['horses'][ids]
            indexes += htoe(a['name'])+a['name']+': `'+str(a['index'])+'`\n'
        bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç —Å–æ –≤–∑–Ω–æ—Å–æ–º *'+str(game['minimum'])+'*! /bet, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –°–õ–£–ß–ê–ô–ù–£–Æ –ª–æ—à–∞–¥—å –∑–∞–±–µ–≥–∞. '+
                         '–î–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–±–µ–≥–∞ –Ω–∞–ø–∏—à–∏—Ç–µ /go. –ö–∞–∫–∏–µ –ª–æ—à–∞–¥–∏ –±—É–¥—É—Ç –≤ –∏–≥—Ä–µ - —É–∑–Ω–∞–µ—Ç–µ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞!\n', parse_mode = 'markdown')
    else:
        bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
        return
    
    
    
@bot.message_handler(commands=['give'])
def givee(m):

    if m.from_user.id == 441399484:
        try:
            users.update_one({'id':m.reply_to_message.from_user.id},{'$inc':{'coins':int(m.text.split(' ')[1])}})
        except:
            pass

@bot.message_handler(commands=['stats'])
def statistic(m):
  if m.from_user.id == 441399484:
    text = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n\n'
    s = stats.find_one({})
    for ids in s:
        try:
            h = None
            for idss in horses:
                if str(idss['index']) == ids:
                    h = idss
            if h != None:
                text += htoe(h['name'])+h['name']+': '+str(s[ids]['wins'])+'/'+str(s[ids]['games'])+' –ø–æ–±–µ–¥, –≤–∏–Ω—Ä–µ–π—Ç '+\
                str(round((s[ids]['wins']/s[ids]['games'])*100, 2))+'%\n\n'
        except:
            pass
    bot.send_message(m.chat.id, text)
        
@bot.message_handler(commands=['bet'])
def bett(m):
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['drunk'] >= 100 or user['afk_until'] > time.time():
        bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
        return
    if m.chat.id in games:
        if games[m.chat.id]['started'] == True:
            bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
            return
        
        game = games[m.chat.id]
        if game['mode'] == None:
            x = m.text.split(' ')
            if len(x) < 2:
                bot.send_message(m.chat.id, '–ü–æ—Å–ª–µ /bet —É–∫–∞–∂–∏—Ç–µ –∏–Ω–¥–µ–∫—Å –ª–æ—à–∞–¥–∏!')
                return
            x = x[1]
            h = None
            game = games[m.chat.id]
            for ids in game['horses']:
                a = game['horses'][ids]
                if str(a['index']) == x:
                    h = a
            if h == None:
                bot.send_message(m.chat.id, '–õ–æ—à–∞–¥–∏ —Å –∏–Ω–¥–µ–∫—Å–æ–º "'+x+'" –Ω–µ—Ç –≤ —ç—Ç–æ–π –∏–≥—Ä–µ!', reply_to_message_id = m.message_id)
                return
            if m.from_user.id not in game['players']:
                game['players'].update(createplayer(m.from_user))
            if h['index'] in game['players'][m.from_user.id]['bets']:
                bot.send_message(m.chat.id, '–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∞ —ç—Ç—É –ª–æ—à–∞–¥—å!')
                return
            
            if user['coins'] >= game['minimum']:
              if len(game['players'][m.from_user.id]['bets']) < game['maxbets']:
             
                game['players'][m.from_user.id]['bets'].update(createbet(m.from_user, game, h))
                game['cache'] += game['minimum']
                users.update_one({'id':user['id']},{'$inc':{'coins':-game['minimum'], 'reloadcoins':game['minimum']}})
                bot.send_message(m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∞ –ª–æ—à–∞–¥—å!')
              else:
                bot.send_message(m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å—Ç–∞–≤–æ–∫ - '+str(game['maxbets'])+'!')
                return
            else:
                bot.send_message(m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç (–Ω—É–∂–Ω–æ '+str(game['minimum'])+')!')

        elif game['mode'] == 'blind':
            if user['coins'] >= game['minimum']:
              if m.from_user.id not in game['players']:
                game['players'].update(createplayer(m.from_user))
              if len(game['players'][m.from_user.id]['bets']) < game['maxbets']:
                
                hs = []
                for ids in game['horses']:
                    hs.append(game['horses'][ids])
                h = random.choice(hs)
                game['players'][m.from_user.id]['bets'].update(createbet(m.from_user, game, h))
                game['cache'] += game['minimum']
                users.update_one({'id':user['id']},{'$inc':{'coins':-game['minimum'], 'reloadcoins':game['minimum']}})
                bot.send_message(m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é –ª–æ—à–∞–¥—å!')
              else:
                bot.send_message(m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å—Ç–∞–≤–æ–∫ - '+str(game['maxbets'])+'!')
                return
            else:
                bot.send_message(m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç (–Ω—É–∂–Ω–æ '+str(game['minimum'])+')!')
            
            
def unlock(id):
    try:
        banchats.remove(id)
    except:
        pass 

       
@bot.message_handler(commands=['brokengame'])
def brokenn(m):
    if m.chat.id not in games:
        bot.send_message(m.chat.id, '–í —á–∞—Ç–µ –¥–∞–∂–µ –Ω–µ –∏–¥—ë—Ç –∏–≥—Ä–∞!')
        return
    game = games[m.chat.id]
    if game['starttime'] != None and time.time() - game['starttime'] >= 300:
        del games[game['id']]
        bot.send_message(m.chat.id, '–£–¥–∞–ª–∏–ª —Å–ª–æ–º–∞–Ω–Ω—É—é –∏–≥—Ä—É!')
    else:
        bot.send_message(m.chat.id, '–ï—â—ë –Ω–µ –ø—Ä–æ—à–ª–æ 5 –º–∏–Ω—É—Ç, —á—Ç–æ–±—ã –∏–≥—Ä–∞ —Å—á–∏—Ç–∞–ª–∞—Å—å —Å–ª–æ–º–∞–Ω–Ω–æ–π!')


@bot.message_handler(commands=['go'])
def gooo(m):
    if m.chat.id not in banchats:
        banchats.append(m.chat.id)
        threading.Timer(2, unlock, args = [m.chat.id]).start()
    else:
        return
    if m != None:
        threading.Timer((random.randint(1, 20)/10), go, args = [m]).start()
    else:
        go(m)

def go(m):
  try:
    if m != None:
        if m.chat.id not in games:
            bot.send_message(m.chat.id, '–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞!')
            return
        game = games[m.chat.id]
        if game['started'] == True:
            return
        if m.from_user.id in block:
            return
        user = users.find_one({'id':m.from_user.id})
        if user == None:
            user = users.insert_one(createuser(m.from_user))
            user = users.find_one({'id':m.from_user.id})
        if user['drunk'] >= 100 or user['afk_until'] > time.time():
            bot.send_message(m.chat.id, '–í—ã —Å–ø–∏—Ç–µ!')
            return
        if True:
            if time.time() - game['createtime'] < 60:
                bot.send_message(m.chat.id, '–ï—â—ë –Ω–µ –ø—Ä–æ—à–ª–∞ –º–∏–Ω—É—Ç–∞ —Å–æ —Å—Ç–∞—Ä—Ç–∞! –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –≤—Å–µ, –∫—Ç–æ —Ö–æ—á–µ—Ç, —Å–¥–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫—É!')
                return
            games[m.chat.id]['started'] = True
            games[m.chat.id]['starttime'] = time.time()
            if game['mode'] == 'blind':
                bets = ''
                for ids in game['players']:
                    player = game['players'][ids]
                    for idss in player['bets']:
                        h = player['bets'][idss]['horse']
                    for ids in horses:
                        if ids['index'] == h:
                            h = ids.copy()
                    bets += player['name']+': '+htoe(h['name'])+h['name']+'\n\n'
                bot.send_message(game['id'], '–°—Ç–∞–≤–∫–∏:\n\n'+bets)
            s = stats.find_one({})
            for ids in game['horses']:
                h = game['horses'][ids]
                if str(h['index']) not in s:
                    stats.update_one({},{'$set':{str(h['index']):{'games':0, 'wins':0}}})                         
    else:
        game = games[1]
    for ids in game['horses']:
        h = game['horses'][ids]
        if h['ability'] == 'random_horse':
            hs = []
            hs_not = []
            for ids in game['horses']:
                hs.append(game['horses'][ids])
            for ids in horses:
                allow = True
                for idss in hs:
                    if idss['index'] == ids['index']:
                        allow = False
                if allow:
                    hs_not.append(ids)
            newh = random.choice(hs_not).copy()
            newh.update(toupdate)
            newh['index'] = h['index']
            if game['stats_test'] == False:
                tobet = []
                for ids in game['players']:
                    for idss in game['players'][ids]['bets']:
                        if idss == h['index']:
                            tobet.append(ids)
                for ids in tobet:
                    game['players'][ids]['bets'].update(createbet(game['players'][ids], game, newh))
            del game['horses'][h['index']]
            game['horses'].update({newh['index']:newh.copy()})
            if game['stats_test'] == False:
                bot.send_message(game['id'], '‚ùì–°–ª—É—á–∞–π–Ω–∞—è –ª–æ—à–∞–¥—å –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ '+htoe(newh['name'])+newh['name']+'!')
            game['allhorses'].update({newh['index']:newh})
    ll = []
    for ids in game['horses']:
        h = game['horses'][ids]
        if h['ability'] == 'coldun':
            hs = []
            for ids in game['horses']:
                if game['horses'][ids]['index'] != h['index']:
                    hs.append(game['horses'][ids])
            newh = random.choice(hs)
            newh = newh.copy()
            h['ability'] = newh['ability']
            if game['tp'] == True:
                h['ability'] = 'teleport'
                newh['name'] = '–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ—à–∞–¥—å'
                newh['ability'] = 'teleport'
            if game['stats_test'] == False:
                bot.send_message(game['id'], htoe(h['name'])+h['name']+' –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ª–æ—à–∞–¥–∏ '+htoe(newh['name'])+newh['name']+'!')
            if newh['ability'] == 'teleport':
                ll = []
                need = 5
                i = 0
                index = -1
                while i < need:
                    nh = newh.copy()
                    nh['index'] = index
                    index -= 1
                    ll.append(nh)
                    i += 1
                if game['stats_test'] == False:
                    try:
                        bot.send_message(game['id'], '–û –Ω–µ—Ç, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–ª–æ–º–∞–Ω–æ!')
                    except:
                        pass
    for hh in ll:
        game['horses'].update({hh['index']:hh})
                   
    for ids in game['horses']:
        if game['horses'][ids]['ability'] == 'change_distance':
            game['lenght'] -= (game['lenght']/2)
            game['horses'][ids]['distance'] = 140
    #for ids in game['horses']:
    #    h = game['horses'][ids]
    #    if h['ability'] == 'bonus_reward' and random.randint(1, 100) <= 5:
    #        h['distance'] = game['lenght']
    #        if game['stats_test'] == False:
    #            game['text'] += htoe(h['name'])+h['name']+' –∫—É–ø–∏–ª–∞ –ø–æ–±–µ–¥—É –≤ —Å–∫–∞—á–∫–∞—Ö!'
    if game['stats_test'] == False:
        if len(game['players']) > 1:
            if game['mode'] == None:
                game['cache'] = int(game['cache'] * 1.5)
            elif game['mode'] == 'blind':
                game['cache'] = int(game['cache'] * 3)
    if game['stats_test'] == False:
        bot.send_message(m.chat.id, '–°–∫–∞—á–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è!')
        msg = bot.send_message(m.chat.id, results(game))
        game['msg'] = msg
    if game['stats_test'] == False:
        threading.Timer(5, next_turn, args=[game]).start()
    else:
        return next_turn(game)
  except:
    bot.send_message(441399484, traceback.format_exc())
    del games[game['id']]
    bot.send_message(m.chat.id, '–û—à–∏–±–∫–∞! –°–±—Ä–∞—Å—ã–≤–∞—é –∏–≥—Ä—É.')
        
@bot.message_handler(commands=['notifications'])
def notees(m):
    if m.chat.id == m.from_user.id:
        return
    chat = chats.find_one({'id':m.chat.id})
    if chat == None:
        chats.insert_one(createchat(m.chat))
        chat = chats.find_one({'id':m.chat.id})
    if bot.get_chat_member(m.chat.id, m.from_user.id).status not in ['administrator', 'creator']:
        bot.send_message(m.chat.id, '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —ç—Ç–æ!')
        return
    if chat['notifications'] == True:
        chats.update_one({'id':m.chat.id},{'$set':{'notifications':False}})
        bot.send_message(m.chat.id, '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã!')
    else:
        chats.update_one({'id':m.chat.id},{'$set':{'notifications':False}})
        bot.send_message(m.chat.id, '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –≤–∫–ª—é—á–µ–Ω—ã!')
        

@bot.message_handler()
def allms(m):
    chat = chats.find_one({'id':m.chat.id})
    if chat == None:
        chats.insert_one(createchat(m.chat))
    if m.chat.id != m.from_user.id:
        return
    if m.from_user.id in block:
        return
    user = users.find_one({'id':m.from_user.id})
    if user == None:
        user = users.insert_one(createuser(m.from_user))
        user = users.find_one({'id':m.from_user.id})
    if user['name'] != m.from_user.first_name:
        users.update_one({'id':user['id']},{'$set':{'name':m.from_user.first_name}})
    if user['set'] != None:
        if user['supply'] == None:
            users.update_one({'id':user['id']},{'$set':{'set':None}})
           
            bot.send_message(m.chat.id, '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫ (/create_supply)!')
            return
        if user['set'] == 'cost':
            try:
                cost = int(m.text)
            except:
                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!')
                return
            if cost < 1:
                bot.send_message(m.chat.id, '–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ –Ω—É–ª—è!')
                return
            users.update_one({'id':user['id']},{'$set':{'supply.cost':cost, 'set':None}})
            bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞ –Ω–∞–ø–∏—Ç–∫–∞: '+str(cost)+'üí∞.')
            
        elif user['set'] == 'name':
            if '#' in m.text:
                bot.send_message(m.chat.id, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–º–≤–æ–ª: "#"!')
                return
            if '.' in m.text:
                bot.send_message(m.chat.id, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–º–≤–æ–ª: "."!')
                return
            users.update_one({'id':user['id']},{'$set':{'supply.name':m.text, 'set':None}})
            bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞: "'+m.text+'".')
        
        elif user['set'] == 'drunk':
            try:
                drunk = int(m.text)
            except:
                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!')
                return
            if drunk > 300 or drunk < -25:
                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç -25 –¥–æ 300!')
                return
            users.update_one({'id':user['id']},{'$set':{'supply.drunk':drunk, 'set':None}})
            bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –æ–ø—å—è–Ω–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞: '+str(drunk)+'%.')
            
    if user['f_set'] != None:
        pass
   #     if user['food'] == None:
 #           users.update_one({'id':user['id']},{'$set':{'f_set':None}})
#           
 #           bot.send_message(m.chat.id, '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç (/create_food)!')
 #           return
 #       if user['f_set'] == 'cost':
 #           try:
 #               cost = int(m.text)
 #           except:
 #               bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!')
 #               return
 #           if cost < 1:
  #              bot.send_message(m.chat.id, '–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ –Ω—É–ª—è!')
  #              return
 #           users.update_one({'id':user['id']},{'$set':{'food.cost':cost, 'f_set':None}})
 #           bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞: '+str(cost)+'üí∞.')
 #           
#        elif user['f_set'] == 'name':
   #         if '#' in m.text:
#                bot.send_message(m.chat.id, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–º–≤–æ–ª: "#"!')
 #               return
 #           users.update_one({'id':user['id']},{'$set':{'food.name':m.text, 'f_set':None}})
#            bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞: "'+m.text+'".')
#        
#        elif user['f_set'] == 'feed':
#            try:
#                fd = int(m.text)
#            except:
#                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!')
#                return
#            if fd > 100 or fd < 0:
#                bot.send_message(m.chat.id, '–ù—É–∂–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0 –¥–æ 100!')
#                return
#            users.update_one({'id':user['id']},{'$set':{'food.sitost':fd, 'f_set':None}})
#            bot.send_message(m.chat.id, '–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞: '+str(fd)+'%.')
           


def next_turn(game):
  try:
    for ids in game['horses']:
        a = game['horses'][ids]
        if a['void'] <= 0:
            min = 25
            max = 50
            z = '+'
            bonus = 0
            if a['stun'] <= 0:
                if a['ability'] == 'accelerate' and random.randint(1,100) <= 25:
                    bonus += 47
                elif a['ability'] == 'stable':
                    min = 48
                    max = 48
                elif a['ability'] == 'random_move':
                    min = 45
                    max = 75
                    if random.randint(1,100) <= 10:
                        z = '-'
                elif a['ability'] == 'small_reward':
                    min = 28
                    max = 70
                if z == '+':
                    a['distance'] += random.randint(min, max)+bonus+a['bonus']
                else:
                    a['distance'] -= (random.randint(min, max)+bonus+a['bonus'])
                a['bonus'] = 0
            a['stun'] -= 1
            if a['stun']< 0:
                a['stun'] = 0
        
    
    topop = []
    for ids in game['horses']:
        a = game['horses'][ids]
        if a['void'] <= 0:
            if a['ability'] == 'hit' and random.randint(1, 100) <= 25:
                targets = []
                for idss in game['horses']:
                    b = game['horses'][idss]
                    if a['distance'] - b['distance'] >= -300 and a['distance'] - b['distance'] <= 20 and a['index'] != b['index']:
                        targets.append(b)
                if len(targets) > 0:
                    target = random.choice(targets)
                    if target['ability'] != 'bkb':
                        target['stun'] += 1
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –ø–ª—é–Ω—É–ª–∞ –≤ '+htoe(target['name'])+target['name']+'! –û–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥.\n'
                        a['distance'] += 40
                    else:
                        b['stun'] += 1
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –ø–ª—é–Ω—É–ª–∞ –≤ '+htoe(target['name'])+target['name']+', –Ω–æ —Ç–∞ —É–≤–µ—Ä–Ω—É–ª–∞—Å—å –∏ –ø–ª—é–Ω—É–ª–∞ –≤ –æ—Ç–≤–µ—Ç!\n'
                        target['distance'] += 40
                
            elif a['ability'] == 'slowdown':
                try:
                    amount = random.randint(1, len(game['horses'])-1)
                except:
                    amount = 0
                targets = []
                hs = []
                for ids in game['horses']:
                    hs.append(game['horses'][ids])
                while len(targets) < amount:
                    x = random.choice(hs)
                    if x not in targets and x['index'] != a['index']:
                        targets.append(x)
                #game['text'] += htoe(a['name'])+a['name']+' –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏—Ö –ª–æ—à–∞–¥–µ–π –Ω–∞ 6 –µ–¥–∏–Ω–∏—Ü:\n'
                for idss in targets:
                    if idss['ability'] != 'bkb':
                        idss['bonus'] -= random.randint(7, 12)
                        a['bonus'] += 2
                    else:
                        idss['bonus'] += random.randint(4, 7)
                
            elif a['ability'] == 'catch':
                allow = False
                for idss in game['horses']:
                    b = game['horses'][idss]
                    if b['distance'] > a['distance']:
                        allow = True
                if allow:
                    if a['stun'] <= 0:
                        a['distance'] += random.randint(10, 12)
                    
            elif a['ability'] == 'kick' and random.randint(1, 100) <= 7:
                if len(game['horses']) > 1:
                    hs = []
                    for ids in game['horses']:
                        hs.append(game['horses'][ids])
                    k = random.choice(hs)
                    while k['index'] == a['index']:
                        k = random.choice(hs)
                    if k['ability'] != 'bkb':
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –æ—Å–∫–æ—Ä–±–ª—è–µ—Ç '+htoe(k['name'])+k['name']+' –Ω–∞ –ª–æ—à–∞–¥–∏–Ω–æ–º –∏ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è! –¢–∞ —Ç–µ—Ä—è–µ—Ç –≤–µ—Ä—É –≤ —Å–µ–±—è –∏ —Å—Ö–æ–¥–∏—Ç —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏.\n'
                        topop.append(k)
                        a['distance'] += 150
                    else:
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –æ—Å–∫–æ—Ä–±–ª—è–µ—Ç '+htoe(k['name'])+k['name']+' –Ω–∞ –ª–æ—à–∞–¥–∏–Ω–æ–º, –Ω–æ —Ç–∞ —Ç–æ–ª—å–∫–æ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è!\n' 
                            k['distance'] += 250
                            
            elif a['ability'] == 'stoptime' and random.randint(1,100) <= 12:
                hs = []
                for ids in game['horses']:
                    hs.append(game['horses'][ids])
                for ids in hs:
                    if ids['ability'] != 'stoptime':
                        if ids['ability'] != 'bkb':
                            ids['void'] += 3
                        else:
                            pass
                                                
                if game['stats_test'] == False:
                    game['text'] += htoe(a['name'])+a['name']+' –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ª–æ—à–∞–¥–µ–π –Ω–∞ 2 —Ö–æ–¥–∞!\n'
                            
            elif a['ability'] == 'teleport' and random.randint(1,100) <= 12:
                hs = []
                for ids in game['horses']:
                    hs.append(game['horses'][ids])
                first = None
                fd = 0
                for ids in hs:
                    if fd < ids['distance']:
                        fd = ids['distance']
                        first = ids
                if first['index'] != a['index']:
                    if first['ability'] != 'bkb':
                        f = first['distance']
                        first['distance'] = a['distance']
                        a['distance'] = f
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –º–µ–Ω—è–µ—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Å –ø–µ—Ä–≤–æ–π –ª–æ—à–∞–¥—å—é - '+htoe(first['name'])+first['name']+'!\n'
                    else:
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–º–µ–Ω—è—Ç—å—Å—è –º–µ—Å—Ç–∞–º–∏ —Å '+htoe(first['name'])+first['name']+', –Ω–æ —Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –∫–æ–ø—ã—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ä—Ç–∞–ª!\n'
                            first['distance'] += 50
                   
                else:
                    
                    last = None
                    fd = 2000
                    for ids in hs:
                        if fd > ids['distance']:
                            fd = ids['distance']
                            last = ids
                    if last['ability'] != 'bkb':
                        f = last['distance']
                        last['distance'] = a['distance']
                        a['distance'] = f
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –º–µ–Ω—è–µ—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ª–æ—à–∞–¥—å—é - '+htoe(last['name'])+last['name']+'!\n'
                    else:
                        if game['stats_test'] == False:
                            game['text'] += htoe(a['name'])+a['name']+' –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–º–µ–Ω—è—Ç—å—Å—è –º–µ—Å—Ç–∞–º–∏ —Å '+htoe(last['name'])+last['name']+', –Ω–æ —Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –∫–æ–ø—ã—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ—Ä—Ç–∞–ª!\n'
                            last['distance'] += 50

    for ids in game['horses']:
      if game['horses'][ids]['void'] <= 0:
        if game['horses'][ids]['ability'] == 'bonus_reward' and random.randint(1, 1000) <= 5:
            game['horses'][ids]['distance'] = game['lenght']
            if game['stats_test'] == False:
                game['text'] += htoe(game['horses'][ids]['name'])+game['horses'][ids]['name']+' –∫—É–ø–∏–ª–∞ –ø–æ–±–µ–¥—É!\n'
                            
         
    for ids in game['horses']:
        a = game['horses'][ids]
        a['void'] -= 1
        if a['void']< 0:
            a['void'] = 0  
            
    for ids in topop:
        try:
            game['horses'].pop(ids['index'])
        except:
            pass
    try:
        if game['stats_test'] == False:
            msg = bot.send_message(game['id'], game['text'])
            game['delmsgs'].append(msg)
    except:
        pass
    return resets(game)
  except:
    bot.send_message(441399484, traceback.format_exc())
            
     
def resets(game):
    for ids in game['horses']:
        a = game['horses'][ids]
        
    game['text'] = ''
    win = []
    if game['stats_test'] == False:
        try:
            medit(results(game), game['id'], game['msg'].message_id)
        except:
            pass
    for ids in game['horses']:
        a = game['horses'][ids]
        if a['distance'] >= game['lenght']:
            win.append(a)
    itog = []
    if len(win) > 0:
        while len(win) > 0:
            maxd = 0
            w = None
            for ids in win:
                if ids['distance'] > maxd:
                    maxd = ids['distance']
                    w = ids
            itog.append(w)
            win.remove(w)
    for ids in itog:
        game['winners'].append(ids)
        game['horses'].pop(ids['index'])
    if len(game['winners']) >= 3 or len(game['horses']) == 0: 
        return endgame(game)
    else:
        if game['stats_test'] == False:
            threading.Timer(4, next_turn, args=[game]).start()
        else:
            return next_turn(game)
    

def endgame(game):
    s = stats.find_one({})
    for ids in game['allhorses']:
        h = game['allhorses'][ids]
        if str(h['index']) not in s:
            stats.update_one({},{'$set':{str(h['index']):{'games':0, 'wins':0}}}) 
    spisok = {}
    text = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–±–µ–≥–∞:\n'
    i = 1
    dell = []
    if game['stats_test'] == False:
        for ids in game['delmsgs']:
            try:
                bot.delete_message(game['id'], ids.message_id)
            except:
                pass
    for ids in game['winners']:
        if i <= 3:
            if game['stats_test'] == False:
                text += str(i)+' –º–µ—Å—Ç–æ: '+htoe(ids['name'])+ids['name']+'\n'
                stats.update_one({},{'$inc':{str(ids['index'])+'.wins':1}})
            else:
                spisok.update({ids['index']:'win'})
        else:
            dell.append(ids)
        i += 1
    for ids in dell:
        game['winners'].remove(ids)
        
    if game['stats_test'] == False:
        try:
            bot.send_message(game['id'], text)
        except:
            pass
    text = ''
    if game['stats_test'] == False:
        time.sleep(5)
    if game['stats_test'] == False:
        pl1 = []
        pl2 = []
        pl3 = []
        pl3c = int((game['cache']/100)*10)
        pl2c = int((game['cache']/100)*30)
        game['cache'] -= pl3c
        game['cache'] -= pl2c
    
        pl1c = game['cache']
        game['cache'] -= pl1c
                
                
        for ids in game['players']:
            try:
              if game['winners'][0]['index'] in game['players'][ids]['bets']:
                pl1.append(game['players'][ids])
            except:
              pass
            try:
              if game['winners'][1]['index'] in game['players'][ids]['bets']:
                pl2.append(game['players'][ids])
            except:
              pass
            try:
              if game['winners'][2]['index'] in game['players'][ids]['bets']:
                pl3.append(game['players'][ids])
            except:
              pass
        p1_upd = 0
        p2_upd = 0
        p3_upd = 0
        poll = 0
        dis = []
        if len(pl1) == 0:
            poll += pl1c
            dis.append('1')
        if len(pl2) == 0:
            poll += pl2c
            dis.append('2')
        if len(pl3) == 0:
            poll += pl3c
            dis.append('3')
            
        if poll > 0:
            bot.send_message(441399484, 'poll>0')
            if '1' in dis:
                if '2' not in dis and '3' not in dis:
                    pl2c += int((poll/100)*70)
                    pl3c += poll-int((poll/100)*70)
                    try:
                        bot.send_message(441399484, '1 in, 2n3 not')
                    except:
                        pass
                elif '2' not in dis:
                    pl2c += poll
                    bot.send_message(441399484, '1 in, 2 not')
           
                elif '3' not in dis:
                    pl3c += poll
                    bot.send_message(441399484, '1 in, 3 not')
           
            elif '2' in dis:
                if '1' not in dis and '3' not in dis:
                    pl1c += int((poll/100)*90)
                    pl3c += poll-int((poll/100)*90)
                    bot.send_message(441399484, '2 in, 1n3 not')
           
                elif '1' not in dis:
                    pl1c += poll
                    bot.send_message(441399484, '2 in, 1 not')
           
                elif '3' not in dis:
                    pl3c += poll
                    bot.send_message(441399484, '2 in, 3 not')
           
            elif '3' in dis:
                if '1' not in dis and '2' not in dis:
                    pl1c += int((poll/100)*70)
                    pl2c += poll-int((poll/100)*70)
                    bot.send_message(441399484, '3 in, 1n2 not')
           
                elif '1' not in dis:
                    pl1c += poll
                    bot.send_message(441399484, '3 in, 1 not')
           
                elif '2' not in dis:
                    pl2c += poll
                    bot.send_message(441399484, '3 in, 2 not')
           
        br = 6  
        try:
          if game['winners'][0]['ability'] == 'bonus_reward':
            pl1c = pl1c * br 
        except:
          pass
            
        try:
          if game['winners'][1]['ability'] == 'bonus_reward':
            pl2c = pl2c * br
        except:
          pass
            
        try:
          if game['winners'][2]['ability'] == 'bonus_reward':
            pl3c = pl3c * br
        except:
          pass
            
        try:
          if game['winners'][0]['ability'] == 'small_reward':
            pl1c = int(pl1c / 1)
        except:
          pass
            
        try:
          if game['winners'][1]['ability'] == 'small_reward':
            pl2c = int(pl2c / 1) 
        except:
          pass
            
        try:
          if game['winners'][2]['ability'] == 'small_reward':
            pl3c = int(pl3c / 1)
        except:
          pass
        
        
        if len(pl1) > 0:
            p1_upd = int(pl1c/len(pl1))
    
        if len(pl2) > 0:
            p2_upd = int(pl2c/len(pl2))
    
        if len(pl3) > 0:
            p3_upd = int(pl3c/len(pl3))
        
        
        
        
        text += '–°–ª–µ–¥—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç '+str(p1_upd)+' –º–æ–Ω–µ—Ç –∑–∞ –ø–µ—Ä–≤—É—é –ª–æ—à–∞–¥—å:\n'
        for ids in pl1:
            text += ids['name']+' '
            users.update_one({'id':ids['id']},{'$inc':{'coins':p1_upd}})
        text += '\n\n'
    
        text += '–°–ª–µ–¥—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç '+str(p2_upd)+' –º–æ–Ω–µ—Ç –∑–∞ –≤—Ç–æ—Ä—É—é –ª–æ—à–∞–¥—å:\n'
        for ids in pl2:
            text += ids['name']+' '
            users.update_one({'id':ids['id']},{'$inc':{'coins':p2_upd}})
        text += '\n\n'
        
        text += '–°–ª–µ–¥—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç '+str(p3_upd)+' –º–æ–Ω–µ—Ç –∑–∞ —Ç—Ä–µ—Ç—å—é –ª–æ—à–∞–¥—å:\n'
        for ids in pl3:
            text += ids['name']+' '
            users.update_one({'id':ids['id']},{'$inc':{'coins':p3_upd}})
        for ids in game['players']:
            a = game['players'][ids]
            for idss in game['players'][ids]['bets']:
                users.update_one({'id':a['id']},{'$inc':{'reloadcoins':-game['minimum']}})
   
    dtext = ''
    to_pasyuk = ''
    if game['stats_test'] == False:
        if game['mode'] == 'blind' and game['minimum'] >= 500:
            for ids in pl1:
                coef = 1.2
                x = random.randint(1, 1000)
                stone = None
                if x <= 500*coef:
                    stone = 'typically'
                if x <= 200*coef:
                    stone = 'rare'
                if x <= 75*coef:
                    stone = 'epic'
                if x <= 5:
                    stone = 'legendary'
                if stone != None:
                    dtext += ids['name']+': '+portaltotext(stone)+'\n'
                    bot.send_message(441399484, str(users.update_one({'id':ids['id']},{'$inc':{'portals.'+stone:1}})))
                    to_pasyuk += ids['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+portaltotext(stone)+'!\n'
                
            for ids in pl2:
                coef = 1.1
                x = random.randint(1, 1000)
                stone = None
                if x <= 500*coef:
                    stone = 'typically'
                if x <= 200*coef:
                    stone = 'rare'
                if x <= 75*coef:
                    stone = 'epic'
                if x <= 4:
                    stone = 'legendary'
                if stone != None:
                    dtext += ids['name']+': '+portaltotext(stone)+'\n'
                    bot.send_message(441399484, str(users.update_one({'id':ids['id']},{'$inc':{'portals.'+stone:1}})))
                    to_pasyuk += ids['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+portaltotext(stone)+'!\n'
                    
            for ids in pl3:
                coef = 1
                x = random.randint(1, 1000)
                stone = None
                if x <= 500*coef:
                    stone = 'typically'
                if x <= 200*coef:
                    stone = 'rare'
                if x <= 75*coef:
                    stone = 'epic'
                if x <= 3:
                    stone = 'legendary'
                if stone != None:
                    dtext += ids['name']+': '+portaltotext(stone)+'\n'
                    bot.send_message(441399484, str(users.update_one({'id':ids['id']},{'$inc':{'portals.'+stone:1}})))
                    to_pasyuk += ids['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+portaltotext(stone)+'!\n'
                
    if game['stats_test'] == False:
        for ids in game['allhorses']:
            h = game['allhorses'][ids]
            stats.update_one({},{'$inc':{str(h['index'])+'.games':1}})
    else:
        for ids in game['allhorses']:
            h = game['allhorses'][ids]
            if h['index'] not in spisok:
                spisok.update({h['index']:'lost'})
        
    if game['stats_test'] == False:
        text += '\n\n'
        try:
            bot.send_message(game['id'], text)
        except:
            pass
        text = ''
        time.sleep(3)
        if dtext != '':
          try:
            bot.send_message(441399484, '–°–ª–µ–¥—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞—à–ª–∏ –Ω–∞ –∏–ø–ø–æ–¥—Ä–æ–º–µ –∫–∞–º–Ω–∏ –ø—Ä–∏–∑—ã–≤–∞:\n'+dtext)
        
            bot.send_message(game['id'], '–°–ª–µ–¥—É—é—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞—à–ª–∏ –Ω–∞ –∏–ø–ø–æ–¥—Ä–æ–º–µ –∫–∞–º–Ω–∏ –ø—Ä–∏–∑—ã–≤–∞:\n'+dtext)
          except:
            pass
        time.sleep(4)
        bot.send_message(game['id'], '–ö–æ–Ω–µ—Ü –∑–∞–±–µ–≥–∞!')
        del games[game['id']]
    else:
        try:
            del games[1]
        except:
            pass
        return spisok
    
        
            
    
    
        
def results(game):
    text = ''
    for ids in game['horses']:
        a = game['horses'][ids]
        if a['bonus'] < 0:
            text += '‚ùÑ'
        text += htoe(a['name'])+a['name']+': '+str(int((a['distance']/game['lenght'])*100))+'%\n'
    return text


def createduel(id, players, cost):
    pls = {}
    for ids in players:
        pls.update(createduelplayer(ids))
    name = '?'
    types = ['draka', 'chess', 'throw_bottles']
    
    x = random.choice(types)
    if x == 'draka':
        name = '–î—Ä–∞–∫–∞'
    elif x == 'chess':
        name = '–®–∞—Ö–º–∞—Ç—ã'
    elif x == 'throw_bottles':
        name = '–ë—Ä–æ—Å–∞–Ω–∏–µ –±—É—Ç—ã–ª–æ–∫'
    return {id:{
        'id':id,
        'name':name,
        'players':pls,
        'bet':cost,
        'type':x,
        'current_player':None
    }
           }

def createduelplayer(player):
    x = {player['id']:player}
    x.update({
        'progress':0,
        'lastturn':0        # —Ö–æ–¥–æ–≤ –Ω–∞–∑–∞–¥
    })
    return x

   
def createbet(user, game, h):
    return {h['index']:{
        'cache':game['minimum'],
        'horse':h['index']
    }
           }


def creategame(m, count = 7, lenght = 1000, minimum = 50, cache = 0, bets = 3, mode = None, tp = False):
    h = {}
    while len(h) < count:
        x = random.choice(horses).copy()
        if x['index'] not in h:
            h.update({x['index']:x})
    for ids in h:
        h[ids].update(toupdate)
    if m != None:
        return {m.chat.id:{
          'id':m.chat.id,
          'players':{},
          'horses':h,
          'lenght':lenght,
          'minimum':minimum,
          'started':False,
          'msg':None,
          'turn':1,
          'text':'',
          'winners':[],
          'cache':cache,
          'delmsgs':[],
          'createtime':time.time(),
          'allhorses':h.copy(),
          'mode':mode,
          'maxbets':bets,
          'stats_test':False,
          'tp':tp,
          'starttime':None
            
        }
               }
    else:
        return {1:{
          'id':1,
          'horses':h,
          'lenght':lenght,
          'msg':None,
          'turn':1,
          'winners':[],
          'allhorses':h.copy(),
          'stats_test':True,
          'tp':tp
            
        }
               }
  
    
def htoe(h):
    x = '‚ùì'
    if h == '–ö—Ä–∞—Å–Ω–∞—è –ª–æ—à–∞–¥—å':
        x = 'üî¥'
    elif h == '–°–∏–Ω—è—è –ª–æ—à–∞–¥—å':
        x = 'üîµ'
    elif h == '–ñ—ë–ª—Ç–∞—è –ª–æ—à–∞–¥—å':
        x = 'üåï'
    elif h == '–ß—ë—Ä–Ω–∞—è –ª–æ—à–∞–¥—å':
        x = '‚ö´'
    elif h == '–ú–æ—Ä–æ–∑–Ω–∞—è –ª–æ—à–∞–¥—å':
        x = 'üå®'
    elif h == '–ù–µ–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ª–æ—à–∞–¥—å':
        x = 'üíä'
    elif h == '–î–æ—Ä–æ–≥–∞—è –ª–æ—à–∞–¥—å':
        x = 'üí∂'
    elif h == '–†–æ–±–æ-–ª–æ—à–∞–¥—å':
        x = 'ü§ñ'
    elif h == '–¢–æ–∫—Å–∏—á–Ω–∞—è –ª–æ—à–∞–¥—å':
        x = 'ü§¨'
    elif h == '–ë—ã—Å—Ç—Ä–∞—è –ª–æ—à–∞–¥—å':
        x = 'üå™'
    elif h == '–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ—à–∞–¥—å':
      x = 'üëΩ'
    elif h == '–õ–æ—à–∞–¥—å-—ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä':
      x = 'üî®'
    elif h == '–õ–æ—à–∞–¥—å-–∫–æ–ª–¥—É–Ω':
      x = 'üîÆ'
    elif h == '–°–ª—É—á–∞–π–Ω–∞—è –ª–æ—à–∞–¥—å':
      x = '‚ùì'
    elif h == '–í–æ–π–¥-–ª–æ—à–∞–¥—å':
      x = 'üü£'
    return x
    
  
def check():
    threading.Timer(120, check).start()
    for ids in users.find({}):
        if ids['drunk'] >= 100:
            users.update_one({'id':ids['id']},{'$inc':{'drunk':-1}})
        elif ids['drunk'] > 0:
            users.update_one({'id':ids['id']},{'$inc':{'drunk':-2}})
    for ids in users.find({}):
        if ids['drunk'] < 0:
            users.update_one({'id':ids['id']},{'$set':{'drunk':0}})
    for ids in users.find({}):
        try:
            if time.time() - ids['reboot_time'] > 0:
                users.update_one({'id':ids['id']},{'$set':{'taken_exp':0}})
        except:
            pass

        
def check2():
    threading.Timer(20, check2).start()
    for ids in users.find({}):
        if ids['cook'] != None:
            if time.time() - ids['cook']['work_until'] > 0:
                users.update_one({'id':ids['id']},{'$set':{'cook':None}})
            else:
                if ids['cook']['cooking'] == False:
                    drs = []
                    for idss in ids['current_supplies']:
                        drs.append(ids['current_supplies'][idss])
                    if len(drs) == 0:
                        pass
                    else:
                        dr = random.choice(drs)
                        min = int(30-(ids['cook']['agility']/2))
                        max = int(60-(ids['cook']['agility']/3))
                        if min < 4:
                            min = 4
                        if max < 15:
                            max = 15
                        popitki = 4
                        progress = -25
                        if ids['cook']['intelligence'] >= 20:
                            popitki -= 1
                            progress += 25
                        if ids['cook']['intelligence'] >= 40:
                            popitki -= 1
                            progress += 25 
                        users.update_one({'id':ids['id']},{'$set':{'cook.cooking':True}})
                        cooking(ids, dr, progress, popitki, [min, max], True, cooker=ids['cook'])
                    
                    
def checkbars():
    threading.Timer(120, checkbars).start()
    for ids in alcos:
        s = alcos[ids]
        if s['owner'] != None: 
            allow = False
            owner = users.find_one({'id':s['owner']})
            for ids in owner['current_supplies']:
                if owner['current_supplies'][ids]['amount'] > 0:
                    allow = True
            if allow:
                allow_bars.append(owner['id'])
            else:
                try:
                    allow_bars.remove(owner['id'])
                except:
                    pass
   


        
check()
check2()       
checkbars()  
     
        
        
def medit(message_text, chat_id, message_id, reply_markup=None, parse_mode=None):
    return bot.edit_message_text(chat_id=chat_id, message_id=message_id, text=message_text,
                                    reply_markup=reply_markup,
                                    parse_mode=parse_mode)

    
    
    
for ids in users.find({}):
    text = ''
    if ids['reloadcoins'] > 0:
        users.update_one({'id':ids['id']},{'$inc':{'coins':ids['reloadcoins']}})
        users.update_one({'id':ids['id']},{'$set':{'reloadcoins':0}})
        text += ids['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(ids['reloadcoins'])+' –º–æ–Ω–µ—Ç.\n'
    else:
        users.update_one({'id':ids['id']},{'$set':{'reloadcoins':0}})
    if text != '':
        bot.send_message(441399484, text)
 

def createchat(chat):
    return {
        'id':chat.id,
        'title':chat.title,
        'notifications':True,
        'adminmode':False
    }
   

for ids in chats.find({}):
    try:
        bot.send_message(441399484, ids)
    except:
        pass
    if ids['notifications'] == True:
        try:
            if ids['id'] < 0:
                bot.send_message(ids['id'], '–ë–æ—Ç –±—ã–ª –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω, –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∏–≥—Ä—ã –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å —ç—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–∞–∂–º–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /notifications.')
        except:
            pass
